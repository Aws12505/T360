import{k as b,C as j,f as we,c as Ce,l as C,o as u,w as l,e as n,b as s,u as a,m as he,g as S,i,t as c,a as f,h as R,F as h,r as z,v as O,j as G,n as v,p as ze,W as q}from"./app-CPjAWD4z.js";import{_ as $e}from"./AppLayout.vue_vue_type_script_setup_true_lang-C9iwbndT.js";import{_ as $}from"./Icon.vue_vue_type_script_setup_true_lang-D7_W7H-a.js";import{_ as Ae,a as Ee,b as W,c as T,d as Ne,e as D}from"./TableRow.vue_vue_type_script_setup_true_lang-CfaqljIe.js";import{_ as p}from"./Button.vue_vue_type_script_setup_true_lang-2OAUlLW-.js";import{_ as Q}from"./Card.vue_vue_type_script_setup_true_lang-EeOlRCyR.js";import{_ as Y}from"./CardContent.vue_vue_type_script_setup_true_lang-DEwZUVLb.js";import{_ as J,a as K,b as Z,c as ee,d as te,e as ae}from"./DialogTitle.vue_vue_type_script_setup_true_lang-DnfcFQBY.js";import{a as ne,_ as H}from"./Label.vue_vue_type_script_setup_true_lang-DWQs3udz.js";import{_ as Fe,a as Ve,b as De}from"./AlertDescription.vue_vue_type_script_setup_true_lang-BbmmAI9T.js";import{_ as Pe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-BnOPSdd0.js";import"./createLucideIcon-BMpLhGEh.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-BZ6fMR41.js";import"./shield-CoaW6YVH.js";import"./check-Bmvbjhww.js";import"./loader-circle-BofQhXLU.js";import"./sun-DnfRTXIO.js";const Me={class:"max-w-7xl mx-auto p-6 space-y-8"},Ue={class:"flex flex-col sm:flex-row justify-between items-center mb-6 gap-4"},je={class:"flex flex-wrap gap-3"},Re={key:1,class:"flex items-center gap-2"},Te=["value"],Be={class:"flex items-center gap-2"},Le={class:"cursor-pointer"},Ie={class:"flex flex-col gap-2"},Oe={class:"flex flex-wrap gap-2"},qe={class:"flex justify-between items-center"},We={key:0,class:"text-sm text-muted-foreground"},He={key:0},Xe={key:1},Ge={key:2},Qe={class:"overflow-x-auto bg-background dark:bg-background border-t border-border"},Ye={class:"flex items-center justify-center"},Je=["checked"],Ke=["value"],Ze={class:"flex space-x-2"},et={key:0,class:"bg-muted/20 px-4 py-3 border-t"},tt={class:"flex justify-between items-center"},at={class:"text-sm text-muted-foreground"},nt={class:"flex items-center gap-4"},lt={class:"flex items-center gap-2"},rt={class:"flex"},st=["innerHTML"],it={key:0,class:"col-span-2"},ot={class:"relative"},dt=["value"],ut={__name:"Safety",props:{entries:{type:Object,default:()=>({data:[],links:[]})},tenantSlug:String,SuperAdmin:Boolean,tenants:Array,dateRange:Object,dateFilter:{type:String,default:"full"}},setup(d){const o=d,w=b(""),A=b(!1),B=b("Create Entry"),E=b("Create"),L=b(null),x=b(o.dateFilter||"full"),N=b(10),y=b([]),F=b(!1),g=b(!1),le=[{title:o.tenantSlug?"Dashboard":"Admin Dashboard",href:o.tenantSlug?route("dashboard",{tenantSlug:o.tenantSlug}):route("admin.dashboard")},{title:"Safety",href:o.tenantSlug?route("safety.index",{tenantSlug:o.tenantSlug}):route("safety.index.admin")}];function re(){g.value=!g.value}const P={driver_name:"text",user_name:"text",group:"text",group_hierarchy:"text",minutes_analyzed:"decimal",green_minutes_percent:"decimal",overspeeding_percent:"decimal",driver_score:"decimal",total_events_avg_fd_impact:"decimal",average_following_distance_sec:"decimal",average_following_distance_gz_impact:"decimal",total_events:"decimal",high_g:"decimal",low_impact:"decimal",driver_initiated:"decimal",potential_collision:"decimal",sign_violations:"decimal",sign_violations_gz_impact:"decimal",traffic_light_violation:"decimal",traffic_light_violation_gz_impact:"decimal",u_turn:"decimal",u_turn_gz_impact:"decimal",hard_braking:"decimal",hard_braking_gz_impact:"decimal",hard_turn:"decimal",hard_turn_gz_impact:"decimal",hard_acceleration:"decimal",hard_acceleration_gz_impact:"decimal",driver_distraction:"decimal",driver_distraction_gz_impact:"decimal",following_distance:"decimal",following_distance_gz_impact:"decimal",speeding_violations:"decimal",speeding_violations_gz_impact:"decimal",seatbelt_compliance:"decimal",camera_obstruction:"decimal",driver_drowsiness:"decimal",weaving:"decimal",weaving_gz_impact:"decimal",collision_warning:"decimal",collision_warning_gz_impact:"decimal",requested_video:"decimal",backing:"decimal",roadside_parking:"decimal",driver_distracted_hard_brake:"decimal",following_distance_hard_brake:"decimal",driver_distracted_following_distance:"decimal",driver_star:"decimal",driver_star_gz_impact:"decimal",vehicle_type:"text",safety_normalisation_factor:"decimal",date:"date"},M=Object.keys(P),U=[...M],_=j({tenant_id:null,...Object.fromEntries(M.map(r=>[r,""])),id:null}),k=j({csv_file:null,date:"",tenant_id:null}),se=j({});function ie(r){const e=P[r];return e==="decimal"||e==="integer"?"number":e==="date"?"date":"text"}function oe(r){const e=P[r];return e==="decimal"?"0.01":e==="integer"?"1":null}function de(r){const e=P[r];return e==="decimal"||e==="integer"?"-99999":null}function ue(){_.reset(),B.value="Create Entry",E.value="Create",A.value=!0}function me(r){B.value="Edit Entry",E.value="Update",_.tenant_id=o.SuperAdmin?r.tenant_id:null,_.id=r.id,M.forEach(e=>{_[e]=r[e]}),A.value=!0}function X(){A.value=!1}function ce(){const r=E.value==="Create",e=r?o.SuperAdmin?route("safety.store.admin"):route("safety.store",o.tenantSlug):o.SuperAdmin?route("safety.update.admin",[_.id]):route("safety.update",[o.tenantSlug,_.id]);_[r?"post":"put"](e,{onSuccess:()=>{w.value=r?"Entry created.":"Entry updated.",X()},onError:()=>alert("Something went wrong.")})}function fe(r){if(!confirm("Are you sure?"))return;const e=o.SuperAdmin?route("safety.destroy.admin",[r]):route("safety.destroy",[o.tenantSlug,r]);se.delete(e,{onSuccess:()=>w.value="Entry deleted."})}function pe(r){var m;const e=(m=r.target.files)==null?void 0:m[0];if(!e)return;if(!k.date){alert("Please select the date for this import.");return}if(o.SuperAdmin&&!k.tenant_id){alert("Please select a tenant for import.");return}k.csv_file=e;const t=o.SuperAdmin?route("safety.import.admin"):route("safety.import",o.tenantSlug);k.post(t,{forceFormData:!0,preserveScroll:!0,onSuccess:()=>{w.value="Data imported successfully.",k.reset()},onError:()=>alert("Import failed.")})}function ge(){var e,t;const r=o.SuperAdmin?route("safety.export.admin"):route("safety.export",o.tenantSlug);(e=L.value)==null||e.setAttribute("action",r),(t=L.value)==null||t.submit()}we(w,r=>{r&&setTimeout(()=>{w.value=""},5e3)});function V(r){x.value=r;const e=o.tenantSlug?route("safety.index",{tenantSlug:o.tenantSlug}):route("safety.index.admin");q.get(e,{dateFilter:r,perPage:N.value},{preserveState:!0})}function ve(){const r=o.tenantSlug?route("safety.index",{tenantSlug:o.tenantSlug}):route("safety.index.admin");q.get(r,{dateFilter:x.value,perPage:N.value},{preserveState:!0})}function I(r){if(!r)return"";const e=r.split("-");if(e.length!==3)return r;const[t,m,Se]=e;return`${Number(m)}/${Number(Se)}/${t}`}function ye(r){if(r){const e=new URL(r);e.searchParams.set("perPage",N.value),e.searchParams.set("dateFilter",x.value),q.get(e.href,{},{only:["entries"]})}}const _e=Ce(()=>o.entries.data.length>0&&y.value.length===o.entries.data.length);function be(r){r.target.checked?y.value=o.entries.data.map(e=>e.id):y.value=[]}function xe(){y.value.length>0&&(F.value=!0)}function ke(){const r=j({ids:y.value}),e=o.SuperAdmin?"safety.destroyBulk.admin":"safety.destroyBulk",t=o.SuperAdmin?{}:{tenantSlug:o.tenantSlug};r.delete(route(e,t),{preserveScroll:!0,onSuccess:()=>{w.value=`${y.value.length} safety records deleted successfully.`,y.value=[],F.value=!1},onError:m=>{console.error(m)}})}return(r,e)=>(u(),C($e,{breadcrumbs:le,tenantSlug:d.tenantSlug},{default:l(()=>[n(a(he),{title:"Safety"}),s("div",Me,[w.value?(u(),C(a(Fe),{key:0,variant:"success"},{default:l(()=>[n(a(Ve),null,{default:l(()=>e[15]||(e[15]=[i("Success")])),_:1}),n(a(De),null,{default:l(()=>[i(c(w.value),1)]),_:1})]),_:1})):S("",!0),s("div",Ue,[e[20]||(e[20]=s("h1",{class:"text-2xl font-bold text-gray-800 dark:text-gray-200"},"Safety Management",-1)),s("div",je,[n(a(p),{onClick:ue,variant:"default"},{default:l(()=>[n($,{name:"plus",class:"mr-2 h-4 w-4"}),e[16]||(e[16]=i(" Create New Entry "))]),_:1}),y.value.length>0?(u(),C(a(p),{key:0,onClick:e[0]||(e[0]=t=>xe()),variant:"destructive"},{default:l(()=>[n($,{name:"trash",class:"mr-2 h-4 w-4"}),i(" Delete Selected ("+c(y.value.length)+") ",1)]),_:1})):S("",!0),d.SuperAdmin?(u(),f("div",Re,[R(s("select",{"onUpdate:modelValue":e[1]||(e[1]=t=>a(k).tenant_id=t),class:"h-10 rounded-md border border-input bg-background px-3 py-2 text-sm"},[e[17]||(e[17]=s("option",{disabled:"",value:""},"Select Company Name",-1)),(u(!0),f(h,null,z(d.tenants,t=>(u(),f("option",{key:t.id,value:t.id},c(t.name),9,Te))),128))],512),[[O,a(k).tenant_id]])])):S("",!0),s("div",Be,[n(a(ne),{modelValue:a(k).date,"onUpdate:modelValue":e[2]||(e[2]=t=>a(k).date=t),type:"date",required:"",placeholder:"Date for Import"},null,8,["modelValue"])]),s("label",Le,[n(a(p),{variant:"secondary",as:"span"},{default:l(()=>[n($,{name:"upload",class:"mr-2 h-4 w-4"}),e[18]||(e[18]=i(" Import XLSX "))]),_:1}),s("input",{type:"file",class:"hidden",onChange:pe,accept:".xlsx"},null,32)]),n(a(p),{onClick:G(ge,["prevent"]),variant:"outline"},{default:l(()=>[n($,{name:"download",class:"mr-2 h-4 w-4"}),e[19]||(e[19]=i(" Export CSV "))]),_:1})])]),n(a(Q),null,{default:l(()=>[n(a(Y),{class:"p-4"},{default:l(()=>[s("div",Ie,[s("div",Oe,[n(a(p),{onClick:e[3]||(e[3]=t=>V("yesterday")),variant:"outline",size:"sm",class:v({"bg-primary/10 text-primary border-primary":x.value==="yesterday"})},{default:l(()=>e[21]||(e[21]=[i(" Yesterday ")])),_:1},8,["class"]),n(a(p),{onClick:e[4]||(e[4]=t=>V("current-week")),variant:"outline",size:"sm",class:v({"bg-primary/10 text-primary border-primary":x.value==="current-week"})},{default:l(()=>e[22]||(e[22]=[i(" Current Week ")])),_:1},8,["class"]),n(a(p),{onClick:e[5]||(e[5]=t=>V("6w")),variant:"outline",size:"sm",class:v({"bg-primary/10 text-primary border-primary":x.value==="6w"})},{default:l(()=>e[23]||(e[23]=[i(" 6 Weeks ")])),_:1},8,["class"]),n(a(p),{onClick:e[6]||(e[6]=t=>V("quarterly")),variant:"outline",size:"sm",class:v({"bg-primary/10 text-primary border-primary":x.value==="quarterly"})},{default:l(()=>e[24]||(e[24]=[i(" Quarterly ")])),_:1},8,["class"]),n(a(p),{onClick:e[7]||(e[7]=t=>V("full")),variant:"outline",size:"sm",class:v({"bg-primary/10 text-primary border-primary":x.value==="full"})},{default:l(()=>e[25]||(e[25]=[i(" Full ")])),_:1},8,["class"])]),s("div",qe,[d.dateRange?(u(),f("div",We,[x.value==="yesterday"&&d.dateRange.start?(u(),f("span",He," Showing data from "+c(I(d.dateRange.start)),1)):d.dateRange.start&&d.dateRange.end?(u(),f("span",Xe," Showing data from "+c(I(d.dateRange.start))+" to "+c(I(d.dateRange.end)),1)):(u(),f("span",Ge,c(d.dateRange.label),1))])):S("",!0),n(a(p),{onClick:re,variant:"outline",size:"sm",class:v({"bg-primary/10 text-primary border-primary":g.value})},{default:l(()=>[n($,{name:g.value?"lock":"unlock",class:"mr-2 h-4 w-4"},null,8,["name"]),i(" "+c(g.value?"Unfreeze Names":"Freeze Names"),1)]),_:1},8,["class"])])])]),_:1})]),_:1}),n(a(Q),null,{default:l(()=>[n(a(Y),{class:"p-0"},{default:l(()=>[s("div",Qe,[n(a(Ae),{class:"relative h-[500px] overflow-auto"},{default:l(()=>[n(a(Ee),null,{default:l(()=>[n(a(W),{class:"sticky top-0 bg-background border-b z-10"},{default:l(()=>[n(a(T),{class:v(["w-[50px]",{"sticky left-0 z-20 bg-background":g.value}])},{default:l(()=>[s("div",Ye,[s("input",{type:"checkbox",onChange:be,checked:_e.value,class:"h-4 w-4 rounded border-gray-300 text-primary focus:ring-primary"},null,40,Je)])]),_:1},8,["class"]),d.SuperAdmin?(u(),C(a(T),{key:0,class:v({"sticky left-[50px] z-20 bg-background":g.value})},{default:l(()=>e[26]||(e[26]=[i("Company Name")])),_:1},8,["class"])):S("",!0),(u(),f(h,null,z(U,t=>n(a(T),{key:t,class:v(["whitespace-nowrap",{"sticky z-20 bg-background":g.value&&t==="driver_name","left-[50px]":g.value&&t==="driver_name"&&!d.SuperAdmin,"left-[150px]":g.value&&t==="driver_name"&&d.SuperAdmin}])},{default:l(()=>[i(c(t.replace(/_/g," ").replace(/\b\w/g,m=>m.toUpperCase())),1)]),_:2},1032,["class"])),64)),n(a(T),null,{default:l(()=>e[27]||(e[27]=[i("Actions")])),_:1})]),_:1})]),_:1}),n(a(Ne),null,{default:l(()=>[d.entries.data.length===0?(u(),C(a(W),{key:0},{default:l(()=>[n(a(D),{colspan:d.SuperAdmin?U.length+3:U.length+2,class:"text-center py-8"},{default:l(()=>e[28]||(e[28]=[i(" No entries found ")])),_:1},8,["colspan"])]),_:1})):S("",!0),(u(!0),f(h,null,z(d.entries.data,t=>(u(),C(a(W),{key:t.id,class:"hover:bg-muted/50"},{default:l(()=>[n(a(D),{class:v(["text-center",{"sticky left-0 z-10 bg-background":g.value}])},{default:l(()=>[R(s("input",{type:"checkbox",value:t.id,"onUpdate:modelValue":e[8]||(e[8]=m=>y.value=m),class:"h-4 w-4 rounded border-gray-300 text-primary focus:ring-primary"},null,8,Ke),[[ze,y.value]])]),_:2},1032,["class"]),d.SuperAdmin?(u(),C(a(D),{key:0,class:v({"sticky left-[50px] z-10 bg-background":g.value})},{default:l(()=>{var m;return[i(c(((m=t.tenant)==null?void 0:m.name)??"—"),1)]}),_:2},1032,["class"])):S("",!0),(u(),f(h,null,z(U,m=>n(a(D),{key:m,class:v(["whitespace-nowrap",{"sticky z-10 bg-background":g.value&&m==="driver_name","left-[50px]":g.value&&m==="driver_name"&&!d.SuperAdmin,"left-[150px]":g.value&&m==="driver_name"&&d.SuperAdmin}])},{default:l(()=>[i(c(t[m]),1)]),_:2},1032,["class"])),64)),n(a(D),null,{default:l(()=>[s("div",Ze,[n(a(p),{onClick:m=>me(t),variant:"warning",size:"sm"},{default:l(()=>[n($,{name:"pencil",class:"mr-1 h-4 w-4"}),e[29]||(e[29]=i(" Edit "))]),_:2},1032,["onClick"]),n(a(p),{onClick:m=>fe(t.id),variant:"destructive",size:"sm"},{default:l(()=>[n($,{name:"trash",class:"mr-1 h-4 w-4"}),e[30]||(e[30]=i(" Delete "))]),_:2},1032,["onClick"])])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),d.entries.links?(u(),f("div",et,[s("div",tt,[s("div",at," Showing "+c(d.entries.data.length)+" entries ",1),s("div",nt,[s("div",lt,[n(a(H),{for:"perPage",class:"text-sm"},{default:l(()=>e[31]||(e[31]=[i("Per page:")])),_:1}),R(s("select",{id:"perPage","onUpdate:modelValue":e[9]||(e[9]=t=>N.value=t),onChange:ve,class:"h-8 rounded-md border border-input bg-background px-2 py-1 text-sm ring-offset-background focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50"},e[32]||(e[32]=[s("option",{value:"10"},"10",-1),s("option",{value:"25"},"25",-1),s("option",{value:"50"},"50",-1),s("option",{value:"100"},"100",-1)]),544),[[O,N.value]])]),s("div",rt,[(u(!0),f(h,null,z(d.entries.links,t=>(u(),C(a(p),{key:t.label,onClick:m=>ye(t.url),disabled:!t.url,variant:"ghost",size:"sm",class:v(["mx-1",{"bg-primary/10 text-primary border-primary":t.active}])},{default:l(()=>[s("span",{innerHTML:t.label},null,8,st)]),_:2},1032,["onClick","disabled","class"]))),128))])])])])):S("",!0)]),_:1})]),_:1}),n(a(J),{open:A.value,"onUpdate:open":e[11]||(e[11]=t=>A.value=t)},{default:l(()=>[n(a(K),{class:"sm:max-w-4xl"},{default:l(()=>[n(a(Z),null,{default:l(()=>[n(a(ee),null,{default:l(()=>[i(c(B.value),1)]),_:1}),n(a(te),null,{default:l(()=>[i(" Fill in the details to "+c(E.value.toLowerCase())+" an entry. ",1)]),_:1})]),_:1}),s("form",{onSubmit:G(ce,["prevent"]),class:"grid grid-cols-1 sm:grid-cols-2 gap-4 max-h-[70vh] overflow-y-auto"},[d.SuperAdmin?(u(),f("div",it,[n(a(H),{for:"tenant"},{default:l(()=>e[33]||(e[33]=[i("Company Name")])),_:1}),s("div",ot,[R(s("select",{id:"tenant","onUpdate:modelValue":e[10]||(e[10]=t=>a(_).tenant_id=t),class:"flex h-10 w-full items-center rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 appearance-none"},[e[34]||(e[34]=s("option",{disabled:"",value:""},"Select Company",-1)),(u(!0),f(h,null,z(d.tenants,t=>(u(),f("option",{key:t.id,value:t.id},c(t.name),9,dt))),128))],512),[[O,a(_).tenant_id]]),e[35]||(e[35]=s("div",{class:"pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700"},[s("svg",{class:"h-4 w-4 opacity-50",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor"},[s("path",{"fill-rule":"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z","clip-rule":"evenodd"})])],-1))])])):S("",!0),(u(!0),f(h,null,z(a(M),t=>(u(),f("div",{key:t},[n(a(H),{for:t,class:"capitalize"},{default:l(()=>[i(c(t.replace(/_/g," ")),1)]),_:2},1032,["for"]),n(a(ne),{id:t,modelValue:a(_)[t],"onUpdate:modelValue":m=>a(_)[t]=m,type:ie(t),step:oe(t),min:de(t)},null,8,["id","modelValue","onUpdate:modelValue","type","step","min"])]))),128)),n(a(ae),{class:"col-span-2 mt-4"},{default:l(()=>[n(a(p),{type:"button",onClick:X,variant:"outline"},{default:l(()=>e[36]||(e[36]=[i(" Cancel ")])),_:1}),n(a(p),{type:"submit",variant:"default"},{default:l(()=>[i(c(E.value),1)]),_:1})]),_:1})],32)]),_:1})]),_:1},8,["open"]),n(a(J),{open:F.value,"onUpdate:open":e[14]||(e[14]=t=>F.value=t)},{default:l(()=>[n(a(K),null,{default:l(()=>[n(a(Z),null,{default:l(()=>[n(a(ee),null,{default:l(()=>e[37]||(e[37]=[i("Confirm Bulk Deletion")])),_:1}),n(a(te),null,{default:l(()=>[i(" Are you sure you want to delete "+c(y.value.length)+" safety records? This action cannot be undone. ",1)]),_:1})]),_:1}),n(a(ae),{class:"mt-4"},{default:l(()=>[n(a(p),{type:"button",onClick:e[12]||(e[12]=t=>F.value=!1),variant:"outline"},{default:l(()=>e[38]||(e[38]=[i(" Cancel ")])),_:1}),n(a(p),{type:"button",onClick:e[13]||(e[13]=t=>ke()),variant:"destructive"},{default:l(()=>e[39]||(e[39]=[i(" Delete Selected ")])),_:1})]),_:1})]),_:1})]),_:1},8,["open"]),s("form",{ref_key:"exportForm",ref:L,method:"GET",class:"hidden"},null,512)])]),_:1},8,["tenantSlug"]))}},Et=Pe(ut,[["__scopeId","data-v-01f3b242"]]);export{Et as default};
