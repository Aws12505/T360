import{_ as I}from"./Button.vue_vue_type_script_setup_true_lang-CIs7Gh-v.js";import{_ as tt}from"./Card.vue_vue_type_script_setup_true_lang-C0_n3F9o.js";import{_ as et}from"./CardContent.vue_vue_type_script_setup_true_lang-CUhsODxB.js";import{_ as F}from"./Icon.vue_vue_type_script_setup_true_lang-BG6rUiI2.js";import{r as k,c as m,w as G,k as at,b as ot,e as s,f as C,l as v,u as S,V as t,v as d,z as h,y as l,F as b,C as p,x as N,aj as st,al as B}from"./vendor-vrnjLp2f.js";import"./utils-7SpH83u5.js";import"./vendor-ui-BJvHaezz.js";import"./vendor-icons-DTRPR4Ue.js";const rt={class:"grid grid-cols-1 md:grid-cols-3 gap-2 md:gap-4"},dt={class:"bg-gradient-to-br from-muted/10 to-muted/30 rounded-lg p-4 shadow-md border border-muted/20 hover:shadow-lg transition-shadow"},nt={class:"text-4xl font-bold text-primary"},it={class:"mt-3 pt-3 border-t border-muted/30"},lt={class:"flex items-center justify-between"},ct={class:"text-2xl font-bold text-indigo-600"},ut={class:"bg-gradient-to-br from-muted/10 to-muted/30 rounded-lg p-4 shadow-md border border-muted/20 hover:shadow-lg transition-shadow"},mt={class:"space-y-2"},ht={key:0},gt={class:"text-foreground"},ft={class:"text-primary font-medium"},vt={key:1,class:"text-center text-muted-foreground italic"},bt={class:"bg-gradient-to-br from-muted/10 to-muted/30 rounded-lg p-4 shadow-md border border-muted/20 hover:shadow-lg transition-shadow"},pt={class:"space-y-2"},xt={key:0},yt={class:"text-foreground"},_t={class:"text-destructive font-medium"},wt={key:1,class:"text-center text-muted-foreground italic"},kt={class:"mt-6"},Ct={class:"grid grid-cols-2 md:grid-cols-5 gap-2 md:gap-4"},St={class:"text-sm text-muted-foreground mb-2"},Mt={class:"text-2xl font-bold text-primary"},Dt={class:"mt-6"},Tt={class:"grid grid-cols-2 md:grid-cols-5 gap-2 md:gap-4"},Vt={class:"text-sm text-muted-foreground mb-2"},$t={class:"text-2xl font-bold text-primary"},At={key:0,class:"mt-4 text-center"},jt={key:1,class:"mt-4"},Zt={class:"grid grid-cols-2 md:grid-cols-5 gap-2 md:gap-4"},It={class:"text-sm text-muted-foreground mb-2"},Ft={class:"text-2xl font-bold text-primary"},Gt={key:0,class:"mt-6 text-center"},Nt={key:1,class:"mt-6"},Bt={class:"grid grid-cols-1 md:grid-cols-2 gap-2 md:gap-4 lg:gap-6"},Et={key:0,class:"bg-gradient-to-br from-muted/10 to-muted/30 rounded-lg p-4 shadow-lg border border-muted/20"},Lt={class:"w-full h-64"},Ot={class:"flex justify-center items-center h-72"},zt={class:"w-full h-full"},Qt={__name:"SafetySummary",props:{data:{type:Object,default:()=>({})},activeTab:{type:String,default:""}},setup(i){const c=i,M=k(null),D=k(null);let T=null,V=null;const E=o=>o.replace(/([A-Z])/g," $1").replace(/^./,e=>e.toUpperCase()).trim(),Z=o=>o.replace(/([A-Z])/g," $1").replace(/^./,e=>e.toUpperCase()).trim(),g=k(!1),u=k(!1),$=m(()=>Object.entries(c.data.infractions||{}).sort((e,n)=>n[1]-e[1])),L=m(()=>{const o={};return $.value.filter(([e])=>e!=="driverStar").slice(0,5).forEach(([e,n])=>{o[e]=n}),o});m(()=>{const o={};return $.value.slice(0,5).forEach(([e,n])=>{o[e]=n}),o});const A=m(()=>{const o={};return $.value.filter(([e])=>e!=="driverStar").slice(5).forEach(([e,n])=>{o[e]=n}),o}),O=m(()=>Object.keys(A.value).length>0),z=m(()=>Object.keys(A.value).length),R=()=>{g.value=!g.value},U=()=>{u.value=!u.value,u.value&&setTimeout(()=>{x()},100)},W=m(()=>{var o,e,n,a,r;return[Math.round(((o=c.data.alerts)==null?void 0:o.distractedDriving)||0),Math.round(((e=c.data.alerts)==null?void 0:e.speeding)||0),Math.round(((n=c.data.alerts)==null?void 0:n.signViolation)||0),Math.round(((a=c.data.alerts)==null?void 0:a.trafficLightViolation)||0),Math.round(((r=c.data.alerts)==null?void 0:r.followingDistance)||0)]}),H=m(()=>["Distracted Driving","Speeding","Sign Violations","Traffic Light Violations","Following Distance"]),x=()=>{var o,e;if(T&&T.destroy(),V&&V.destroy(),M.value&&c.activeTab!=="yesterday"){const n=M.value.getContext("2d");if(n){const a=((o=c.data.lineChartData)==null?void 0:o.map(f=>f.greenZoneScore))||[],r=a.length>0?Math.min(...a):0,y=a.length>0?Math.max(...a):100,_=y-r,w=_*.1,q=Math.max(0,r-w),J=y+w;T=new B(n,{type:"line",data:{labels:((e=c.data.lineChartData)==null?void 0:e.map(f=>f.date))||[],datasets:[{label:"Green Zone Score",data:a,borderColor:"#10b981",backgroundColor:"rgba(16, 185, 129, 0.1)",tension:.3}]},options:{responsive:!0,maintainAspectRatio:!0,scales:{y:{beginAtZero:!1,min:Math.max(Math.floor(q-75),0),max:Math.min(Math.ceil(J+75),1050),ticks:{stepSize:Math.ceil(_/5)}}},plugins:{tooltip:{callbacks:{label:function(f){const K=f.raw||0,Q=c.data.greenZoneScore||0,X=c.data.dateRangeLabel||"selected period",Y=Number(Q).toFixed(2);return[`Green Zone Score: ${K}`,`Average Score Over ${X}: ${Y}`]}}}}}})}}if(D.value){const n=D.value.getContext("2d");n&&(V=new B(n,{type:"doughnut",data:{labels:H.value,datasets:[{data:W.value,backgroundColor:["#061455","#1911B2","#678AC6","#EA0E45","#FF9898"],borderWidth:1}]},options:{responsive:!0,maintainAspectRatio:!1,cutout:"60%",plugins:{legend:{position:"bottom",labels:{padding:20,usePointStyle:!0,pointStyle:"circle",boxWidth:10}},tooltip:{callbacks:{label:function(a){const r=a.label||"",y=a.raw||0;return a.dataset.data.reduce((_,w)=>_+w,0),`${r}: ${y}`}}}}}}))}};G(u,o=>{o&&setTimeout(()=>{x()},100)});let j=null;const P=()=>{j&&clearTimeout(j),j=setTimeout(()=>{x()},100)};return G(()=>c.data,()=>{u.value&&P()},{deep:!0}),at(()=>{u.value&&setTimeout(()=>{x()},100)}),(o,e)=>(s(),ot(S(tt),{class:"bg-background dark:bg-background border border-muted/30"},{default:C(()=>[v(S(et),{class:"p-1 md:p-4"},{default:C(()=>{var n;return[t("div",rt,[t("div",dt,[e[1]||(e[1]=t("h3",{class:"text-lg font-semibold text-foreground mb-2"},"Green Zone Score",-1)),t("div",nt,l(Math.round(i.data.greenZoneScore)),1),t("div",it,[t("div",lt,[e[0]||(e[0]=t("span",{class:"text-sm text-muted-foreground"},"Driver Star",-1)),t("span",ct,l(Math.round(((n=i.data.infractions)==null?void 0:n.driverStar)||0)),1)])])]),t("div",ut,[e[2]||(e[2]=t("h3",{class:"text-lg font-semibold text-foreground mb-2"},"Top 5 Drivers",-1)),t("div",mt,[i.data.topDrivers&&i.data.topDrivers.length>0?(s(),d("div",ht,[(s(!0),d(b,null,p(i.data.topDrivers,(a,r)=>(s(),d("div",{key:r,class:"flex justify-between items-center"},[t("span",gt,l(a.name),1),t("span",ft,l(Math.round(a.score)),1)]))),128))])):(s(),d("div",vt," No driver data available "))])]),t("div",bt,[e[3]||(e[3]=t("h3",{class:"text-lg font-semibold text-foreground mb-2"},"Bottom 5 Drivers",-1)),t("div",pt,[i.data.bottomDrivers&&i.data.bottomDrivers.length>0?(s(),d("div",xt,[(s(!0),d(b,null,p(i.data.bottomDrivers,(a,r)=>(s(),d("div",{key:r,class:"flex justify-between items-center"},[t("span",yt,l(a.name),1),t("span",_t,l(Math.round(a.score)),1)]))),128))])):(s(),d("div",wt," No driver data available "))])])]),t("div",kt,[e[4]||(e[4]=t("h3",{class:"text-lg font-semibold text-foreground mb-4"},"Total Severe Alerts",-1)),t("div",Ct,[(s(!0),d(b,null,p(i.data.alerts,(a,r)=>(s(),d("div",{key:r,class:"bg-gradient-to-br from-muted/10 to-muted/30 rounded-lg p-2 md:p-4 text-center shadow-md border border-muted/20 hover:shadow-lg transition-shadow"},[t("div",St,l(E(r)),1),t("div",Mt,l(Math.floor(a)),1)]))),128))])]),t("div",Dt,[e[5]||(e[5]=t("h3",{class:"text-lg font-semibold text-foreground mb-4"},"Other Severe Safety Infractions",-1)),t("div",Tt,[(s(!0),d(b,null,p(L.value,(a,r)=>(s(),d("div",{key:r,class:"bg-gradient-to-br from-muted/10 to-muted/30 rounded-lg p-2 md:p-4 text-center shadow-md border border-muted/20 hover:shadow-lg transition-shadow"},[t("div",Vt,l(Z(r)),1),t("div",$t,l(Math.round(a)),1)]))),128))]),O.value?(s(),d("div",At,[v(S(I),{onClick:R,variant:"outline",class:"w-full md:w-auto shadow-sm hover:shadow transition-shadow"},{default:C(()=>[v(F,{name:g.value?"chevron-up":"chevron-down",class:"mr-2 h-4 w-4"},null,8,["name"]),N(" "+l(g.value?"Show Less":`Show ${z.value} More`),1)]),_:1})])):h("",!0),g.value?(s(),d("div",jt,[t("div",Zt,[(s(!0),d(b,null,p(A.value,(a,r)=>(s(),d("div",{key:r,class:"bg-gradient-to-br from-muted/10 to-muted/30 rounded-lg p-2 md:p-4 text-center shadow-md border border-muted/20 hover:shadow-lg transition-shadow"},[t("div",It,l(Z(r)),1),t("div",Ft,l(Math.round(a)),1)]))),128))])])):h("",!0)]),i.activeTab!=="yesterday"?(s(),d("div",Gt,[v(S(I),{onClick:U,variant:"outline",class:"w-full md:w-auto shadow-sm hover:shadow transition-shadow"},{default:C(()=>[v(F,{name:u.value?"eye-off":"eye",class:"mr-2 h-4 w-4"},null,8,["name"]),N(" "+l(u.value?"Hide Graphs":"Show Graphs"),1)]),_:1})])):h("",!0),u.value?(s(),d("div",Nt,[t("div",Bt,[i.activeTab!=="yesterday"?(s(),d("div",Et,[e[6]||(e[6]=t("h3",{class:"text-lg font-semibold text-foreground mb-4"},"Safety Trends",-1)),t("div",Lt,[t("canvas",{ref_key:"lineChartCanvas",ref:M,width:"400",height:"200"},null,512)])])):h("",!0),i.activeTab!=="yesterday"?(s(),d("div",{key:1,class:st([{"md:col-span-2":i.activeTab==="yesterday"},"bg-gradient-to-br from-muted/10 to-muted/30 rounded-lg p-4 shadow-lg border border-muted/20"])},[e[7]||(e[7]=t("h3",{class:"text-lg font-semibold text-foreground mb-4"},"Alert Distribution",-1)),t("div",Ot,[t("div",zt,[t("canvas",{ref_key:"doughnutChartCanvas",ref:D,width:"200",height:"200"},null,512)])])],2)):h("",!0)])])):h("",!0)]}),_:1})]),_:1}))}};export{Qt as default};
