import{x as Z,W as Q,g as J}from"./vendor-vue-C5ukOnUx.js";import{_ as X}from"./AppLayout.vue_vue_type_script_setup_true_lang-CKl3H69c.js";import{_ as T}from"./Icon.vue_vue_type_script_setup_true_lang-BG6rUiI2.js";import{_ as E}from"./Badge.vue_vue_type_script_setup_true_lang-BIBRQZio.js";import{d as P,c as B,v as D,e as g,V as e,y as u,aj as M,r as F,z as V,F as G,C as L,l as d,f as c,x as p,u as l,b as $,M as ee,ak as te,p as ae,k as ne}from"./vendor-vrnjLp2f.js";import{a as se,b as Y,c as z,d as re,e as W,_ as oe}from"./TableRow.vue_vue_type_script_setup_true_lang-RcUuecyr.js";import{_ as A}from"./Button.vue_vue_type_script_setup_true_lang-CIs7Gh-v.js";import{_ as le,a as ie,b as de,c as ue,d as ce}from"./DialogDescription.vue_vue_type_script_setup_true_lang-BiqjaQNb.js";import{_ as me}from"./DialogFooter.vue_vue_type_script_setup_true_lang-g2X2Ls_P.js";import{_ as O,a as q}from"./Label.vue_vue_type_script_setup_true_lang-DFFa_aCR.js";import{T as K}from"./app-zCC0f3mW.js";import"./vendor-axios-xsH4HHeE.js";import"./utils-7SpH83u5.js";import"./vendor-ui-BJvHaezz.js";import"./vendor-icons-DTRPR4Ue.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-YSKQsDkj.js";const fe={class:"mb-6"},ge=P({__name:"DashboardHeader",props:{operationalExcellenceScore:{type:String,default:"Not Available"}},setup(s){const m=s,v=B(()=>{switch(m.operationalExcellenceScore){case"Fantastic +":return"text-green-600";case"Fantastic":return"text-emerald-600";case"Good":return"text-blue-600";case"Fair":return"text-amber-600";case"Poor":return"text-red-600";default:return"text-gray-600"}});return(y,b)=>(g(),D("div",fe,[e("h2",{class:M(["text-4xl font-bold tracking-tight",[v.value,"transition-colors duration-300"]])},u(s.operationalExcellenceScore),3)]))}}),ve={class:"mb-6"},be={class:"border-b"},pe={class:"flex -mb-px space-x-8"},xe=["onClick"],ye={key:0,class:"mt-2 text-sm text-muted-foreground"},_e={key:0,class:"ml-1"},we=P({__name:"TimePeriodTabs",props:{dateRangeText:{type:String,default:""},weekNumber:{type:Number,default:null},startWeekNumber:{type:Number,default:null},endWeekNumber:{type:Number,default:null},year:{type:Number,default:null},activeTabId:{type:String,default:"yesterday"}},emits:["tab-change"],setup(s,{emit:m}){const v=s,y=[{id:"yesterday",label:"Yesterday"},{id:"current-week",label:"WTD"},{id:"t6w",label:"T6W Scores"},{id:"quarterly",label:"Quarterly Scores"}],b=F(v.activeTabId),o=m,x=B(()=>(b.value==="yesterday"||b.value==="current-week")&&v.weekNumber&&v.year?`Week ${v.weekNumber}, ${v.year}`:(b.value==="t6w"||b.value==="quarterly")&&v.startWeekNumber&&v.endWeekNumber&&v.year?`Weeks ${v.startWeekNumber}-${v.endWeekNumber}, ${v.year}`:""),R=h=>{b.value=h,o("tab-change",h)};return(h,N)=>(g(),D("div",ve,[e("div",be,[e("div",pe,[(g(),D(G,null,L(y,j=>e("button",{key:j.id,onClick:k=>R(j.id),class:M(["py-2 px-1 border-b-2 text-sm font-medium transition-colors",b.value===j.id?"border-primary text-primary":"border-transparent text-muted-foreground hover:text-foreground hover:border-muted-foreground"])},u(j.label),11,xe)),64))])]),s.dateRangeText?(g(),D("div",ye,[e("span",null,u(s.dateRangeText),1),x.value?(g(),D("span",_e,"("+u(x.value)+")",1)):V("",!0)])):V("",!0)]))}}),ke={class:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-6 mb-6"},De={class:"bg-card rounded-lg border shadow-sm p-4"},$e={class:"flex items-center justify-between gap-3 mb-4"},Se={class:"space-y-2 text-sm max-h-40 overflow-y-auto"},he={class:"bg-card rounded-lg border shadow-sm p-4"},Te={class:"flex items-center justify-between gap-3 mb-4"},Ce={class:"space-y-2 text-sm max-h-40 overflow-y-auto"},Re={class:"bg-card rounded-lg border shadow-sm p-4"},Ne={class:"flex items-center justify-between gap-3 mb-4"},je={class:"text-sm mb-2 space-y-2"},Fe={class:"flex justify-between"},Be={class:"flex justify-between"},Me={class:"flex justify-between"},Ee={class:"flex justify-between"},Ue={class:"bg-card rounded-lg border shadow-sm p-4"},Ve={class:"flex items-center justify-between gap-3 mb-4"},We={class:"text-4xl font-bold text-indigo-600"},Ae={class:"space-y-2 text-sm"},Oe={class:"flex justify-between items-center"},Pe={class:"flex items-center gap-2"},Ie={class:"w-12 text-right"},ze={class:"w-16 text-right"},Ge={class:"flex justify-between items-center"},Le={class:"flex items-center gap-2"},Ye={class:"w-12 text-right"},qe={class:"w-16 text-right"},He={class:"flex justify-between items-center"},Ke={class:"flex items-center gap-2"},Qe={class:"w-12 text-right"},Ze={class:"w-16 text-right"},Je={class:"flex justify-between items-center"},Xe={class:"flex items-center gap-2"},et={class:"w-12 text-right"},tt={class:"w-16 text-right"},at={class:"flex justify-between items-center"},nt={class:"flex items-center gap-2"},st={class:"w-12 text-right"},rt={class:"w-16 text-right"},ot={class:"text-sm text-muted-foreground mt-3"},lt=P({__name:"PerformanceCards",props:{performanceData:{type:Object,default:()=>({})},performanceRatings:{type:Object,default:()=>({})},safetyData:{type:Object,default:()=>({})},delayBreakdowns:{type:Array,default:()=>[]},rejectionBreakdowns:{type:Array,default:()=>[]},maintenanceBreakdowns:{type:Object,default:()=>({})}},setup(s){const m=s,v=B(()=>[...m.delayBreakdowns].sort((a,n)=>n.total_delays-a.total_delays).slice(0,3)),y=B(()=>[...m.rejectionBreakdowns].sort((a,n)=>n.total_rejections-a.total_rejections).slice(0,3)),b=a=>a==null?"0%":`${Math.round(parseFloat(a))}%`,o=a=>(typeof a=="string"&&(a=parseFloat(a)),a==null||isNaN(a)?"0":Math.round(a).toString()),x=a=>(typeof a=="string"&&(a=parseFloat(a)),a==null||isNaN(a)?"0.00":a.toFixed(2)),R=a=>(typeof a=="string"&&(a=parseFloat(a)),a==null||isNaN(a)?"0.00":a.toFixed(2)),h=a=>{if(!a)return"Not Available";switch(a){case"gold":return"Gold Tier";case"silver":return"Silver Tier";case"not_eligible":return"Not Eligible";case"fantastic_plus":return"Fantastic +";case"fantastic":return"Fantastic";case"good":return"Good";case"fair":return"Fair";case"poor":return"Poor";default:return a}},N=a=>{if(!a)return"outline";switch(a){case"gold":return"gold";case"silver":return"silver";case"not_eligible":return"not-eligible";case"fantastic_plus":return"fantastic-plus";case"fantastic":return"fantastic";case"good":return"good";case"fair":return"fair";case"poor":return"poor";default:return"outline"}},j=a=>a?a==="Gold Tier"?"gold":a==="Silver Tier"?"silver":a==="Not Eligible"?"not-eligible":"outline":"outline",k=B(()=>{var f;if(!((f=m.safetyData)!=null&&f.ratings))return null;const a=m.safetyData.ratings,n={gold:3,silver:2,not_eligible:1},S=["traffic_light_violation","speeding_violations","following_distance","driver_distraction","sign_violations"];let _="gold";for(const r of S)a[r]&&n[a[r]]<n[_]&&(_=a[r]);switch(_){case"gold":return"Gold Tier";case"silver":return"Silver Tier";case"not_eligible":return"Not Eligible";default:return"Not Available"}}),U=a=>{if(!a)return"text-gray-600";switch(a){case"gold":return"text-amber-600";case"silver":return"text-slate-600";case"not_eligible":return"text-red-600";case"fantastic_plus":return"text-green-600";case"fantastic":return"text-emerald-600";case"good":return"text-blue-600";case"fair":return"text-amber-600";case"poor":return"text-red-600";default:return"text-indigo-600"}};return(a,n)=>{var S,_,f,r,t;return g(),D("div",ke,[e("div",De,[n[0]||(n[0]=e("h3",{class:"text-base font-semibold mb-1"},"Acceptance",-1)),n[1]||(n[1]=e("div",{class:"text-xs text-muted-foreground mb-1"},"Total Score",-1)),e("div",$e,[e("div",{class:M(["text-4xl font-bold",U(s.performanceRatings.average_acceptance)])},u(b(s.performanceData.average_acceptance)),3),d(l(E),{variant:N(s.performanceRatings.average_acceptance),class:"text-xs"},{default:c(()=>[p(u(h(s.performanceRatings.average_acceptance)),1)]),_:1},8,["variant"])]),n[2]||(n[2]=e("div",{class:"text-sm mb-2 flex justify-between"},[e("span",{class:"font-semibold"},"Rejections by Reason"),e("span",{class:"font-semibold"},"Total")],-1)),e("div",Se,[(g(!0),D(G,null,L(y.value,(i,w)=>(g(),D("div",{key:w,class:"flex justify-between"},[e("span",null,u(i.reason_code),1),e("span",null,u(i.total_rejections),1)]))),128))])]),e("div",he,[n[3]||(n[3]=e("h3",{class:"text-base font-semibold mb-1"},"On-Time",-1)),n[4]||(n[4]=e("div",{class:"text-xs text-muted-foreground mb-1"},"Total Score",-1)),e("div",Te,[e("div",{class:M(["text-4xl font-bold",U(s.performanceRatings.average_on_time)])},u(b(s.performanceData.average_on_time)),3),d(l(E),{variant:N(s.performanceRatings.average_on_time),class:"text-xs"},{default:c(()=>[p(u(h(s.performanceRatings.average_on_time)),1)]),_:1},8,["variant"])]),n[5]||(n[5]=e("div",{class:"text-sm mb-2 flex justify-between"},[e("span",{class:"font-semibold"},"Delays by Reason"),e("span",{class:"font-semibold"},"Total")],-1)),e("div",Ce,[(g(!0),D(G,null,L(v.value,(i,w)=>(g(),D("div",{key:w,class:"flex justify-between"},[e("span",null,u(i.code),1),e("span",null,u(i.total_delays),1)]))),128))])]),e("div",Re,[n[10]||(n[10]=e("h3",{class:"text-base font-semibold mb-1"},"Maintenance",-1)),n[11]||(n[11]=e("div",{class:"text-xs text-muted-foreground mb-1"},"MVtS Score",-1)),e("div",Ne,[e("div",{class:M(["text-4xl font-bold",U(s.performanceRatings.average_maintenance_variance_to_spend)])},u(b(s.performanceData.average_maintenance_variance_to_spend)),3),d(l(E),{variant:N(s.performanceRatings.average_maintenance_variance_to_spend),class:"text-xs"},{default:c(()=>[p(u(h(s.performanceRatings.average_maintenance_variance_to_spend)),1)]),_:1},8,["variant"])]),e("div",je,[e("div",Fe,[n[6]||(n[6]=e("span",null,"Cost per mile",-1)),e("span",null,"$"+u(R(s.maintenanceBreakdowns.cpm)),1)]),e("div",Be,[n[7]||(n[7]=e("span",null,"Num of WOs",-1)),e("span",null,u(s.maintenanceBreakdowns.total_repair_orders),1)]),e("div",Me,[n[8]||(n[8]=e("span",null,"Current Costs",-1)),e("span",null,"$"+u(R(s.maintenanceBreakdowns.total_invoice_amount)),1)]),e("div",Ee,[n[9]||(n[9]=e("span",null,"Missing Invoices",-1)),e("span",null,u(s.maintenanceBreakdowns.missing_invoices_count||0),1)])])]),e("div",Ue,[n[17]||(n[17]=e("h3",{class:"text-base font-semibold mb-1"},"Netradyne Alerts Bonus Criteria",-1)),n[18]||(n[18]=e("div",{class:"text-xs text-muted-foreground mb-1"},"Green Zone Score",-1)),e("div",Ve,[e("div",We,u(o(s.safetyData.average_driver_score||"N/A")),1),d(l(E),{variant:j(k.value),class:"text-xs"},{default:c(()=>[p(u(h(k.value)),1)]),_:1},8,["variant"])]),n[19]||(n[19]=e("div",{class:"flex justify-between items-center text-sm font-semibold mb-2"},[e("span",null,"Alert Type"),e("div",{class:"flex items-center gap-2"},[e("span",{class:"w-12 text-right"},"Total"),e("span",{class:"w-16 text-right"},"P1KH")])],-1)),e("div",Ae,[e("div",Oe,[n[12]||(n[12]=e("span",null,"Distracted Driving",-1)),e("div",Pe,[e("span",Ie,u(o(s.safetyData.driver_distraction)),1),e("span",ze,u(x((S=s.safetyData.rates)==null?void 0:S.driver_distraction)),1)])]),e("div",Ge,[n[13]||(n[13]=e("span",null,"Speeding",-1)),e("div",Le,[e("span",Ye,u(o(s.safetyData.speeding_violations)),1),e("span",qe,u(x((_=s.safetyData.rates)==null?void 0:_.speeding_violations)),1)])]),e("div",He,[n[14]||(n[14]=e("span",null,"Sign Violation",-1)),e("div",Ke,[e("span",Qe,u(o(s.safetyData.sign_violations)),1),e("span",Ze,u(x((f=s.safetyData.rates)==null?void 0:f.sign_violations)),1)])]),e("div",Je,[n[15]||(n[15]=e("span",null,"Traffic Light Violation",-1)),e("div",Xe,[e("span",et,u(o(s.safetyData.traffic_light_violation)),1),e("span",tt,u(x((r=s.safetyData.rates)==null?void 0:r.traffic_light_violation)),1)])]),e("div",at,[n[16]||(n[16]=e("span",null,"Following Distance",-1)),e("div",nt,[e("span",st,u(o(s.safetyData.following_distance)),1),e("span",rt,u(x((t=s.safetyData.rates)==null?void 0:t.following_distance)),1)])])]),e("div",ot,[e("div",null,"Total Hours Analyzed: "+u(o(s.safetyData.total_hours||0)),1)])])])}}}),it={class:"bg-card rounded-lg border shadow-sm p-6 mb-6"},dt={class:"grid grid-cols-1 md:grid-cols-3 gap-6"},ut={class:"p-4 border rounded-lg"},ct={class:"flex items-center justify-between gap-3 mb-3"},mt={class:"p-4 border rounded-lg"},ft={class:"flex items-center justify-between gap-3 mb-3"},gt={class:"p-4 border rounded-lg"},vt={class:"flex items-center justify-between gap-3 mb-3"},bt=P({__name:"AdditionalMetricsCard",props:{performanceData:{type:Object,default:()=>({})},performanceRatings:{type:Object,default:()=>({})}},setup(s){const m=o=>o==null?"0":Math.round(parseFloat(o)).toString(),v=o=>{if(!o)return"Not Available";switch(o){case"fantastic_plus":return"Fantastic +";case"fantastic":return"Fantastic";case"good":return"Good";case"fair":return"Fair";case"poor":return"Poor";default:return o.charAt(0).toUpperCase()+o.slice(1).replace(/_/g," ")}},y=o=>{if(!o)return"outline";switch(o){case"fantastic_plus":return"fantastic-plus";case"fantastic":return"fantastic";case"good":return"good";case"fair":return"fair";case"poor":return"poor";default:return"outline"}},b=o=>{if(!o)return"text-gray-600";switch(o){case"fantastic_plus":return"text-green-600";case"fantastic":return"text-emerald-600";case"good":return"text-blue-600";case"fair":return"text-amber-600";case"poor":return"text-red-600";default:return"text-indigo-600"}};return(o,x)=>(g(),D("div",it,[x[6]||(x[6]=e("h3",{class:"text-xl font-semibold mb-4"},"Additional Performance Metrics",-1)),e("div",dt,[e("div",ut,[x[0]||(x[0]=e("h4",{class:"text-lg font-medium mb-2"},"VCR-P",-1)),x[1]||(x[1]=e("div",{class:"text-sm text-muted-foreground mb-1"},"Count",-1)),e("div",ct,[e("div",{class:M(["text-3xl font-bold",b(s.performanceRatings.vcr_preventable)])},u(m(s.performanceData.vcr_preventable)),3),d(l(E),{variant:y(s.performanceRatings.vcr_preventable),class:"text-xs"},{default:c(()=>[p(u(v(s.performanceRatings.vcr_preventable)),1)]),_:1},8,["variant"])])]),e("div",mt,[x[2]||(x[2]=e("h4",{class:"text-lg font-medium mb-2"},"VMCR-P",-1)),x[3]||(x[3]=e("div",{class:"text-sm text-muted-foreground mb-1"},"Count",-1)),e("div",ft,[e("div",{class:M(["text-3xl font-bold",b(s.performanceRatings.vmcr_p)])},u(m(s.performanceData.vmcr_p)),3),d(l(E),{variant:y(s.performanceRatings.vmcr_p),class:"text-xs"},{default:c(()=>[p(u(v(s.performanceRatings.vmcr_p)),1)]),_:1},8,["variant"])])]),e("div",gt,[x[4]||(x[4]=e("h4",{class:"text-lg font-medium mb-2"},"Open BOC",-1)),x[5]||(x[5]=e("div",{class:"text-sm text-muted-foreground mb-1"},"Count",-1)),e("div",vt,[e("div",{class:M(["text-3xl font-bold",b(s.performanceRatings.open_boc)])},u(m(s.performanceData.open_boc)),3),d(l(E),{variant:y(s.performanceRatings.open_boc),class:"text-xs"},{default:c(()=>[p(u(v(s.performanceRatings.open_boc)),1)]),_:1},8,["variant"])])])])]))}}),pt={class:"bg-card rounded-lg border shadow-sm p-4 md:p-6 mb-6"},xt={class:"flex justify-between items-center mb-4"},yt={class:"overflow-x-auto max-h-80"},_t={class:"flex space-x-2"},wt={key:0,class:"border-t mt-4 px-4 py-3 bg-muted/20"},kt={class:"flex flex-col sm:flex-row items-center justify-between gap-2"},Dt={class:"text-sm text-muted-foreground"},$t={class:"flex flex-wrap gap-2"},St=["innerHTML"],ht={class:"grid grid-cols-2 gap-4"},Tt={key:0,class:"grid grid-cols-2 gap-4"},Ct={class:"mt-1"},Rt={class:"mt-1"},Nt=P({__name:"MilesDrivenTable",props:{milesEntries:{},tenantSlug:{}},setup(s){const m=s,v=F(!1),y=F("week_start_date"),b=F("desc"),o=Z({id:null,year:"",week_number:"",week_start_date:"",week_end_date:"",miles:"",notes:""}),x=B(()=>{const r=[...m.milesEntries.data];return r.sort((t,i)=>{let w=t[y.value],C=i[y.value];return w>C?b.value==="asc"?1:-1:w<C?b.value==="asc"?-1:1:0}),r});function R(r){y.value===r?b.value=b.value==="asc"?"desc":"asc":(y.value=r,b.value="asc")}function h(r=null){if(o.reset(),o.clearErrors(),r){o.id=r.id,o.week_start_date=r.week_start_date,o.week_end_date=r.week_end_date,o.miles=r.miles,o.notes=r.notes;const t=new Date(r.week_start_date),i=new Date(Date.UTC(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate()));i.setUTCDate(i.getUTCDate()+4-(i.getUTCDay()||7));const w=i.getUTCFullYear(),C=Math.ceil(((i-Date.UTC(w,0,1))/864e5+1)/7)+1;o.year=w,o.week_number=C}v.value=!0}function N(){const r=+o.year,t=+o.week_number;if(!r||!t){o.week_start_date="",o.week_end_date="";return}const i=new Date(Date.UTC(r,0,4)),w=i.getUTCDay()||7;i.setUTCDate(i.getUTCDate()+(t-1)*7+(1-w));const C=new Date(i);C.setUTCDate(i.getUTCDate()-1);const I=new Date(C);I.setUTCDate(C.getUTCDate()+6),o.week_start_date=C.toISOString().slice(0,10),o.week_end_date=I.toISOString().slice(0,10)}function j(){const r=o.id?"miles_driven.update":"miles_driven.store",t=o.id?{tenantSlug:m.tenantSlug,milesDriven:o.id}:{tenantSlug:m.tenantSlug};o[o.id?"put":"post"](K(r,t),{only:["milesEntries"],preserveScroll:!0,onSuccess:()=>{v.value=!1}})}const k=F(null);function U(r){k.value=r,confirm("Really delete this record?")&&a()}function a(){const r="miles_driven.destroy",t={tenantSlug:m.tenantSlug,milesDriven:k.value.id};o.delete(K(r,t),{only:["milesEntries"],preserveScroll:!0,onSuccess:()=>{}})}function n(r){if(!r)return"";const t=new Date(r);return new Date(t.getTime()+t.getTimezoneOffset()*6e4).toLocaleDateString()}function S(r){return Number(r).toLocaleString(void 0,{minimumFractionDigits:4,maximumFractionDigits:4})}function _(r,t){return(r==null?void 0:r.length)>t?r.slice(0,t)+"…":r||""}function f(r){r&&Q.get(r,{},{only:["milesEntries"],preserveScroll:!0})}return(r,t)=>(g(),D("div",pt,[e("div",xt,[t[11]||(t[11]=e("h3",{class:"text-base md:text-xl font-semibold"}," Miles Driven ",-1)),d(l(A),{onClick:t[0]||(t[0]=i=>h()),variant:"default"},{default:c(()=>[d(T,{name:"plus",class:"mr-2 h-4 w-4"}),t[10]||(t[10]=e("span",null,"Add Miles Driven",-1))]),_:1})]),e("div",yt,[d(l(oe),{class:"w-full"},{default:c(()=>[d(l(se),null,{default:c(()=>[d(l(Y),{class:"sticky top-0 z-10 border-b"},{default:c(()=>[d(l(z),{class:"cursor-pointer",onClick:t[1]||(t[1]=i=>R("week_start_date"))},{default:c(()=>[t[12]||(t[12]=p(" Week Start ")),e("span",null,[y.value==="week_start_date"&&b.value==="asc"?(g(),$(T,{key:0,name:"chevron-up"})):y.value==="week_start_date"&&b.value==="desc"?(g(),$(T,{key:1,name:"chevron-down"})):(g(),$(T,{key:2,name:"chevron-up-down",class:"opacity-50"}))])]),_:1}),d(l(z),{class:"cursor-pointer",onClick:t[2]||(t[2]=i=>R("week_end_date"))},{default:c(()=>[t[13]||(t[13]=p(" Week End ")),e("span",null,[y.value==="week_end_date"&&b.value==="asc"?(g(),$(T,{key:0,name:"chevron-up"})):y.value==="week_end_date"&&b.value==="desc"?(g(),$(T,{key:1,name:"chevron-down"})):(g(),$(T,{key:2,name:"chevron-up-down",class:"opacity-50"}))])]),_:1}),d(l(z),{class:"cursor-pointer",onClick:t[3]||(t[3]=i=>R("miles"))},{default:c(()=>[t[14]||(t[14]=p(" Miles ")),e("span",null,[y.value==="miles"&&b.value==="asc"?(g(),$(T,{key:0,name:"chevron-up"})):y.value==="miles"&&b.value==="desc"?(g(),$(T,{key:1,name:"chevron-down"})):(g(),$(T,{key:2,name:"chevron-up-down",class:"opacity-50"}))])]),_:1}),d(l(z),null,{default:c(()=>t[15]||(t[15]=[p("Notes")])),_:1}),d(l(z),null,{default:c(()=>t[16]||(t[16]=[p("Actions")])),_:1})]),_:1})]),_:1}),d(l(re),null,{default:c(()=>[(g(!0),D(G,null,L(x.value,i=>(g(),$(l(Y),{key:i.id},{default:c(()=>[d(l(W),null,{default:c(()=>[p(u(n(i.week_start_date)),1)]),_:2},1024),d(l(W),null,{default:c(()=>[p(u(n(i.week_end_date)),1)]),_:2},1024),d(l(W),null,{default:c(()=>[p(u(S(i.miles)),1)]),_:2},1024),d(l(W),null,{default:c(()=>[p(u(_(i.notes,30)),1)]),_:2},1024),d(l(W),null,{default:c(()=>[e("div",_t,[d(l(A),{variant:"outline",size:"sm",onClick:w=>h(i)},{default:c(()=>[d(T,{name:"pencil",class:"mr-1 h-4 w-4"}),t[17]||(t[17]=e("span",null,"Edit",-1))]),_:2},1032,["onClick"]),d(l(A),{variant:"destructive",size:"sm",onClick:w=>U(i)},{default:c(()=>[d(T,{name:"trash",class:"mr-1 h-4 w-4"}),t[18]||(t[18]=e("span",null,"Delete",-1))]),_:2},1032,["onClick"])])]),_:2},1024)]),_:2},1024))),128)),r.milesEntries.data.length?V("",!0):(g(),$(l(Y),{key:0},{default:c(()=>[d(l(W),{colspan:5,class:"py-4 text-center text-muted-foreground"},{default:c(()=>t[19]||(t[19]=[p(" No miles driven records found ")])),_:1})]),_:1}))]),_:1})]),_:1})]),r.milesEntries.links?(g(),D("div",wt,[e("div",kt,[e("div",Dt," Showing "+u(r.milesEntries.data.length)+" entries ",1),e("div",$t,[(g(!0),D(G,null,L(r.milesEntries.links,i=>(g(),$(l(A),{key:i.label,onClick:w=>f(i.url),disabled:!i.url,variant:"ghost",size:"sm",class:M({"border-primary bg-primary/10 text-primary":i.active})},{default:c(()=>[e("span",{innerHTML:i.label},null,8,St)]),_:2},1032,["onClick","disabled","class"]))),128))])])])):V("",!0),d(l(ce),{open:v.value,"onUpdate:open":t[9]||(t[9]=i=>v.value=i)},{default:c(()=>[d(l(le),{class:"sm:max-w-md w-full max-h-[90vh] overflow-auto"},{default:c(()=>[d(l(ie),null,{default:c(()=>[d(l(de),null,{default:c(()=>[p(u(l(o).id?"Edit Miles Driven":"Add Miles Driven"),1)]),_:1}),d(l(ue),{class:"text-muted-foreground"},{default:c(()=>[p(u(l(o).id?"Update this record.":"Fill in the new miles driven record."),1)]),_:1})]),_:1}),e("form",{onSubmit:ae(j,["prevent"]),class:"grid gap-4 py-4"},[e("div",ht,[e("div",null,[d(l(O),{for:"year"},{default:c(()=>t[20]||(t[20]=[p("Year")])),_:1}),d(l(q),{id:"year",type:"number",modelValue:l(o).year,"onUpdate:modelValue":t[4]||(t[4]=i=>l(o).year=i),modelModifiers:{number:!0},min:"2000",max:"2100",onInput:N},null,8,["modelValue"])]),e("div",null,[d(l(O),{for:"week_number"},{default:c(()=>t[21]||(t[21]=[p("Week #")])),_:1}),d(l(q),{id:"week_number",type:"number",modelValue:l(o).week_number,"onUpdate:modelValue":t[5]||(t[5]=i=>l(o).week_number=i),modelModifiers:{number:!0},min:"1",max:"53",onInput:N},null,8,["modelValue"])])]),l(o).week_start_date?(g(),D("div",Tt,[e("div",null,[d(l(O),null,{default:c(()=>t[22]||(t[22]=[p("Start (Sun)")])),_:1}),e("p",Ct,u(n(l(o).week_start_date)),1)]),e("div",null,[d(l(O),null,{default:c(()=>t[23]||(t[23]=[p("End (Sat)")])),_:1}),e("p",Rt,u(n(l(o).week_end_date)),1)])])):V("",!0),e("div",null,[d(l(O),{for:"miles"},{default:c(()=>t[24]||(t[24]=[p("Miles")])),_:1}),d(l(q),{id:"miles",modelValue:l(o).miles,"onUpdate:modelValue":t[6]||(t[6]=i=>l(o).miles=i),type:"number",step:"0.0001",min:"0",max:"999999.9999"},null,8,["modelValue"])]),e("div",null,[d(l(O),{for:"notes"},{default:c(()=>t[25]||(t[25]=[p("Notes")])),_:1}),ee(e("textarea",{id:"notes","onUpdate:modelValue":t[7]||(t[7]=i=>l(o).notes=i),class:"w-full h-24 resize-none rounded-md border border-input bg-background px-3 py-2 text-sm"},null,512),[[te,l(o).notes]])]),d(l(me),{class:"mt-4"},{default:c(()=>[d(l(A),{variant:"outline",type:"button",onClick:t[8]||(t[8]=i=>v.value=!1)},{default:c(()=>t[26]||(t[26]=[p(" Cancel ")])),_:1}),d(l(A),{type:"submit",disabled:l(o).processing},{default:c(()=>t[27]||(t[27]=[p("Submit")])),_:1},8,["disabled"])]),_:1})],32)]),_:1})]),_:1},8,["open"])]))}}),jt={class:"container w-full md:max-w-2xl lg:max-w-3xl xl:max-w-6xl lg:mx-auto m-0 p-2 md:p-4 lg:p-6 space-y-2 md:space-y-4 lg:space-y-6"},Ft={class:"flex items-center justify-between mb-6"},Kt=P({__name:"Summary",props:{tenantSlug:String,summaries:Object,delayBreakdowns:Object,rejectionBreakdowns:Object,maintenanceBreakdowns:Object,dateFilter:String,dateRange:Object,milesEntries:Object},setup(s){const m=s;F("on-time");const v=F(m.dateFilter||"t6w"),y=F(null),b=F(null);ne(()=>{});const o=B(()=>{const n={yesterday:"yesterday","current-week":"current_week",t6w:"rolling_6_weeks",quarterly:"quarterly"}[v.value]||v.value;return j(n)}),x=a=>{v.value=a,Q.visit(route("dashboard",{tenantSlug:m.tenantSlug,dateFilter:a,minInvoiceAmount:y.value||null,outstandingDate:b.value||null}),{only:["summaries","delayBreakdowns","rejectionBreakdowns","maintenanceBreakdowns","dateFilter","dateRange","milesEntries"]})},R=[{title:m.tenantSlug?"Dashboard":"Admin Dashboard",href:m.tenantSlug?route("dashboard",{tenantSlug:m.tenantSlug}):route("admin.dashboard")},{title:"Performance Summary",href:route("dashboard",{tenantSlug:m.tenantSlug})}],h=B(()=>{var a,n;return(n=(a=m.summaries)==null?void 0:a.performance)!=null&&n.last_updated?N(new Date(m.summaries.performance.last_updated)):N(new Date)}),N=a=>new Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"}).format(a),j=a=>{var S,_;if((_=(S=m.summaries)==null?void 0:S[a])!=null&&_.date_range){const f=new Date(m.summaries[a].date_range.start+"T12:00:00"),r=new Date(m.summaries[a].date_range.end+"T12:00:00");return`${k(f)} - ${k(r)}`}const n=new Date;switch(a){case"yesterday":{const f=new Date(n);return f.setDate(f.getDate()-1),k(f)}case"current_week":{const f=new Date(n);f.setDate(n.getDate()-n.getDay());const r=new Date(f);return r.setDate(f.getDate()+6),`${k(f)} - ${k(r)}`}case"rolling_6_weeks":{const f=new Date(n);f.setDate(n.getDate()-n.getDay()+6);const r=new Date(f);return r.setDate(f.getDate()-6*7+1),`${k(r)} - ${k(f)}`}case"quarterly":{const f=new Date(n),r=new Date(n);return r.setMonth(r.getMonth()-3),`${k(r)} - ${k(f)}`}default:return""}},k=a=>new Intl.DateTimeFormat("en-US",{month:"numeric",day:"numeric",year:"numeric"}).format(a),U=B(()=>{var f,r;if(!((r=(f=m.summaries)==null?void 0:f.performance)!=null&&r.ratings))return"Not Available";const a=m.summaries.performance.ratings,n={fantastic_plus:5,fantastic:4,good:3,fair:2,poor:1},S=["average_acceptance","average_on_time","average_maintenance_variance_to_spend","open_boc","vcr_preventable","vmcr_p"];let _="fantastic_plus";for(const t of S)a[t]&&n[a[t]]<n[_]&&(_=a[t]);switch(_){case"fantastic_plus":return"Fantastic +";case"fantastic":return"Fantastic";case"good":return"Good";case"fair":return"Fair";case"poor":return"Poor";default:return"Not Available"}});return(a,n)=>(g(),$(X,{breadcrumbs:R,tenantSlug:s.tenantSlug},{default:c(()=>{var S,_,f,r,t,i,w,C,I,H;return[d(l(J),{title:"Performance Summary Dashboard"}),e("div",jt,[e("div",Ft,[n[0]||(n[0]=e("h1",{class:"text-2xl font-bold"},null,-1)),d(l(E),{variant:"outline",class:"text-sm"},{default:c(()=>[d(T,{name:"calendar",class:"mr-1 h-4 w-4"}),p(" Last updated: "+u(h.value),1)]),_:1})]),d(ge,{operationalExcellenceScore:U.value},null,8,["operationalExcellenceScore"]),d(we,{onTabChange:x,dateRangeText:o.value,weekNumber:(S=s.dateRange)==null?void 0:S.weekNumber,startWeekNumber:(_=s.dateRange)==null?void 0:_.startWeekNumber,endWeekNumber:(f=s.dateRange)==null?void 0:f.endWeekNumber,year:(r=s.dateRange)==null?void 0:r.year,activeTabId:v.value},null,8,["dateRangeText","weekNumber","startWeekNumber","endWeekNumber","year","activeTabId"]),s.summaries?(g(),$(lt,{key:0,performanceData:((t=s.summaries.performance)==null?void 0:t.data)||{},performanceRatings:((i=s.summaries.performance)==null?void 0:i.ratings)||{},safetyData:s.summaries.safety||{},delayBreakdowns:((w=s.delayBreakdowns)==null?void 0:w.by_code)||[],rejectionBreakdowns:((C=s.rejectionBreakdowns)==null?void 0:C.by_reason)||[],maintenanceBreakdowns:s.maintenanceBreakdowns||{}},null,8,["performanceData","performanceRatings","safetyData","delayBreakdowns","rejectionBreakdowns","maintenanceBreakdowns"])):V("",!0),s.summaries?(g(),$(bt,{key:1,performanceData:((I=s.summaries.performance)==null?void 0:I.data)||{},performanceRatings:((H=s.summaries.performance)==null?void 0:H.ratings)||{}},null,8,["performanceData","performanceRatings"])):V("",!0),d(Nt,{milesEntries:s.milesEntries,tenantSlug:s.tenantSlug},null,8,["milesEntries","tenantSlug"])])]}),_:1},8,["tenantSlug"]))}});export{Kt as default};
