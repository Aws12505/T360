import{_ as y}from"./Button.vue_vue_type_script_setup_true_lang-B-CPTRto.js";import{S as de,W as q,x as Q}from"./vendor-vue-o4TX1eGc.js";import{c as R,L as m,e as a,X as s,k,M as T,N as z,U as b,b as A,f as u,S as p,u as e,l as t,r as I,d as J,w as Z,b2 as N,D as oe,Y as ae,P as ee}from"./vendor-C-CW143M.js";import{_ as O}from"./Badge.vue_vue_type_script_setup_true_lang-Cb4j4dNt.js";import{j as se,af as te,q as ue,a9 as me,am as ce,E as pe,a as fe,s as F,X,Q as Y,a3 as ve,o as le}from"./vendor-icons-Dyo-jBRF.js";import{_ as M}from"./Input.vue_vue_type_script_setup_true_lang-taOxs2kk.js";import{_ as E}from"./Label.vue_vue_type_script_setup_true_lang-CZjK18aI.js";import{_ as K}from"./Checkbox.vue_vue_type_script_setup_true_lang-ChpjAJsN.js";import{_ as ne}from"./DialogFooter.vue_vue_type_script_setup_true_lang-RSN6g_4k.js";import{a as ie,_ as re}from"./DialogTitle.vue_vue_type_script_setup_true_lang-BSj40beh.js";import{_ as L}from"./InputError.vue_vue_type_script_setup_true_lang-ChN17IFy.js";const ge={class:"w-full overflow-x-auto"},xe={class:"rounded-md border"},_e={class:"w-full caption-bottom text-sm"},be={class:"[&_tr]:border-b"},ye={class:"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted"},he={key:0,class:"h-12 px-4 text-right align-middle font-medium text-muted-foreground"},ke={class:"[&_tr:last-child]:border-0"},$e={class:"p-4 align-middle font-medium"},we={class:"p-4 align-middle"},Ce={key:0,class:"p-4 align-middle text-right"},Se={class:"flex justify-end space-x-2"},Ae={key:0,class:"mt-6 flex justify-center"},Te={class:"flex flex-wrap items-center gap-1 justify-center"},ot={__name:"UserList",props:{users:Object,isSuperAdmin:{type:Boolean,default:!1},permissions:Array},setup(h){const U=h,o=R(()=>U.permissions.map(i=>i.name)),x=i=>{i&&q.get(i,{},{only:["users"]})};return(i,n)=>(a(),m("div",ge,[s("div",xe,[s("table",_e,[s("thead",be,[s("tr",ye,[n[0]||(n[0]=s("th",{class:"h-12 px-4 text-left align-middle font-medium text-muted-foreground"},"Name",-1)),n[1]||(n[1]=s("th",{class:"h-12 px-4 text-left align-middle font-medium text-muted-foreground"},"Email",-1)),o.value.includes("users.update")||o.value.includes("users.delete")?(a(),m("th",he,"Actions")):k("",!0)])]),s("tbody",ke,[(a(!0),m(T,null,z(h.users.data,f=>(a(),m("tr",{key:f.id,class:"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted"},[s("td",$e,b(f.name),1),s("td",we,b(f.email),1),o.value.includes("users.update")||o.value.includes("users.delete")?(a(),m("td",Ce,[s("div",Se,[o.value.includes("users.update")?(a(),A(e(y),{key:0,onClick:$=>i.$emit("edit",f),variant:"outline",size:"sm"},{default:u(()=>n[2]||(n[2]=[p(" Edit ")])),_:2},1032,["onClick"])):k("",!0),o.value.includes("users.delete")?(a(),A(e(y),{key:1,onClick:$=>i.$emit("delete",f),variant:"destructive",size:"sm"},{default:u(()=>n[3]||(n[3]=[p(" Delete ")])),_:2},1032,["onClick"])):k("",!0),h.isSuperAdmin?(a(),A(e(de),{key:2,href:i.route("impersonate.start",f.id),as:"button"},{default:u(()=>[t(e(y),{variant:"secondary",size:"sm"},{default:u(()=>n[4]||(n[4]=[p(" Impersonate ")])),_:1})]),_:2},1032,["href"])):k("",!0)])])):k("",!0)]))),128))])])]),h.users.links?(a(),m("div",Ae,[s("nav",Te,[(a(!0),m(T,null,z(h.users.links,f=>(a(),A(e(y),{key:f.label,onClick:$=>x(f.url),disabled:!f.url,variant:f.active?"default":"outline",size:"sm",class:"min-w-[40px]",innerHTML:f.label},null,8,["onClick","disabled","variant","innerHTML"]))),128))])])):k("",!0)]))}},ze={class:"w-full overflow-x-auto"},Pe={class:"rounded-md border"},Ee={class:"w-full caption-bottom text-sm"},Ue={class:"[&_tr]:border-b bg-muted/50"},je={class:"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted"},Le={key:0,class:"h-12 px-4 text-right align-middle font-medium text-muted-foreground"},Ve={class:"[&_tr:last-child]:border-0"},Me={class:"p-4 align-middle font-medium"},Re={class:"flex items-center"},De={class:"p-4 align-middle"},Ne={class:"flex flex-wrap gap-1"},Oe={class:"mb-2 w-full"},He={key:0,class:"w-full"},Ge={class:"text-xs font-semibold text-muted-foreground mb-1 flex items-center"},Ie={class:"flex flex-wrap gap-1 ml-4"},Be={key:0,class:"p-4 align-middle text-right"},We={class:"flex justify-end space-x-2"},Fe={key:0,class:"mt-6 flex justify-center"},Xe={class:"flex flex-wrap items-center gap-1 justify-center"},at={__name:"RoleList",props:{roles:Object,permissions:Array},setup(h){const U=h,o=R(()=>U.permissions.map(v=>v.name)),x=I([]),i=v=>{const w=x.value.indexOf(v);w===-1?x.value.push(v):x.value.splice(w,1)},n=v=>v.length,f=v=>{v&&q.get(v,{},{only:["roles"]})},$=v=>{const w={};return v.forEach(C=>{const V=C.name.split(".")[0];w[V]||(w[V]=[]),w[V].push(C)}),w},g=v=>v==="tenant-settings"?"Tenant Settings":v==="repair-orders"?"Repair Orders":v==="safety-data"?"Safety Data":v==="miles-driven"?"Miles Driven":v==="support-tickets"?"Support Tickets":v==="sms-coaching"?"SMS Coaching":v==="support-responses"?"Support Responses":v.charAt(0).toUpperCase()+v.slice(1),S=v=>{const w=v.split(".");return w.length>1?w[1].charAt(0).toUpperCase()+w[1].slice(1).replace(/-/g," "):v};return(v,w)=>(a(),m("div",ze,[s("div",Pe,[s("table",Ee,[s("thead",Ue,[s("tr",je,[w[0]||(w[0]=s("th",{class:"h-12 px-4 text-left align-middle font-medium text-muted-foreground"},"Role Name",-1)),w[1]||(w[1]=s("th",{class:"h-12 px-4 text-left align-middle font-medium text-muted-foreground"},"Permissions",-1)),o.value.includes("roles.update")||o.value.includes("roles.delete")?(a(),m("th",Le,"Actions")):k("",!0)])]),s("tbody",Ve,[(a(!0),m(T,null,z(h.roles.data,C=>(a(),m("tr",{key:C.id,class:"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted"},[s("td",Me,[s("div",Re,[t(e(se),{class:"h-4 w-4 mr-2 text-primary"}),p(" "+b(C.name),1)])]),s("td",De,[s("div",Ne,[s("div",Oe,[t(e(O),{variant:"outline",class:"mr-2"},{default:u(()=>[p(b(n(C.permissions))+" permissions ",1)]),_:2},1024),t(e(y),{variant:"ghost",size:"sm",onClick:j=>i(C.id),class:"text-xs"},{default:u(()=>[p(b(x.value.includes(C.id)?"Hide details":"Show details"),1)]),_:2},1032,["onClick"])]),x.value.includes(C.id)?(a(),m("div",He,[(a(!0),m(T,null,z($(C.permissions),(j,V)=>(a(),m("span",{key:V,class:"inline-flex flex-col mb-2 w-full"},[s("span",Ge,[t(e(te),{class:"h-3 w-3 mr-1"}),p(" "+b(g(V))+" ",1),t(e(O),{variant:"secondary",class:"ml-2"},{default:u(()=>[p(b(j.length),1)]),_:2},1024)]),s("div",Ie,[(a(!0),m(T,null,z(j,H=>(a(),m("span",{key:H.id,class:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-muted text-muted-foreground"},b(S(H.name)),1))),128))])]))),128))])):k("",!0)])]),o.value.includes("roles.update")||o.value.includes("roles.delete")?(a(),m("td",Be,[s("div",We,[o.value.includes("roles.update")?(a(),A(e(y),{key:0,onClick:j=>v.$emit("edit",C),variant:"outline",size:"sm",class:"flex items-center"},{default:u(()=>[t(e(ue),{class:"h-3.5 w-3.5 mr-1"}),w[2]||(w[2]=p(" Edit "))]),_:2},1032,["onClick"])):k("",!0),o.value.includes("roles.delete")?(a(),A(e(y),{key:1,onClick:j=>v.$emit("delete",C),variant:"destructive",size:"sm",class:"flex items-center"},{default:u(()=>[t(e(me),{class:"h-3.5 w-3.5 mr-1"}),w[3]||(w[3]=p(" Delete "))]),_:2},1032,["onClick"])):k("",!0)])])):k("",!0)]))),128))])])]),h.roles.links?(a(),m("div",Fe,[s("nav",Xe,[(a(!0),m(T,null,z(h.roles.links,C=>(a(),A(e(y),{key:C.label,onClick:j=>f(C.url),disabled:!C.url,variant:C.active?"default":"outline",size:"sm",class:"min-w-[40px]",innerHTML:C.label},null,8,["onClick","disabled","variant","innerHTML"]))),128))])])):k("",!0)]))}},Ye={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ke={class:"space-y-2"},qe={class:"space-y-2"},Qe={class:"space-y-2 md:col-span-2"},Je={key:0,class:"text-destructive ml-1"},Ze={class:"relative"},es={key:0,class:"space-y-2 md:col-span-2"},ss=["value"],ts={class:"grid grid-cols-1 md:grid-cols-2 gap-4 pt-2"},ls={class:"space-y-2"},ns={class:"flex justify-between items-center"},is={class:"relative"},rs={class:"flex items-center space-x-2"},os={class:"relative w-full"},as={class:"h-60 border rounded-md p-2 overflow-y-auto"},ds={key:0,class:"flex flex-col items-center justify-center h-full text-muted-foreground"},us={class:"space-y-2"},ms={class:"flex justify-between items-center"},cs={class:"flex space-x-2"},ps={class:"relative"},fs={class:"flex items-center space-x-2"},vs={class:"relative w-full"},gs={class:"h-60 border rounded-md p-2 overflow-y-auto"},xs={class:"flex items-center justify-between mb-1"},_s={class:"font-medium text-sm text-foreground flex items-center"},bs={class:"flex space-x-1"},ys={key:0,class:"ml-2 text-xs px-2 py-0.5 rounded-full border border-gray-200 bg-gray-100 dark:border-gray-700 dark:bg-gray-800 text-gray-600 dark:text-gray-300"},hs={key:0,class:"flex flex-col items-center justify-center h-full text-muted-foreground"},dt=J({__name:"UserForm",props:{user:{type:Object,default:null},tenants:{type:Array,default:()=>[]},roles:{type:Array,default:()=>[]},permissions:{type:Array,default:()=>[]},isSuperAdmin:{type:Boolean,default:!1},tenantSlug:{type:String,default:null}},emits:["close","saved"],setup(h,{emit:U}){const o=h,x=U,i=Q({name:o.user?o.user.name:"",email:o.user?o.user.email:"",password:o.user?o.user.password:"",tenant_id:o.user?o.user.tenant_id:o.tenants.length?o.tenants[0].id:null,roles:o.user&&o.user.roles?o.user.roles.map(r=>r.id):[],user_permissions:o.user&&o.user.permissions?o.user.permissions.map(r=>r.name):[]}),n=I(""),f=I(""),$=I(!1),g=R(()=>{if(!n.value.trim())return o.roles;const r=n.value.toLowerCase();return o.roles.filter(l=>l.name.toLowerCase().includes(r))}),S=R(()=>i.user_permissions.length),v=R(()=>{const r=new Set;return o.roles.forEach(l=>{i.roles.includes(l.id)&&l.permissions&&l.permissions.forEach(d=>{r.add(d.name)})}),Array.from(r)});Z(()=>o.user,r=>{r?(i.name=r.name,i.email=r.email,i.password=r.password,i.tenant_id=r.tenant_id,i.roles=r.roles?r.roles.map(l=>l.id):[],i.user_permissions=r.permissions?r.permissions.map(l=>l.name):[]):(i.name="",i.email="",i.password="",i.tenant_id=null,i.roles=[],i.user_permissions=[])},{immediate:!0});const w=()=>{o.user?o.isSuperAdmin?i.put(route("admin.users.update",o.user),{onSuccess:()=>{x("saved")}}):i.put(route("users.update",[o.tenantSlug,o.user]),{onSuccess:()=>{x("saved")}}):o.isSuperAdmin?i.post(route("admin.users.store"),{onSuccess:()=>{x("saved")}}):i.post(route("users.store",o.tenantSlug),{onSuccess:()=>{x("saved")}})},C=r=>{const l=i.roles.indexOf(r);l===-1?i.roles.push(r):i.roles.splice(l,1)},j=r=>{if(v.value.includes(r))return;const l=i.user_permissions.indexOf(r);l===-1?i.user_permissions.push(r):i.user_permissions.splice(l,1)},V=()=>{o.permissions.forEach(r=>{!v.value.includes(r.name)&&!i.user_permissions.includes(r.name)&&i.user_permissions.push(r.name)})},H=()=>{i.user_permissions=[]},W=r=>{o.permissions.filter(d=>d.name.startsWith(r+".")).map(d=>d.name).forEach(d=>{!i.user_permissions.includes(d)&&!v.value.includes(d)&&i.user_permissions.push(d)})},B=r=>{i.user_permissions=i.user_permissions.filter(l=>!l.startsWith(r+"."))},G=R(()=>{const r=f.value.trim()?o.permissions.filter(d=>d.name.toLowerCase().includes(f.value.toLowerCase())):o.permissions,l={};return r.forEach(d=>{const P=d.name.split(".")[0];l[P]||(l[P]=[]),l[P].push(d)}),l}),_=r=>r==="tenant-settings"?"Tenant Settings":r==="repair-orders"?"Repair Orders":r==="safety-data"?"Safety Data":r==="miles-driven"?"Miles Driven":r==="support-tickets"?"Support Tickets":r==="sms-coaching"?"SMS Coaching":r==="support-responses"?"Support Responses":r==="receive_updates"?"General":r.charAt(0).toUpperCase()+r.slice(1),c=r=>{const l=r.split(".");return l.length>1?l[1].charAt(0).toUpperCase()+l[1].slice(1).replace(/-/g," "):r};return(r,l)=>(a(),m("div",null,[t(e(re),null,{default:u(()=>[t(e(ie),{class:"text-xl sm:text-2xl font-bold flex items-center"},{default:u(()=>[t(e(ce),{class:"h-5 w-5 mr-2 text-primary"}),p(" "+b(h.user?"Edit User":"Create User"),1)]),_:1})]),_:1}),s("form",{onSubmit:ee(w,["prevent"]),class:"space-y-4 mt-4"},[s("div",Ye,[s("div",Ke,[t(e(E),{for:"name",class:"flex items-center"},{default:u(()=>l[10]||(l[10]=[s("span",null,"Name",-1),s("span",{class:"text-destructive ml-1"},"*",-1)])),_:1}),t(e(M),{id:"name",modelValue:e(i).name,"onUpdate:modelValue":l[0]||(l[0]=d=>e(i).name=d),placeholder:"Enter name",class:N(["w-full",{"border-destructive":e(i).errors.name}])},null,8,["modelValue","class"]),t(L,{message:e(i).errors.name},null,8,["message"])]),s("div",qe,[t(e(E),{for:"email",class:"flex items-center"},{default:u(()=>l[11]||(l[11]=[s("span",null,"Email",-1),s("span",{class:"text-destructive ml-1"},"*",-1)])),_:1}),t(e(M),{id:"email",modelValue:e(i).email,"onUpdate:modelValue":l[1]||(l[1]=d=>e(i).email=d),type:"email",placeholder:"Enter email",class:N(["w-full",{"border-destructive":e(i).errors.email}])},null,8,["modelValue","class"]),t(L,{message:e(i).errors.email},null,8,["message"])]),s("div",Qe,[t(e(E),{for:"password",class:"flex items-center"},{default:u(()=>[l[12]||(l[12]=s("span",null,"Password",-1)),h.user?k("",!0):(a(),m("span",Je,"*"))]),_:1}),s("div",Ze,[t(e(M),{id:"password",modelValue:e(i).password,"onUpdate:modelValue":l[2]||(l[2]=d=>e(i).password=d),type:$.value?"text":"password",placeholder:"Enter password",class:N(["w-full pr-10",{"border-destructive":e(i).errors.password}])},null,8,["modelValue","type","class"]),s("button",{type:"button",onClick:l[3]||(l[3]=d=>$.value=!$.value),class:"absolute inset-y-0 right-0 flex items-center pr-3 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200"},[$.value?(a(),A(e(fe),{key:1,class:"h-5 w-5"})):(a(),A(e(pe),{key:0,class:"h-5 w-5"}))])]),t(L,{message:e(i).errors.password},null,8,["message"])]),h.isSuperAdmin?(a(),m("div",es,[t(e(E),{for:"tenant"},{default:u(()=>l[13]||(l[13]=[p("Company Name")])),_:1}),oe(s("select",{id:"tenant","onUpdate:modelValue":l[4]||(l[4]=d=>e(i).tenant_id=d),class:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50"},[l[14]||(l[14]=s("option",{value:null},"None",-1)),(a(!0),m(T,null,z(h.tenants,d=>(a(),m("option",{value:d.id,key:d.id},b(d.name),9,ss))),128))],512),[[ae,e(i).tenant_id]]),t(L,{message:e(i).errors.tenant_id},null,8,["message"])])):k("",!0)]),s("div",ts,[s("div",ls,[s("div",ns,[t(e(E),{class:"flex items-center"},{default:u(()=>[t(e(se),{class:"h-4 w-4 mr-1 text-primary"}),l[15]||(l[15]=s("span",null,"Roles",-1)),t(e(O),{variant:"outline",class:"ml-2"},{default:u(()=>[p(b(e(i).roles.length)+" selected",1)]),_:1})]),_:1})]),s("div",is,[s("div",rs,[s("div",os,[t(e(F),{class:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),t(e(M),{modelValue:n.value,"onUpdate:modelValue":l[5]||(l[5]=d=>n.value=d),placeholder:"Search roles...",class:"w-full pl-9"},null,8,["modelValue"])]),n.value?(a(),A(e(y),{key:0,type:"button",variant:"ghost",size:"icon",onClick:l[6]||(l[6]=d=>n.value=""),class:"absolute right-2 top-2"},{default:u(()=>[t(e(X),{class:"h-4 w-4"})]),_:1})):k("",!0)])]),s("div",as,[(a(!0),m(T,null,z(g.value,d=>(a(),m("div",{key:d.id,class:"flex items-center py-1 px-2 hover:bg-muted/50 rounded transition-colors"},[t(e(K),{id:`role-${d.id}`,checked:e(i).roles.includes(d.id),"onUpdate:checked":D=>C(d.id),class:"mr-2"},null,8,["id","checked","onUpdate:checked"]),t(e(E),{for:`role-${d.id}`,class:"cursor-pointer"},{default:u(()=>[p(b(d.name),1)]),_:2},1032,["for"])]))),128)),g.value.length===0?(a(),m("div",ds,[t(e(Y),{class:"h-8 w-8 mb-2"}),l[16]||(l[16]=s("p",null,"No roles match your search",-1))])):k("",!0)]),t(L,{message:e(i).errors.roles},null,8,["message"])]),s("div",us,[s("div",ms,[t(e(E),{class:"flex items-center"},{default:u(()=>[t(e(ve),{class:"h-4 w-4 mr-1 text-primary"}),l[17]||(l[17]=s("span",null,"Permissions",-1)),t(e(O),{variant:"outline",class:"ml-2"},{default:u(()=>[p(b(S.value)+" selected",1)]),_:1})]),_:1}),s("div",cs,[t(e(y),{type:"button",variant:"outline",size:"sm",onClick:V,class:"text-xs"},{default:u(()=>l[18]||(l[18]=[p(" Select All ")])),_:1}),t(e(y),{type:"button",variant:"outline",size:"sm",onClick:H,class:"text-xs"},{default:u(()=>l[19]||(l[19]=[p(" Clear All ")])),_:1})])]),s("div",ps,[s("div",fs,[s("div",vs,[t(e(F),{class:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),t(e(M),{modelValue:f.value,"onUpdate:modelValue":l[7]||(l[7]=d=>f.value=d),placeholder:"Search permissions...",class:"w-full pl-9"},null,8,["modelValue"])]),f.value?(a(),A(e(y),{key:0,type:"button",variant:"ghost",size:"icon",onClick:l[8]||(l[8]=d=>f.value=""),class:"absolute right-2 top-2"},{default:u(()=>[t(e(X),{class:"h-4 w-4"})]),_:1})):k("",!0)])]),s("div",gs,[(a(!0),m(T,null,z(G.value,(d,D)=>(a(),m("div",{key:D,class:"mb-4"},[s("div",xs,[s("div",_s,[t(e(te),{class:"h-4 w-4 mr-1 text-muted-foreground"}),p(" "+b(_(D))+" ",1),t(e(O),{variant:"secondary",class:"ml-2"},{default:u(()=>[p(b(d.length),1)]),_:2},1024)]),s("div",bs,[t(e(y),{type:"button",variant:"ghost",size:"sm",onClick:P=>W(D),class:"text-xs h-6 px-2"},{default:u(()=>l[20]||(l[20]=[p(" Select All ")])),_:2},1032,["onClick"]),t(e(y),{type:"button",variant:"ghost",size:"sm",onClick:P=>B(D),class:"text-xs h-6 px-2"},{default:u(()=>l[21]||(l[21]=[p(" Clear ")])),_:2},1032,["onClick"])])]),(a(!0),m(T,null,z(d,P=>(a(),m("div",{key:P.id,class:"flex items-center py-1 px-2 hover:bg-muted/50 rounded transition-colors"},[t(e(K),{id:`permission-${P.name}`,checked:e(i).user_permissions.includes(P.name),"onUpdate:checked":Ks=>j(P.name),disabled:v.value.includes(P.name),class:"mr-2"},null,8,["id","checked","onUpdate:checked","disabled"]),t(e(E),{for:`permission-${P.name}`,class:"cursor-pointer text-sm"},{default:u(()=>[p(b(c(P.name))+" ",1),v.value.includes(P.name)?(a(),m("span",ys," inherited ")):k("",!0)]),_:2},1032,["for"])]))),128))]))),128)),Object.keys(G.value).length===0?(a(),m("div",hs,[t(e(Y),{class:"h-8 w-8 mb-2"}),l[22]||(l[22]=s("p",null,"No permissions match your search",-1))])):k("",!0)]),t(L,{message:e(i).errors.user_permissions},null,8,["message"])])]),t(e(ne),{class:"mt-6"},{default:u(()=>[t(e(y),{type:"button",onClick:l[9]||(l[9]=()=>x("close")),variant:"outline"},{default:u(()=>l[23]||(l[23]=[p(" Cancel ")])),_:1}),t(e(y),{type:"submit",disabled:e(i).processing},{default:u(()=>[e(i).processing?(a(),A(e(le),{key:0,class:"mr-2 h-4 w-4 animate-spin"})):k("",!0),p(" "+b(e(i).processing?"Saving...":"Save"),1)]),_:1},8,["disabled"])]),_:1})],32)]))}}),ks={class:"w-full overflow-x-auto"},$s={class:"rounded-md border"},ws={class:"w-full caption-bottom text-sm"},Cs={class:"[&_tr:last-child]:border-0"},Ss={class:"p-4 align-middle font-medium"},As={class:"p-4 align-middle"},Ts={class:"p-4 align-middle"},zs={class:"p-4 align-middle text-right"},Ps={class:"flex justify-end space-x-2"},Es={key:0,class:"mt-6 flex justify-center"},Us={class:"flex flex-wrap items-center gap-1 justify-center"},ut={__name:"TenantList",props:{tenants:{type:Object,default:()=>({data:[],links:[]})}},setup(h){const U=h,o={"America/New_York":"Eastern Time (ET)","America/Chicago":"Central Time (CT)","America/Denver":"Mountain Time (MT)","America/Los_Angeles":"Pacific Time (PT)","America/Anchorage":"Alaska Time (AKT)","Pacific/Honolulu":"Hawaii Time (HAST)","America/Phoenix":"Arizona Time (no DST)","America/Indiana/Indianapolis":"Eastern Time (Indiana)"},x=f=>o[f]||f,i=R(()=>Array.isArray(U.tenants)?U.tenants:U.tenants.data||[]),n=f=>{f&&q.get(f,{},{only:["tenants"]})};return(f,$)=>(a(),m("div",ks,[s("div",$s,[s("table",ws,[$[2]||($[2]=s("thead",{class:"[&_tr]:border-b"},[s("tr",{class:"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted"},[s("th",{class:"h-12 px-4 text-left align-middle font-medium text-muted-foreground"},"Company Name"),s("th",{class:"h-12 px-4 text-left align-middle font-medium text-muted-foreground"},"Slug"),s("th",{class:"h-12 px-4 text-left align-middle font-medium text-muted-foreground"},"Timezone"),s("th",{class:"h-12 px-4 text-right pr-16 align-middle font-medium text-muted-foreground"},"Actions")])],-1)),s("tbody",Cs,[(a(!0),m(T,null,z(i.value,g=>(a(),m("tr",{key:g.id,class:"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted"},[s("td",Ss,b(g.name),1),s("td",As,b(g.slug),1),s("td",Ts,b(x(g.timezone)),1),s("td",zs,[s("div",Ps,[t(e(y),{onClick:S=>f.$emit("edit",g),variant:"outline",size:"sm"},{default:u(()=>$[0]||($[0]=[p(" Edit ")])),_:2},1032,["onClick"]),t(e(y),{onClick:S=>f.$emit("delete",g),variant:"destructive",size:"sm"},{default:u(()=>$[1]||($[1]=[p(" Delete ")])),_:2},1032,["onClick"])])])]))),128))])])]),h.tenants.links?(a(),m("div",Es,[s("nav",Us,[(a(!0),m(T,null,z(h.tenants.links,g=>(a(),A(e(y),{key:g.label,onClick:S=>n(g.url),disabled:!g.url,variant:g.active?"default":"outline",size:"sm",class:"min-w-[40px]",innerHTML:g.label},null,8,["onClick","disabled","variant","innerHTML"]))),128))])])):k("",!0)]))}},js={class:"space-y-2"},Ls={key:0,class:"space-y-2"},Vs={class:"space-y-2"},Ms=["value"],mt=J({__name:"TenantForm",props:{tenant:{type:Object,default:null}},emits:["close","saved"],setup(h,{emit:U}){const o=h,x=U,i={"America/New_York":"Eastern Time (ET)","America/Chicago":"Central Time (CT)","America/Denver":"Mountain Time (MT)","America/Los_Angeles":"Pacific Time (PT)","America/Anchorage":"Alaska Time (AKT)","Pacific/Honolulu":"Hawaii Time (HAST)","America/Phoenix":"Arizona Time (no DST)","America/Indiana/Indianapolis":"Eastern Time (Indiana)"},n=Q({name:o.tenant?o.tenant.name:"",slug:o.tenant?o.tenant.slug:"",timezone:o.tenant?o.tenant.timezone:"America/Indiana/Indianapolis"});Z(()=>o.tenant,$=>{$?(n.name=$.name,n.slug=$.slug,n.timezone=$.timezone):(n.name="",n.slug="",n.timezone="America/Indiana/Indianapolis")},{immediate:!0});const f=()=>{o.tenant?n.put(route("admin.tenants.update",o.tenant),{onSuccess:()=>{x("saved")}}):n.post(route("admin.tenants.store"),{onSuccess:()=>{x("saved")}})};return($,g)=>(a(),m("div",null,[t(e(re),null,{default:u(()=>[t(e(ie),{class:"text-xl sm:text-2xl font-bold"},{default:u(()=>[p(b(h.tenant?"Edit Company":"Create Company"),1)]),_:1})]),_:1}),s("form",{onSubmit:ee(f,["prevent"]),class:"space-y-4 mt-4"},[s("div",js,[t(e(E),{for:"name",class:"flex items-center"},{default:u(()=>g[4]||(g[4]=[s("span",null,"Company Name",-1),s("span",{class:"text-destructive ml-1"},"*",-1)])),_:1}),t(e(M),{id:"name",modelValue:e(n).name,"onUpdate:modelValue":g[0]||(g[0]=S=>e(n).name=S),placeholder:"Enter company name",class:N(["w-full",{"border-destructive":e(n).errors.name}])},null,8,["modelValue","class"]),t(L,{message:e(n).errors.name},null,8,["message"])]),h.tenant?(a(),m("div",Ls,[t(e(E),{for:"slug"},{default:u(()=>g[5]||(g[5]=[p("Slug")])),_:1}),t(e(M),{id:"slug",modelValue:e(n).slug,"onUpdate:modelValue":g[1]||(g[1]=S=>e(n).slug=S),placeholder:"Enter company slug",class:N(["w-full",{"border-destructive":e(n).errors.slug}])},null,8,["modelValue","class"]),t(L,{message:e(n).errors.slug},null,8,["message"])])):k("",!0),s("div",Vs,[t(e(E),{for:"timezone",class:"flex items-center"},{default:u(()=>g[6]||(g[6]=[s("span",null,"Timezone",-1),s("span",{class:"text-destructive ml-1"},"*",-1)])),_:1}),oe(s("select",{id:"timezone","onUpdate:modelValue":g[2]||(g[2]=S=>e(n).timezone=S),class:N(["flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",{"border-destructive":e(n).errors.timezone}])},[(a(),m(T,null,z(i,(S,v)=>s("option",{key:v,value:v},b(S),9,Ms)),64))],2),[[ae,e(n).timezone]]),t(L,{message:e(n).errors.timezone},null,8,["message"])]),t(e(ne),{class:"mt-6"},{default:u(()=>[t(e(y),{type:"button",onClick:g[3]||(g[3]=()=>x("close")),variant:"outline"},{default:u(()=>g[7]||(g[7]=[p(" Cancel ")])),_:1}),t(e(y),{type:"submit",disabled:e(n).processing},{default:u(()=>[e(n).processing?(a(),A(e(le),{key:0,class:"mr-2 h-4 w-4 animate-spin"})):k("",!0),p(" "+b(e(n).processing?"Saving...":"Save"),1)]),_:1},8,["disabled"])]),_:1})],32)]))}}),Rs={class:"space-y-2"},Ds={class:"space-y-2"},Ns={class:"flex justify-between items-center"},Os={class:"flex space-x-2"},Hs={class:"relative"},Gs={class:"flex items-center space-x-2"},Is={class:"relative w-full"},Bs={class:"h-64 border rounded-md p-2 overflow-y-auto"},Ws={class:"flex items-center justify-between mb-1"},Fs={class:"font-medium text-sm text-foreground flex items-center"},Xs={class:"flex space-x-1"},Ys={key:0,class:"flex flex-col items-center justify-center h-full text-muted-foreground"},ct=J({__name:"RoleForm",props:{role:{type:Object,default:null},permissions:{type:Array,default:()=>[]},isSuperAdmin:{type:Boolean,default:!1},tenantSlug:{type:String,default:null}},emits:["saved","close"],setup(h,{emit:U}){var B,G;const o=U,x=h,{tenantSlug:i}=x,n=Q({name:x.role?x.role.name:"",permissions:((G=(B=x.role)==null?void 0:B.permissions)==null?void 0:G.map(_=>_.name))||[]}),f=I(""),$=R(()=>n.permissions.length),g=R(()=>{const _=f.value.trim()?x.permissions.filter(r=>r.name.toLowerCase().includes(f.value.toLowerCase())):x.permissions,c={};return _.forEach(r=>{const d=r.name.split(".")[0];c[d]||(c[d]=[]),c[d].push(r)}),c}),S=_=>_==="tenant-settings"?"Tenant Settings":_==="repair-orders"?"Repair Orders":_==="safety-data"?"Safety Data":_==="miles-driven"?"Miles Driven":_==="support-tickets"?"Support Tickets":_==="sms-coaching"?"SMS Coaching":_==="support-responses"?"Support Responses":_==="receive_updates"?"General":_.charAt(0).toUpperCase()+_.slice(1),v=_=>{const c=_.split(".");return c.length>1?c[1].charAt(0).toUpperCase()+c[1].slice(1).replace(/-/g," "):_};Z(()=>x.role,_=>{var c;_?(n.name=_.name,n.permissions=((c=_.permissions)==null?void 0:c.map(r=>r.name))||[]):(n.name="",n.permissions=[])},{immediate:!0});const w=_=>{const c=n.permissions.indexOf(_);c===-1?n.permissions.push(_):n.permissions.splice(c,1)},C=()=>{n.permissions=x.permissions.map(_=>_.name)},j=()=>{n.permissions=[]},V=_=>{x.permissions.filter(r=>r.name.startsWith(_+".")).map(r=>r.name).forEach(r=>{n.permissions.includes(r)||n.permissions.push(r)})},H=_=>{n.permissions=n.permissions.filter(c=>!c.startsWith(_+"."))},W=()=>{x.role?x.isSuperAdmin?n.put(route("admin.roles.update",x.role.id),{onSuccess:()=>{o("saved")}}):n.put(route("roles.update",[i,x.role.id]),{onSuccess:()=>{o("saved")}}):x.isSuperAdmin?n.post(route("admin.roles.store"),{onSuccess:()=>{o("saved")}}):n.post(route("roles.store",i),{onSuccess:()=>{o("saved")}})};return(_,c)=>(a(),m("div",null,[t(e(re),null,{default:u(()=>[t(e(ie),{class:"text-xl sm:text-2xl font-bold flex items-center"},{default:u(()=>[t(e(se),{class:"h-5 w-5 mr-2 text-primary"}),p(" "+b(h.role?"Edit Role":"Create Role"),1)]),_:1})]),_:1}),s("form",{onSubmit:ee(W,["prevent"]),class:"space-y-4 mt-4"},[s("div",Rs,[t(e(E),{for:"name",class:"flex items-center"},{default:u(()=>c[4]||(c[4]=[s("span",null,"Role Name",-1),s("span",{class:"text-destructive ml-1"},"*",-1)])),_:1}),t(e(M),{id:"name",modelValue:e(n).name,"onUpdate:modelValue":c[0]||(c[0]=r=>e(n).name=r),placeholder:"Enter role name",class:N(["w-full",{"border-destructive":e(n).errors.name}]),autofocus:""},null,8,["modelValue","class"]),t(L,{message:e(n).errors.name},null,8,["message"])]),s("div",Ds,[s("div",Ns,[t(e(E),{class:"flex items-center"},{default:u(()=>[c[5]||(c[5]=s("span",null,"Permissions",-1)),t(e(O),{variant:"outline",class:"ml-2"},{default:u(()=>[p(b($.value)+" selected",1)]),_:1})]),_:1}),s("div",Os,[t(e(y),{type:"button",variant:"outline",size:"sm",onClick:C,class:"text-xs"},{default:u(()=>c[6]||(c[6]=[p(" Select All ")])),_:1}),t(e(y),{type:"button",variant:"outline",size:"sm",onClick:j,class:"text-xs"},{default:u(()=>c[7]||(c[7]=[p(" Clear All ")])),_:1})])]),s("div",Hs,[s("div",Gs,[s("div",Is,[t(e(F),{class:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),t(e(M),{modelValue:f.value,"onUpdate:modelValue":c[1]||(c[1]=r=>f.value=r),placeholder:"Search permissions...",class:"w-full pl-9"},null,8,["modelValue"])]),f.value?(a(),A(e(y),{key:0,type:"button",variant:"ghost",size:"icon",onClick:c[2]||(c[2]=r=>f.value=""),class:"absolute right-2 top-2"},{default:u(()=>[t(e(X),{class:"h-4 w-4"})]),_:1})):k("",!0)])]),s("div",Bs,[(a(!0),m(T,null,z(g.value,(r,l)=>(a(),m("div",{key:l,class:"mb-4"},[s("div",Ws,[s("div",Fs,[t(e(te),{class:"h-4 w-4 mr-1 text-muted-foreground"}),p(" "+b(S(l))+" ",1),t(e(O),{variant:"secondary",class:"ml-2"},{default:u(()=>[p(b(r.length),1)]),_:2},1024)]),s("div",Xs,[t(e(y),{type:"button",variant:"ghost",size:"sm",onClick:d=>V(l),class:"text-xs h-6 px-2"},{default:u(()=>c[8]||(c[8]=[p(" Select All ")])),_:2},1032,["onClick"]),t(e(y),{type:"button",variant:"ghost",size:"sm",onClick:d=>H(l),class:"text-xs h-6 px-2"},{default:u(()=>c[9]||(c[9]=[p(" Clear ")])),_:2},1032,["onClick"])])]),(a(!0),m(T,null,z(r,d=>(a(),m("div",{key:d.id,class:"flex items-center py-1 px-2 hover:bg-muted/50 rounded transition-colors"},[t(e(K),{id:`permission-${d.name}`,checked:e(n).permissions.includes(d.name),"onUpdate:checked":D=>w(d.name),class:"mr-2"},null,8,["id","checked","onUpdate:checked"]),t(e(E),{for:`permission-${d.name}`,class:"cursor-pointer text-sm"},{default:u(()=>[p(b(v(d.name)),1)]),_:2},1032,["for"])]))),128))]))),128)),Object.keys(g.value).length===0?(a(),m("div",Ys,[t(e(Y),{class:"h-8 w-8 mb-2"}),c[10]||(c[10]=s("p",null,"No permissions match your search",-1))])):k("",!0)]),t(L,{message:e(n).errors.permissions},null,8,["message"])]),t(e(ne),{class:"mt-6"},{default:u(()=>[t(e(y),{type:"button",onClick:c[3]||(c[3]=()=>o("close")),variant:"outline"},{default:u(()=>c[11]||(c[11]=[p(" Cancel ")])),_:1}),t(e(y),{type:"submit",disabled:e(n).processing},{default:u(()=>[e(n).processing?(a(),A(e(le),{key:0,class:"mr-2 h-4 w-4 animate-spin"})):k("",!0),p(" "+b(e(n).processing?"Saving...":"Save"),1)]),_:1},8,["disabled"])]),_:1})],32)]))}});export{ot as _,at as a,ut as b,dt as c,mt as d,ct as e};
