import{_ as G}from"./Button.vue_vue_type_script_setup_true_lang-CZMgI4AI.js";import{_ as tt}from"./Card.vue_vue_type_script_setup_true_lang-Cv_RhfZi.js";import{_ as et}from"./CardContent.vue_vue_type_script_setup_true_lang-CJoJj2cM.js";import{_ as O}from"./Icon.vue_vue_type_script_setup_true_lang-C-mirX2J.js";import{B as C,A as h,E as B,a0 as st,L as at,N as o,O as k,a1 as v,I as w,an as t,a7 as n,a6 as Z,af as l,a9 as b,aa as p,ae as L,aW as E}from"./vendor-DW_gyfXE.js";import"./utils-BCw79v42.js";import"./vendor-ui-m5Us76-N.js";import"./vendor-icons-DY85x-Wz.js";import"./vendor-d3-CjigyTW8.js";const ot={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},nt={class:"bg-muted/20 rounded-lg p-4"},rt={class:"text-4xl font-bold text-primary"},lt={class:"bg-muted/20 rounded-lg p-4"},it={class:"space-y-2"},dt={key:0},ct={class:"text-foreground"},ut={class:"text-primary font-medium"},mt={key:1,class:"text-center text-muted-foreground italic"},gt={class:"bg-muted/20 rounded-lg p-4"},ft={class:"space-y-2"},ht={key:0},vt={class:"text-foreground"},bt={class:"text-destructive font-medium"},pt={key:1,class:"text-center text-muted-foreground italic"},_t={class:"mt-6"},xt={class:"grid grid-cols-2 md:grid-cols-5 gap-4"},yt={class:"text-sm text-muted-foreground mb-2"},Ct={class:"text-2xl font-bold text-primary"},kt={class:"mt-6"},wt={class:"grid grid-cols-2 md:grid-cols-5 gap-4"},St={class:"text-sm text-muted-foreground mb-2"},Mt={class:"text-2xl font-bold text-primary"},Dt={key:0,class:"mt-4 text-center"},Tt={key:1,class:"mt-4"},$t={class:"grid grid-cols-2 md:grid-cols-5 gap-4"},Vt={class:"text-sm text-muted-foreground mb-2"},At={class:"text-2xl font-bold text-primary"},It={class:"mt-6 text-center"},Zt={key:0,class:"mt-6"},Nt={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},jt={class:"bg-muted/20 rounded-lg p-4"},Gt={class:"w-full h-64"},Ot={class:"bg-muted/20 rounded-lg p-4"},Bt={class:"flex justify-center items-center h-72"},Lt={class:"w-full h-full"},Jt={__name:"SafetySummary",props:{data:{type:Object,default:()=>({})}},setup(i){const c=i,S=C(null),M=C(null);let D=null,T=null;const F=r=>r.replace(/([A-Z])/g," $1").replace(/^./,e=>e.toUpperCase()).trim(),N=r=>r.replace(/([A-Z])/g," $1").replace(/^./,e=>e.toUpperCase()).trim(),u=C(!1),d=C(!1),j=h(()=>Object.entries(c.data.infractions||{}).sort((e,s)=>s[1]-e[1])),z=h(()=>{const r={};return j.value.slice(0,5).forEach(([e,s])=>{r[e]=s}),r}),$=h(()=>{const r={};return j.value.slice(5).forEach(([e,s])=>{r[e]=s}),r}),R=h(()=>Object.keys($.value).length>0),U=h(()=>Object.keys($.value).length),W=()=>{u.value=!u.value},H=()=>{d.value=!d.value,d.value&&setTimeout(()=>{_()},100)},P=[45,25,15,10,5],q=["Distracted Driving","Speeding","Sign Violations","Traffic Light Violations","Following Distance"],_=()=>{var r,e;if(D&&D.destroy(),T&&T.destroy(),S.value){const s=S.value.getContext("2d");if(s){const a=((r=c.data.lineChartData)==null?void 0:r.map(f=>f.greenZoneScore))||[],m=a.length>0?Math.min(...a):0,g=a.length>0?Math.max(...a):100,x=g-m,y=x*.1,A=Math.max(0,m-y),I=g+y;D=new E(s,{type:"line",data:{labels:((e=c.data.lineChartData)==null?void 0:e.map(f=>f.date))||[],datasets:[{label:"Green Zone Score",data:a,borderColor:"#10b981",backgroundColor:"rgba(16, 185, 129, 0.1)",tension:.3}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!(m>10),min:A,max:I,ticks:{stepSize:Math.ceil(x/5)}}},plugins:{tooltip:{callbacks:{label:function(f){const K=f.raw||0,Q=c.data.greenZoneScore||0,X=c.data.dateRangeLabel||"selected period",Y=Number(Q).toFixed(2);return[`Green Zone Score: ${K}`,`Average Score Over ${X}: ${Y}`]}}}}}})}}if(M.value){const s=M.value.getContext("2d");s&&(T=new E(s,{type:"doughnut",data:{labels:q,datasets:[{data:P,backgroundColor:["#10b981","#f59e0b","#ef4444","#6366f1","#8b5cf6"],borderWidth:1}]},options:{responsive:!0,maintainAspectRatio:!1,cutout:"60%",plugins:{legend:{position:"bottom",labels:{padding:20,usePointStyle:!0,pointStyle:"circle",boxWidth:10}},tooltip:{callbacks:{label:function(a){const m=a.label||"",g=a.raw||0,x=a.dataset.data.reduce((A,I)=>A+I,0),y=Math.round(g/x*100);return`${m}: ${g} (${y}%)`}}}}}}))}};B(d,r=>{r&&setTimeout(()=>{_()},100)});let V=null;const J=()=>{V&&clearTimeout(V),V=setTimeout(()=>{_()},100)};return B(()=>c.data,()=>{d.value&&J()},{deep:!0}),st(()=>{d.value&&setTimeout(()=>{_()},100)}),(r,e)=>(o(),at(w(tt),{class:"bg-background dark:bg-background"},{default:k(()=>[v(w(et),{class:"p-4"},{default:k(()=>[t("div",ot,[t("div",nt,[e[0]||(e[0]=t("h3",{class:"text-lg font-semibold text-foreground mb-2"},"Green Zone Score",-1)),t("div",rt,l(Math.round(i.data.greenZoneScore)),1)]),t("div",lt,[e[1]||(e[1]=t("h3",{class:"text-lg font-semibold text-foreground mb-2"},"Top 5 Drivers",-1)),t("div",it,[i.data.topDrivers&&i.data.topDrivers.length>0?(o(),n("div",dt,[(o(!0),n(b,null,p(i.data.topDrivers,(s,a)=>(o(),n("div",{key:a,class:"flex justify-between items-center"},[t("span",ct,l(s.name),1),t("span",ut,l(Math.round(s.score)),1)]))),128))])):(o(),n("div",mt," No driver data available "))])]),t("div",gt,[e[2]||(e[2]=t("h3",{class:"text-lg font-semibold text-foreground mb-2"},"Bottom 5 Drivers",-1)),t("div",ft,[i.data.bottomDrivers&&i.data.bottomDrivers.length>0?(o(),n("div",ht,[(o(!0),n(b,null,p(i.data.bottomDrivers,(s,a)=>(o(),n("div",{key:a,class:"flex justify-between items-center"},[t("span",vt,l(s.name),1),t("span",bt,l(Math.round(s.score)),1)]))),128))])):(o(),n("div",pt," No driver data available "))])])]),t("div",_t,[e[3]||(e[3]=t("h3",{class:"text-lg font-semibold text-foreground mb-4"},"Total Severe Alerts",-1)),t("div",xt,[(o(!0),n(b,null,p(i.data.alerts,(s,a)=>(o(),n("div",{key:a,class:"bg-muted/20 rounded-lg p-4 text-center"},[t("div",yt,l(F(a)),1),t("div",Ct,l(Math.floor(s)),1)]))),128))])]),t("div",kt,[e[4]||(e[4]=t("h3",{class:"text-lg font-semibold text-foreground mb-4"},"Other Severe Safety Infractions",-1)),t("div",wt,[(o(!0),n(b,null,p(z.value,(s,a)=>(o(),n("div",{key:a,class:"bg-muted/20 rounded-lg p-4 text-center"},[t("div",St,l(N(a)),1),t("div",Mt,l(Math.round(s)),1)]))),128))]),R.value?(o(),n("div",Dt,[v(w(G),{onClick:W,variant:"outline",class:"w-full md:w-auto"},{default:k(()=>[v(O,{name:u.value?"chevron-up":"chevron-down",class:"mr-2 h-4 w-4"},null,8,["name"]),L(" "+l(u.value?"Show Less":`Show ${U.value} More`),1)]),_:1})])):Z("",!0),u.value?(o(),n("div",Tt,[t("div",$t,[(o(!0),n(b,null,p($.value,(s,a)=>(o(),n("div",{key:a,class:"bg-muted/20 rounded-lg p-4 text-center"},[t("div",Vt,l(N(a)),1),t("div",At,l(Math.round(s)),1)]))),128))])])):Z("",!0)]),t("div",It,[v(w(G),{onClick:H,variant:"outline",class:"w-full md:w-auto"},{default:k(()=>[v(O,{name:d.value?"eye-off":"eye",class:"mr-2 h-4 w-4"},null,8,["name"]),L(" "+l(d.value?"Hide Graphs":"Show Graphs"),1)]),_:1})]),d.value?(o(),n("div",Zt,[t("div",Nt,[t("div",jt,[e[5]||(e[5]=t("h3",{class:"text-lg font-semibold text-foreground mb-4"},"Safety Trends",-1)),t("div",Gt,[t("canvas",{ref_key:"lineChartCanvas",ref:S,width:"400",height:"200"},null,512)])]),t("div",Ot,[e[6]||(e[6]=t("h3",{class:"text-lg font-semibold text-foreground mb-4"},"Alert Distribution",-1)),t("div",Bt,[t("div",Lt,[t("canvas",{ref_key:"doughnutChartCanvas",ref:M,width:"200",height:"200"},null,512)])])])])])):Z("",!0)]),_:1})]),_:1}))}};export{Jt as default};
