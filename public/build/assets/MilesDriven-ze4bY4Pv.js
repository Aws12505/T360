import{r as C,a as _e,w as ce,f as p,i as o,j as s,B as a,X as i,u as t,G as k,O as d,P as m,H as _,ak as M,J as B,K as Y,E as I,Y as Z,I as ge,am as ye}from"./vendor-BFuKjz45.js";import{x as h,g as ke,W as H}from"./vendor-vue-BLQkEQ_D.js";import{T as D}from"./app-CGq9Auu4.js";import{_ as we,a as be,b as q,c as A,d as xe,e as V}from"./TableRow.vue_vue_type_script_setup_true_lang-BYKXF4kE.js";import{_ as g}from"./Button.vue_vue_type_script_setup_true_lang-BbwYdLlm.js";import{_ as G}from"./Card.vue_vue_type_script_setup_true_lang-kUJ1jh19.js";import{_ as Se,a as Ce}from"./CardTitle.vue_vue_type_script_setup_true_lang-B4PiGnOE.js";import{_ as J}from"./CardContent.vue_vue_type_script_setup_true_lang-CaXnTGJw.js";import{_ as ee,a as te,b as ae,c as ne,d as se}from"./DialogTitle.vue_vue_type_script_setup_true_lang-BMgF8EFT.js";import{_ as le}from"./DialogFooter.vue_vue_type_script_setup_true_lang-B6J1QtuW.js";import{_ as x,a as z}from"./Label.vue_vue_type_script_setup_true_lang-B6MZTsAk.js";import{_ as De,a as Te,b as $e}from"./AlertDescription.vue_vue_type_script_setup_true_lang-DfRKwC2v.js";import{_ as Ue}from"./AppLayout.vue_vue_type_script_setup_true_lang-CvhbqXcl.js";import{_ as w}from"./Icon.vue_vue_type_script_setup_true_lang-Bvtx7n_2.js";import"./vendor-axios-xsH4HHeE.js";import"./utils-7fX89-0C.js";import"./vendor-ui-CqNqovUm.js";import"./vendor-icons-ILJ_3fu6.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-CZUnzYQk.js";const Ve={class:"max-w-7xl mx-auto p-6 space-y-8"},Fe={class:"flex justify-between items-center mb-6"},Me={class:"flex flex-col gap-2"},Ae={class:"flex flex-wrap gap-2"},ze={key:0,class:"text-sm text-muted-foreground"},Ne={key:0},Re={key:1},Ee={key:2},Le={class:"flex flex-col gap-4"},Pe={class:"grid grid-cols-1 sm:grid-cols-3 gap-4 w-full"},We={class:"flex justify-end"},Oe={class:"overflow-x-auto"},je={class:"flex items-center"},Be={class:"ml-2"},Ye={class:"flex items-center"},Ie={class:"ml-2"},He={class:"flex items-center"},qe={class:"ml-2"},Ge={class:"flex space-x-2"},Je={key:0,class:"bg-muted/20 px-4 py-3 border-t"},Ke={class:"flex justify-between items-center"},Qe={class:"text-sm text-muted-foreground"},Xe={class:"flex items-center gap-4"},Ze={class:"flex items-center gap-2"},he={class:"flex"},et=["innerHTML"],tt={key:0},at=["value"],nt={key:0,class:"text-destructive text-sm mt-1"},st={class:"grid grid-cols-2 gap-4"},lt={key:0,class:"text-destructive text-sm mt-1"},rt={key:0,class:"text-destructive text-sm mt-1"},it={key:1,class:"grid grid-cols-2 gap-4"},dt={class:"mt-1 text-sm text-gray-900 dark:text-gray-200"},ot={class:"mt-1 text-sm text-gray-900 dark:text-gray-200"},ut={key:0,class:"text-destructive text-sm mt-1"},mt={key:0,class:"text-destructive text-sm mt-1"},Mt={__name:"MilesDriven",props:{entries:Object,tenantSlug:String,SuperAdmin:Boolean,tenants:Array,dateRange:Object,dateFilter:{type:String,default:"yesterday"}},setup(v){const u=v,$=C(""),F=C(!1),N=C(!1),P=C(null),S=C("week_start_date"),b=C("desc"),y=C({search:"",dateFrom:"",dateTo:""}),T=C(u.dateFilter),L=C(10),re=[{title:u.tenantSlug?"Dashboard":"Admin Dashboard",href:u.tenantSlug?D("dashboard",{tenantSlug:u.tenantSlug}):D("admin.dashboard")},{title:"Miles Driven",href:u.tenantSlug?D("miles_driven.index",{tenantSlug:u.tenantSlug}):D("miles_driven.index.admin")}],r=h({id:null,tenant_id:u.SuperAdmin?"":null,year:"",week_number:"",week_start_date:"",week_end_date:"",miles:"",notes:""}),K=h({}),W=_e(()=>{let l=[...u.entries.data];if(y.value.search){const e=y.value.search.toLowerCase();l=l.filter(n=>{var f,c,E;return((c=(f=n.tenant)==null?void 0:f.name)==null?void 0:c.toLowerCase().includes(e))||((E=n.notes)==null?void 0:E.toLowerCase().includes(e))})}return y.value.dateFrom&&(l=l.filter(e=>e.week_start_date>=y.value.dateFrom)),y.value.dateTo&&(l=l.filter(e=>e.week_end_date<=y.value.dateTo)),l.sort((e,n)=>{let f=e[S.value],c=n[S.value];return f===null?1:c===null?-1:(typeof f=="string"&&(f=f.toLowerCase(),c=c.toLowerCase()),f>c?b.value==="asc"?1:-1:f<c?b.value==="asc"?-1:1:0)}),l});function O(l){S.value===l?b.value=b.value==="asc"?"desc":"asc":(S.value=l,b.value="asc")}function j(){}function ie(){y.value={search:"",dateFrom:"",dateTo:""}}function de(l){l&&H.visit(l)}function Q(){const l=Number(r.year),e=Number(r.week_number);if(!l||!e){r.week_start_date="",r.week_end_date="";return}const n=new Date(Date.UTC(l,0,4)),f=n.getUTCDay()||7;n.setUTCDate(n.getUTCDate()+(e-1)*7+(1-f));const c=new Date(n);c.setUTCDate(n.getUTCDate()-1);const E=new Date(c);E.setUTCDate(c.getUTCDate()+6),r.week_start_date=c.toISOString().slice(0,10),r.week_end_date=E.toISOString().slice(0,10)}function X(l=null){if(r.reset(),r.clearErrors(),l){r.id=l.id,r.tenant_id=l.tenant_id,r.week_start_date=l.week_start_date,r.week_end_date=l.week_end_date,r.miles=l.miles,r.notes=l.notes;const e=new Date(l.week_start_date),n=new Date(Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate()));n.setUTCDate(n.getUTCDate()+4-(n.getUTCDay()||7));const f=n.getUTCFullYear(),c=Math.ceil(((n-Date.UTC(f,0,1))/864e5+1)/7)+1;r.year=f,r.week_number=c}F.value=!0}function oe(l){confirm("Are you sure you want to delete this miles driven record?")&&(P.value=l,N.value=!0)}function ue(){if(r.id){const l=u.SuperAdmin?"miles_driven.update.admin":"miles_driven.update",e=u.SuperAdmin?{milesDriven:r.id}:{tenantSlug:u.tenantSlug,milesDriven:r.id};r.put(D(l,e),{onSuccess:()=>{F.value=!1,$.value="Miles driven record updated successfully."}})}else{const l=u.SuperAdmin?"miles_driven.store.admin":"miles_driven.store",e=u.SuperAdmin?{}:{tenantSlug:u.tenantSlug};r.post(D(l,e),{onSuccess:()=>{F.value=!1,$.value="Miles driven record created successfully."}})}}function me(){const l=u.SuperAdmin?"miles_driven.destroy.admin":"miles_driven.destroy",e=u.SuperAdmin?{milesDriven:P.value.id}:{tenantSlug:u.tenantSlug,milesDriven:P.value.id};K.delete(D(l,e),{preserveScroll:!0,onSuccess:()=>{N.value=!1,$.value="Miles driven record deleted successfully."}})}function R(l){T.value=l;const e=u.tenantSlug?"miles_driven.index":"miles_driven.index.admin",n=u.tenantSlug?{tenantSlug:u.tenantSlug}:{};H.get(D(e,n),{dateFilter:l,perPage:L.value},{preserveState:!0})}function fe(){const l=u.tenantSlug?"miles_driven.index":"miles_driven.index.admin",e=u.tenantSlug?{tenantSlug:u.tenantSlug}:{};H.get(D(l,e),{dateFilter:T.value,perPage:L.value},{preserveState:!0})}function U(l){if(!l)return"";const e=new Date(l);return new Date(e.getTime()+e.getTimezoneOffset()*6e4).toLocaleDateString()}function ve(l){return Number(l).toLocaleString(void 0,{minimumFractionDigits:4,maximumFractionDigits:4})}function pe(l,e){return l?l.length>e?l.slice(0,e)+"…":l:""}return ce($,l=>{l&&setTimeout(()=>$.value="",5e3)}),(l,e)=>(o(),p(Ue,{breadcrumbs:re,tenantSlug:v.tenantSlug},{default:s(()=>[a(t(ke),{title:"Miles Driven"}),i("div",Ve,[$.value?(o(),p(t(De),{key:0,variant:"success"},{default:s(()=>[a(t(Te),null,{default:s(()=>e[22]||(e[22]=[d("Success")])),_:1}),a(t($e),null,{default:s(()=>[d(m($.value),1)]),_:1})]),_:1})):k("",!0),i("div",Fe,[e[24]||(e[24]=i("h1",{class:"text-2xl font-bold"},"Miles Driven",-1)),a(t(g),{onClick:e[0]||(e[0]=n=>X()),variant:"default"},{default:s(()=>[a(w,{name:"plus",class:"mr-2 h-4 w-4"}),e[23]||(e[23]=d(" Add Miles Driven "))]),_:1})]),a(t(G),null,{default:s(()=>[a(t(J),{class:"p-4"},{default:s(()=>[i("div",Me,[i("div",Ae,[a(t(g),{onClick:e[1]||(e[1]=n=>R("yesterday")),variant:"outline",size:"sm",class:M({"bg-primary/10 text-primary border-primary":T.value==="yesterday"})},{default:s(()=>e[25]||(e[25]=[d("Yesterday")])),_:1},8,["class"]),a(t(g),{onClick:e[2]||(e[2]=n=>R("current-week")),variant:"outline",size:"sm",class:M({"bg-primary/10 text-primary border-primary":T.value==="current-week"})},{default:s(()=>e[26]||(e[26]=[d("WtD")])),_:1},8,["class"]),a(t(g),{onClick:e[3]||(e[3]=n=>R("6w")),variant:"outline",size:"sm",class:M({"bg-primary/10 text-primary border-primary":T.value==="6w"})},{default:s(()=>e[27]||(e[27]=[d("6 Weeks")])),_:1},8,["class"]),a(t(g),{onClick:e[4]||(e[4]=n=>R("quarterly")),variant:"outline",size:"sm",class:M({"bg-primary/10 text-primary border-primary":T.value==="quarterly"})},{default:s(()=>e[28]||(e[28]=[d("Quarterly")])),_:1},8,["class"]),a(t(g),{onClick:e[5]||(e[5]=n=>R("full")),variant:"outline",size:"sm",class:M({"bg-primary/10 text-primary border-primary":T.value==="full"})},{default:s(()=>e[29]||(e[29]=[d("Full")])),_:1},8,["class"])]),v.dateRange?(o(),_("div",ze,[T.value==="yesterday"&&v.dateRange.start?(o(),_("span",Ne," Showing data from "+m(U(v.dateRange.start)),1)):v.dateRange.start&&v.dateRange.end?(o(),_("span",Re," Showing data from "+m(U(v.dateRange.start))+" to "+m(U(v.dateRange.end)),1)):(o(),_("span",Ee,m(v.dateRange.label),1))])):k("",!0)])]),_:1})]),_:1}),a(t(G),null,{default:s(()=>[a(t(Se),null,{default:s(()=>[a(t(Ce),null,{default:s(()=>e[30]||(e[30]=[d("Filters")])),_:1})]),_:1}),a(t(J),null,{default:s(()=>[i("div",Le,[i("div",Pe,[i("div",null,[a(t(x),{for:"search"},{default:s(()=>e[31]||(e[31]=[d("Search")])),_:1}),a(t(z),{id:"search",modelValue:y.value.search,"onUpdate:modelValue":e[6]||(e[6]=n=>y.value.search=n),type:"text",placeholder:"Search...",onInput:j},null,8,["modelValue"])]),i("div",null,[a(t(x),{for:"dateFrom"},{default:s(()=>e[32]||(e[32]=[d("Date From")])),_:1}),a(t(z),{id:"dateFrom",modelValue:y.value.dateFrom,"onUpdate:modelValue":e[7]||(e[7]=n=>y.value.dateFrom=n),type:"date",onChange:j},null,8,["modelValue"])]),i("div",null,[a(t(x),{for:"dateTo"},{default:s(()=>e[33]||(e[33]=[d("Date To")])),_:1}),a(t(z),{id:"dateTo",modelValue:y.value.dateTo,"onUpdate:modelValue":e[8]||(e[8]=n=>y.value.dateTo=n),type:"date",onChange:j},null,8,["modelValue"])])]),i("div",We,[a(t(g),{onClick:ie,variant:"ghost",size:"sm"},{default:s(()=>[a(w,{name:"rotate_ccw",class:"mr-2 h-4 w-4"}),e[34]||(e[34]=d(" Reset Filters "))]),_:1})])])]),_:1})]),_:1}),a(t(G),null,{default:s(()=>[a(t(J),{class:"p-0"},{default:s(()=>[i("div",Oe,[a(t(we),{class:"relative h-[500px] overflow-auto"},{default:s(()=>[a(t(be),null,{default:s(()=>[a(t(q),{class:"sticky top-0 bg-background border-b z-10 hover:bg-background"},{default:s(()=>[v.SuperAdmin?(o(),p(t(A),{key:0,class:"whitespace-nowrap"},{default:s(()=>e[35]||(e[35]=[d("Company Name")])),_:1})):k("",!0),a(t(A),{class:"whitespace-nowrap cursor-pointer",onClick:e[9]||(e[9]=n=>O("week_start_date"))},{default:s(()=>[i("div",je,[e[36]||(e[36]=d(" Week Start Date ")),i("span",Be,[S.value==="week_start_date"&&b.value==="asc"?(o(),p(w,{key:0,name:"chevron-up"})):S.value==="week_start_date"&&b.value==="desc"?(o(),p(w,{key:1,name:"chevron-down"})):(o(),p(w,{key:2,name:"chevron-up-down",class:"opacity-50"}))])])]),_:1}),a(t(A),{class:"whitespace-nowrap cursor-pointer",onClick:e[10]||(e[10]=n=>O("week_end_date"))},{default:s(()=>[i("div",Ye,[e[37]||(e[37]=d(" Week End Date ")),i("span",Ie,[S.value==="week_end_date"&&b.value==="asc"?(o(),p(w,{key:0,name:"chevron-up"})):S.value==="week_end_date"&&b.value==="desc"?(o(),p(w,{key:1,name:"chevron-down"})):(o(),p(w,{key:2,name:"chevron-up-down",class:"opacity-50"}))])])]),_:1}),a(t(A),{class:"whitespace-nowrap cursor-pointer",onClick:e[11]||(e[11]=n=>O("miles"))},{default:s(()=>[i("div",He,[e[38]||(e[38]=d(" Miles ")),i("span",qe,[S.value==="miles"&&b.value==="asc"?(o(),p(w,{key:0,name:"chevron-up"})):S.value==="miles"&&b.value==="desc"?(o(),p(w,{key:1,name:"chevron-down"})):(o(),p(w,{key:2,name:"chevron-up-down",class:"opacity-50"}))])])]),_:1}),a(t(A),{class:"whitespace-nowrap"},{default:s(()=>e[39]||(e[39]=[d("Notes")])),_:1}),a(t(A),{class:"whitespace-nowrap"},{default:s(()=>e[40]||(e[40]=[d("Actions")])),_:1})]),_:1})]),_:1}),a(t(xe),null,{default:s(()=>[(o(!0),_(B,null,Y(W.value,n=>(o(),p(t(q),{key:n.id,class:"hover:bg-muted/50"},{default:s(()=>[v.SuperAdmin?(o(),p(t(V),{key:0},{default:s(()=>{var f;return[d(m((f=n.tenant)==null?void 0:f.name),1)]}),_:2},1024)):k("",!0),a(t(V),null,{default:s(()=>[d(m(U(n.week_start_date)),1)]),_:2},1024),a(t(V),null,{default:s(()=>[d(m(U(n.week_end_date)),1)]),_:2},1024),a(t(V),null,{default:s(()=>[d(m(ve(n.miles)),1)]),_:2},1024),a(t(V),null,{default:s(()=>[d(m(pe(n.notes,30)),1)]),_:2},1024),a(t(V),null,{default:s(()=>[i("div",Ge,[a(t(g),{variant:"outline",size:"sm",onClick:f=>X(n)},{default:s(()=>[a(w,{name:"pencil",class:"mr-1 h-4 w-4"}),e[41]||(e[41]=d(" Edit "))]),_:2},1032,["onClick"]),a(t(g),{variant:"destructive",size:"sm",onClick:f=>oe(n)},{default:s(()=>[a(w,{name:"trash",class:"mr-1 h-4 w-4"}),e[42]||(e[42]=d(" Delete "))]),_:2},1032,["onClick"])])]),_:2},1024)]),_:2},1024))),128)),W.value.length===0?(o(),p(t(q),{key:0},{default:s(()=>[a(t(V),{colspan:v.SuperAdmin?6:5,class:"text-center py-4"},{default:s(()=>e[43]||(e[43]=[d(" No miles driven records found ")])),_:1},8,["colspan"])]),_:1})):k("",!0)]),_:1})]),_:1})]),v.entries.links?(o(),_("div",Je,[i("div",Ke,[i("div",Qe," Showing "+m(W.value.length)+" of "+m(v.entries.data.length)+" entries ",1),i("div",Xe,[i("div",Ze,[a(t(x),{for:"perPage",class:"text-sm"},{default:s(()=>e[44]||(e[44]=[d("Per page:")])),_:1}),I(i("select",{id:"perPage","onUpdate:modelValue":e[12]||(e[12]=n=>L.value=n),onChange:fe,class:"h-8 rounded-md border border-input bg-background px-2 py-1 text-sm"},e[45]||(e[45]=[i("option",{value:"10"},"10",-1),i("option",{value:"25"},"25",-1),i("option",{value:"50"},"50",-1),i("option",{value:"100"},"100",-1)]),544),[[Z,L.value]])]),i("div",he,[(o(!0),_(B,null,Y(v.entries.links,n=>(o(),p(t(g),{key:n.label,onClick:f=>de(n.url),disabled:!n.url,variant:"ghost",size:"sm",class:M(["mx-1",{"bg-primary/10 text-primary border-primary":n.active}])},{default:s(()=>[i("span",{innerHTML:n.label},null,8,et)]),_:2},1032,["onClick","disabled","class"]))),128))])])])])):k("",!0)]),_:1})]),_:1})]),a(t(ee),{open:F.value,"onUpdate:open":e[19]||(e[19]=n=>F.value=n)},{default:s(()=>[a(t(te),{class:"sm:max-w-md"},{default:s(()=>[a(t(ae),null,{default:s(()=>[a(t(ne),null,{default:s(()=>[d(m(t(r).id?"Edit Miles Driven":"Add Miles Driven"),1)]),_:1}),a(t(se),null,{default:s(()=>[d(m(t(r).id?"Update the miles driven record details.":"Enter the details for the new miles driven record."),1)]),_:1})]),_:1}),i("form",{onSubmit:ge(ue,["prevent"]),class:"grid gap-4 py-4"},[v.SuperAdmin?(o(),_("div",tt,[a(t(x),{for:"tenant_id"},{default:s(()=>e[46]||(e[46]=[d("Company")])),_:1}),I(i("select",{id:"tenant_id","onUpdate:modelValue":e[13]||(e[13]=n=>t(r).tenant_id=n),class:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm"},[e[47]||(e[47]=i("option",{value:""},"Select Company",-1)),(o(!0),_(B,null,Y(v.tenants,n=>(o(),_("option",{key:n.id,value:n.id},m(n.name),9,at))),128))],512),[[Z,t(r).tenant_id]]),t(r).errors.tenant_id?(o(),_("p",nt,m(t(r).errors.tenant_id),1)):k("",!0)])):k("",!0),i("div",st,[i("div",null,[a(t(x),{for:"year"},{default:s(()=>e[48]||(e[48]=[d("Year")])),_:1}),a(t(z),{id:"year",type:"number",modelValue:t(r).year,"onUpdate:modelValue":e[14]||(e[14]=n=>t(r).year=n),modelModifiers:{number:!0},min:"2000",max:"2100",onInput:Q},null,8,["modelValue"]),t(r).errors.year?(o(),_("p",lt,m(t(r).errors.year),1)):k("",!0)]),i("div",null,[a(t(x),{for:"week_number"},{default:s(()=>e[49]||(e[49]=[d("Week #")])),_:1}),a(t(z),{id:"week_number",type:"number",modelValue:t(r).week_number,"onUpdate:modelValue":e[15]||(e[15]=n=>t(r).week_number=n),modelModifiers:{number:!0},min:"1",max:"53",onInput:Q},null,8,["modelValue"]),t(r).errors.week_number?(o(),_("p",rt,m(t(r).errors.week_number),1)):k("",!0)])]),t(r).week_start_date?(o(),_("div",it,[i("div",null,[a(t(x),null,{default:s(()=>e[50]||(e[50]=[d("Start (Sunday)")])),_:1}),i("p",dt,m(U(t(r).week_start_date)),1)]),i("div",null,[a(t(x),null,{default:s(()=>e[51]||(e[51]=[d("End (Saturday)")])),_:1}),i("p",ot,m(U(t(r).week_end_date)),1)])])):k("",!0),i("div",null,[a(t(x),{for:"miles"},{default:s(()=>e[52]||(e[52]=[d("Miles")])),_:1}),a(t(z),{id:"miles",modelValue:t(r).miles,"onUpdate:modelValue":e[16]||(e[16]=n=>t(r).miles=n),type:"number",step:"0.0001",min:"0",max:"999999.9999",placeholder:"Enter miles (max 999999.9999)"},null,8,["modelValue"]),t(r).errors.miles?(o(),_("p",ut,m(t(r).errors.miles),1)):k("",!0)]),i("div",null,[a(t(x),{for:"notes"},{default:s(()=>e[53]||(e[53]=[d("Notes")])),_:1}),I(i("textarea",{id:"notes","onUpdate:modelValue":e[17]||(e[17]=n=>t(r).notes=n),placeholder:"Optional notes",class:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm resize-none h-24"},null,512),[[ye,t(r).notes]]),t(r).errors.notes?(o(),_("p",mt,m(t(r).errors.notes),1)):k("",!0)]),a(t(le),{class:"mt-4"},{default:s(()=>[a(t(g),{variant:"outline",type:"button",onClick:e[18]||(e[18]=n=>F.value=!1)},{default:s(()=>e[54]||(e[54]=[d("Cancel")])),_:1}),a(t(g),{type:"submit",disabled:t(r).processing},{default:s(()=>[d(m(t(r).id?"Update":"Create"),1)]),_:1},8,["disabled"])]),_:1})],32)]),_:1})]),_:1},8,["open"]),a(t(ee),{open:N.value,"onUpdate:open":e[21]||(e[21]=n=>N.value=n)},{default:s(()=>[a(t(te),null,{default:s(()=>[a(t(ae),null,{default:s(()=>[a(t(ne),null,{default:s(()=>e[55]||(e[55]=[d("Confirm Deletion")])),_:1}),a(t(se),null,{default:s(()=>e[56]||(e[56]=[d(" Are you sure you want to delete this miles driven record? This action cannot be undone. ")])),_:1})]),_:1}),a(t(le),null,{default:s(()=>[a(t(g),{variant:"outline",onClick:e[20]||(e[20]=n=>N.value=!1)},{default:s(()=>e[57]||(e[57]=[d("Cancel")])),_:1}),a(t(g),{variant:"destructive",onClick:me,disabled:t(K).processing},{default:s(()=>e[58]||(e[58]=[d(" Delete ")])),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["open"])]),_:1},8,["tenantSlug"]))}};export{Mt as default};
