import{k as x,C as j,f as de,l as w,o,w as r,e as n,b as i,u as a,m as ue,g as y,i as s,t as f,a as m,h as T,F as S,r as k,v as U,j as W,n as C,W as R}from"./app-CT7HE7yj.js";import{_ as me}from"./AppLayout.vue_vue_type_script_setup_true_lang-DlDkuPJH.js";import{_ as E}from"./Icon.vue_vue_type_script_setup_true_lang-BTP9fbBa.js";import{_ as ce,a as fe,b as L,c as B,d as pe,e as P}from"./TableRow.vue_vue_type_script_setup_true_lang-6K1dCYJ0.js";import{_ as p}from"./Button.vue_vue_type_script_setup_true_lang-DtfF6tag.js";import{_ as H}from"./Card.vue_vue_type_script_setup_true_lang-BDft_Qmr.js";import{_ as X}from"./CardContent.vue_vue_type_script_setup_true_lang-FkGZv0k2.js";import{_ as ge,a as _e,b as ve,c as ye,d as be,e as xe}from"./DialogTitle.vue_vue_type_script_setup_true_lang-CErbbaGE.js";import{a as G,_ as I}from"./Label.vue_vue_type_script_setup_true_lang-D0C1tzBx.js";import{_ as we,a as Se,b as ke}from"./AlertDescription.vue_vue_type_script_setup_true_lang-B9ID7k7N.js";import"./index-D3Fduugl.js";import"./createLucideIcon-C45OoFkM.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-Ck12Yau3.js";import"./shield-bIbs5XZ1.js";import"./check-CrTaROck.js";import"./loader-circle-IMZPannU.js";import"./sun-DEV0Db78.js";const Ce={class:"max-w-7xl mx-auto p-6 space-y-8"},he={class:"flex flex-col sm:flex-row justify-between items-center mb-6 gap-4"},$e={class:"flex flex-wrap gap-3"},ze={key:0,class:"flex items-center gap-2"},Ae=["value"],Ee={class:"flex items-center gap-2"},Ne={class:"cursor-pointer"},Fe={class:"flex flex-col gap-2"},Ve={class:"flex flex-wrap gap-2"},Pe={key:0,class:"text-sm text-muted-foreground"},Me={key:0},De={key:1},je={class:"overflow-x-auto bg-background dark:bg-background border-t border-border"},Te={class:"flex space-x-2"},Ue={key:0,class:"bg-muted/20 px-4 py-3 border-t"},Re={class:"flex justify-between items-center"},Le={class:"text-sm text-muted-foreground"},Be={class:"flex items-center gap-4"},Ie={class:"flex items-center gap-2"},Oe={class:"flex"},qe=["innerHTML"],We={key:0,class:"col-span-2"},He={class:"relative"},Xe=["value"],mt={__name:"Safety",props:{entries:{type:Object,default:()=>({data:[],links:[]})},tenantSlug:String,SuperAdmin:Boolean,tenants:Array,dateRange:Object,dateFilter:{type:String,default:"full"}},setup(u){const d=u,b=x(""),h=x(!1),M=x("Create Entry"),$=x("Create"),D=x(null),v=x(d.dateFilter||"full"),z=x(10),Q=[{title:d.tenantSlug?"Dashboard":"Admin Dashboard",href:d.tenantSlug?route("dashboard",{tenantSlug:d.tenantSlug}):route("admin.dashboard")},{title:"Safety",href:d.tenantSlug?route("safety.index",{tenantSlug:d.tenantSlug}):route("safety.index.admin")}],N={driver_name:"text",user_name:"text",group:"text",group_hierarchy:"text",minutes_analyzed:"decimal",green_minutes_percent:"decimal",overspeeding_percent:"decimal",driver_score:"decimal",total_events_avg_fd_impact:"decimal",average_following_distance_sec:"decimal",average_following_distance_gz_impact:"decimal",total_events:"decimal",high_g:"decimal",low_impact:"decimal",driver_initiated:"decimal",potential_collision:"decimal",sign_violations:"decimal",sign_violations_gz_impact:"decimal",traffic_light_violation:"decimal",traffic_light_violation_gz_impact:"decimal",u_turn:"decimal",u_turn_gz_impact:"decimal",hard_braking:"decimal",hard_braking_gz_impact:"decimal",hard_turn:"decimal",hard_turn_gz_impact:"decimal",hard_acceleration:"decimal",hard_acceleration_gz_impact:"decimal",driver_distraction:"decimal",driver_distraction_gz_impact:"decimal",following_distance:"decimal",following_distance_gz_impact:"decimal",speeding_violations:"decimal",speeding_violations_gz_impact:"decimal",seatbelt_compliance:"decimal",camera_obstruction:"decimal",driver_drowsiness:"decimal",weaving:"decimal",weaving_gz_impact:"decimal",collision_warning:"decimal",collision_warning_gz_impact:"decimal",requested_video:"decimal",backing:"decimal",roadside_parking:"decimal",driver_distracted_hard_brake:"decimal",following_distance_hard_brake:"decimal",driver_distracted_following_distance:"decimal",driver_star:"decimal",driver_star_gz_impact:"decimal",vehicle_type:"text",safety_normalisation_factor:"decimal",date:"date"},F=Object.keys(N),V=[...F],g=j({tenant_id:null,...Object.fromEntries(F.map(l=>[l,""])),id:null}),_=j({csv_file:null,date:"",tenant_id:null}),Y=j({});function J(l){const e=N[l];return e==="decimal"||e==="integer"?"number":e==="date"?"date":"text"}function K(l){const e=N[l];return e==="decimal"?"0.01":e==="integer"?"1":null}function Z(l){const e=N[l];return e==="decimal"||e==="integer"?"-99999":null}function ee(){g.reset(),M.value="Create Entry",$.value="Create",h.value=!0}function te(l){M.value="Edit Entry",$.value="Update",g.tenant_id=d.SuperAdmin?l.tenant_id:null,g.id=l.id,F.forEach(e=>{g[e]=l[e]}),h.value=!0}function O(){h.value=!1}function ae(){const l=$.value==="Create",e=l?d.SuperAdmin?route("safety.store.admin"):route("safety.store",d.tenantSlug):d.SuperAdmin?route("safety.update.admin",[g.id]):route("safety.update",[d.tenantSlug,g.id]);g[l?"post":"put"](e,{onSuccess:()=>{b.value=l?"Entry created.":"Entry updated.",O()},onError:()=>alert("Something went wrong.")})}function ne(l){if(!confirm("Are you sure?"))return;const e=d.SuperAdmin?route("safety.destroy.admin",[l]):route("safety.destroy",[d.tenantSlug,l]);Y.delete(e,{onSuccess:()=>b.value="Entry deleted."})}function re(l){var c;const e=(c=l.target.files)==null?void 0:c[0];if(!e)return;if(!_.date){alert("Please select the date for this import.");return}if(d.SuperAdmin&&!_.tenant_id){alert("Please select a tenant for import.");return}_.csv_file=e;const t=d.SuperAdmin?route("safety.import.admin"):route("safety.import",d.tenantSlug);_.post(t,{forceFormData:!0,preserveScroll:!0,onSuccess:()=>{b.value="Data imported successfully.",_.reset()},onError:()=>alert("Import failed.")})}function le(){var e,t;const l=d.SuperAdmin?route("safety.export.admin"):route("safety.export",d.tenantSlug);(e=D.value)==null||e.setAttribute("action",l),(t=D.value)==null||t.submit()}de(b,l=>{l&&setTimeout(()=>{b.value=""},5e3)});function A(l){v.value=l;const e=d.tenantSlug?route("safety.index",{tenantSlug:d.tenantSlug}):route("safety.index.admin");R.get(e,{dateFilter:l,perPage:z.value},{preserveState:!0})}function ie(){const l=d.tenantSlug?route("safety.index",{tenantSlug:d.tenantSlug}):route("safety.index.admin");R.get(l,{dateFilter:v.value,perPage:z.value},{preserveState:!0})}function q(l){if(!l)return"";const e=l.split("-");if(e.length!==3)return l;const[t,c,oe]=e;return`${Number(c)}/${Number(oe)}/${t}`}function se(l){if(l){const e=new URL(l);e.searchParams.set("perPage",z.value),e.searchParams.set("dateFilter",v.value),R.get(e.href,{},{only:["entries"]})}}return(l,e)=>(o(),w(me,{breadcrumbs:Q,tenantSlug:u.tenantSlug},{default:r(()=>[n(a(ue),{title:"Safety"}),i("div",Ce,[b.value?(o(),w(a(we),{key:0,variant:"success"},{default:r(()=>[n(a(Se),null,{default:r(()=>e[10]||(e[10]=[s("Success")])),_:1}),n(a(ke),null,{default:r(()=>[s(f(b.value),1)]),_:1})]),_:1})):y("",!0),i("div",he,[e[15]||(e[15]=i("h1",{class:"text-2xl font-bold text-gray-800 dark:text-gray-200"},"Safety Management",-1)),i("div",$e,[n(a(p),{onClick:ee,variant:"default"},{default:r(()=>[n(E,{name:"plus",class:"mr-2 h-4 w-4"}),e[11]||(e[11]=s(" Create New Entry "))]),_:1}),u.SuperAdmin?(o(),m("div",ze,[T(i("select",{"onUpdate:modelValue":e[0]||(e[0]=t=>a(_).tenant_id=t),class:"h-10 rounded-md border border-input bg-background px-3 py-2 text-sm"},[e[12]||(e[12]=i("option",{disabled:"",value:""},"Select Company Name",-1)),(o(!0),m(S,null,k(u.tenants,t=>(o(),m("option",{key:t.id,value:t.id},f(t.name),9,Ae))),128))],512),[[U,a(_).tenant_id]])])):y("",!0),i("div",Ee,[n(a(G),{modelValue:a(_).date,"onUpdate:modelValue":e[1]||(e[1]=t=>a(_).date=t),type:"date",required:"",placeholder:"Date for Import"},null,8,["modelValue"])]),i("label",Ne,[n(a(p),{variant:"secondary",as:"span"},{default:r(()=>[n(E,{name:"upload",class:"mr-2 h-4 w-4"}),e[13]||(e[13]=s(" Import XLSX "))]),_:1}),i("input",{type:"file",class:"hidden",onChange:re,accept:".xlsx"},null,32)]),n(a(p),{onClick:W(le,["prevent"]),variant:"outline"},{default:r(()=>[n(E,{name:"download",class:"mr-2 h-4 w-4"}),e[14]||(e[14]=s(" Export CSV "))]),_:1})])]),n(a(H),null,{default:r(()=>[n(a(X),{class:"p-4"},{default:r(()=>[i("div",Fe,[i("div",Ve,[n(a(p),{onClick:e[2]||(e[2]=t=>A("yesterday")),variant:"outline",size:"sm",class:C({"bg-primary/10 text-primary border-primary":v.value==="yesterday"})},{default:r(()=>e[16]||(e[16]=[s(" Yesterday ")])),_:1},8,["class"]),n(a(p),{onClick:e[3]||(e[3]=t=>A("current-week")),variant:"outline",size:"sm",class:C({"bg-primary/10 text-primary border-primary":v.value==="current-week"})},{default:r(()=>e[17]||(e[17]=[s(" Current Week ")])),_:1},8,["class"]),n(a(p),{onClick:e[4]||(e[4]=t=>A("6w")),variant:"outline",size:"sm",class:C({"bg-primary/10 text-primary border-primary":v.value==="6w"})},{default:r(()=>e[18]||(e[18]=[s(" 6 Weeks ")])),_:1},8,["class"]),n(a(p),{onClick:e[5]||(e[5]=t=>A("quarterly")),variant:"outline",size:"sm",class:C({"bg-primary/10 text-primary border-primary":v.value==="quarterly"})},{default:r(()=>e[19]||(e[19]=[s(" Quarterly ")])),_:1},8,["class"]),n(a(p),{onClick:e[6]||(e[6]=t=>A("full")),variant:"outline",size:"sm",class:C({"bg-primary/10 text-primary border-primary":v.value==="full"})},{default:r(()=>e[20]||(e[20]=[s(" Full ")])),_:1},8,["class"])]),u.dateRange?(o(),m("div",Pe,[u.dateRange.start&&u.dateRange.end?(o(),m("span",Me," Showing data from "+f(q(u.dateRange.start))+" to "+f(q(u.dateRange.end)),1)):(o(),m("span",De,f(u.dateRange.label),1))])):y("",!0)])]),_:1})]),_:1}),n(a(H),null,{default:r(()=>[n(a(X),{class:"p-0"},{default:r(()=>[i("div",je,[n(a(ce),{class:"relative h-[500px] overflow-auto"},{default:r(()=>[n(a(fe),null,{default:r(()=>[n(a(L),{class:"sticky top-0"},{default:r(()=>[u.SuperAdmin?(o(),w(a(B),{key:0},{default:r(()=>e[21]||(e[21]=[s("Company Name")])),_:1})):y("",!0),(o(),m(S,null,k(V,t=>n(a(B),{key:t,class:"whitespace-nowrap"},{default:r(()=>[s(f(t.replace(/_/g," ")),1)]),_:2},1024)),64)),n(a(B),null,{default:r(()=>e[22]||(e[22]=[s("Actions")])),_:1})]),_:1})]),_:1}),n(a(pe),null,{default:r(()=>[u.entries.data.length===0?(o(),w(a(L),{key:0},{default:r(()=>[n(a(P),{colspan:u.SuperAdmin?V.length+2:V.length+1,class:"text-center py-8"},{default:r(()=>e[23]||(e[23]=[s(" No entries found ")])),_:1},8,["colspan"])]),_:1})):y("",!0),(o(!0),m(S,null,k(u.entries.data,t=>(o(),w(a(L),{key:t.id,class:"hover:bg-muted/50"},{default:r(()=>[u.SuperAdmin?(o(),w(a(P),{key:0},{default:r(()=>{var c;return[s(f(((c=t.tenant)==null?void 0:c.name)??"—"),1)]}),_:2},1024)):y("",!0),(o(),m(S,null,k(V,c=>n(a(P),{key:c,class:"whitespace-nowrap"},{default:r(()=>[s(f(t[c]),1)]),_:2},1024)),64)),n(a(P),null,{default:r(()=>[i("div",Te,[n(a(p),{onClick:c=>te(t),variant:"warning",size:"sm"},{default:r(()=>[n(E,{name:"pencil",class:"mr-1 h-4 w-4"}),e[24]||(e[24]=s(" Edit "))]),_:2},1032,["onClick"]),n(a(p),{onClick:c=>ne(t.id),variant:"destructive",size:"sm"},{default:r(()=>[n(E,{name:"trash",class:"mr-1 h-4 w-4"}),e[25]||(e[25]=s(" Delete "))]),_:2},1032,["onClick"])])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),u.entries.links?(o(),m("div",Ue,[i("div",Re,[i("div",Le," Showing "+f(u.entries.data.length)+" entries ",1),i("div",Be,[i("div",Ie,[n(a(I),{for:"perPage",class:"text-sm"},{default:r(()=>e[26]||(e[26]=[s("Per page:")])),_:1}),T(i("select",{id:"perPage","onUpdate:modelValue":e[7]||(e[7]=t=>z.value=t),onChange:ie,class:"h-8 rounded-md border border-input bg-background px-2 py-1 text-sm ring-offset-background focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50"},e[27]||(e[27]=[i("option",{value:"10"},"10",-1),i("option",{value:"25"},"25",-1),i("option",{value:"50"},"50",-1),i("option",{value:"100"},"100",-1)]),544),[[U,z.value]])]),i("div",Oe,[(o(!0),m(S,null,k(u.entries.links,t=>(o(),w(a(p),{key:t.label,onClick:c=>se(t.url),disabled:!t.url,variant:"ghost",size:"sm",class:C(["mx-1",{"bg-primary/10 text-primary border-primary":t.active}])},{default:r(()=>[i("span",{innerHTML:t.label},null,8,qe)]),_:2},1032,["onClick","disabled","class"]))),128))])])])])):y("",!0)]),_:1})]),_:1}),n(a(ge),{open:h.value,"onUpdate:open":e[9]||(e[9]=t=>h.value=t)},{default:r(()=>[n(a(_e),{class:"sm:max-w-4xl"},{default:r(()=>[n(a(ve),null,{default:r(()=>[n(a(ye),null,{default:r(()=>[s(f(M.value),1)]),_:1}),n(a(be),null,{default:r(()=>[s(" Fill in the details to "+f($.value.toLowerCase())+" an entry. ",1)]),_:1})]),_:1}),i("form",{onSubmit:W(ae,["prevent"]),class:"grid grid-cols-1 sm:grid-cols-2 gap-4 max-h-[70vh] overflow-y-auto"},[u.SuperAdmin?(o(),m("div",We,[n(a(I),{for:"tenant"},{default:r(()=>e[28]||(e[28]=[s("Company Name")])),_:1}),i("div",He,[T(i("select",{id:"tenant","onUpdate:modelValue":e[8]||(e[8]=t=>a(g).tenant_id=t),class:"flex h-10 w-full items-center rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 appearance-none"},[e[29]||(e[29]=i("option",{disabled:"",value:""},"Select Company",-1)),(o(!0),m(S,null,k(u.tenants,t=>(o(),m("option",{key:t.id,value:t.id},f(t.name),9,Xe))),128))],512),[[U,a(g).tenant_id]]),e[30]||(e[30]=i("div",{class:"pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700"},[i("svg",{class:"h-4 w-4 opacity-50",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor"},[i("path",{"fill-rule":"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z","clip-rule":"evenodd"})])],-1))])])):y("",!0),(o(!0),m(S,null,k(a(F),t=>(o(),m("div",{key:t},[n(a(I),{for:t,class:"capitalize"},{default:r(()=>[s(f(t.replace(/_/g," ")),1)]),_:2},1032,["for"]),n(a(G),{id:t,modelValue:a(g)[t],"onUpdate:modelValue":c=>a(g)[t]=c,type:J(t),step:K(t),min:Z(t)},null,8,["id","modelValue","onUpdate:modelValue","type","step","min"])]))),128)),n(a(xe),{class:"col-span-2 mt-4"},{default:r(()=>[n(a(p),{type:"button",onClick:O,variant:"outline"},{default:r(()=>e[31]||(e[31]=[s(" Cancel ")])),_:1}),n(a(p),{type:"submit",variant:"default"},{default:r(()=>[s(f($.value),1)]),_:1})]),_:1})],32)]),_:1})]),_:1},8,["open"]),i("form",{ref_key:"exportForm",ref:D,method:"GET",class:"hidden"},null,512)])]),_:1},8,["tenantSlug"]))}};export{mt as default};
