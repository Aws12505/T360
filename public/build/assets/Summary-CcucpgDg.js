import{x as se,W as J,g as ne}from"./vendor-vue-U3hygByY.js";import{_ as re}from"./AppLayout.vue_vue_type_script_setup_true_lang-CjIFVRCX.js";import{_ as y}from"./Icon.vue_vue_type_script_setup_true_lang-B-9SXevG.js";import{_ as U}from"./Badge.vue_vue_type_script_setup_true_lang-Bn0FBe5D.js";import{d as G,c as j,v as h,e as m,V as e,y as c,aj as O,r as M,z as P,F as I,C as L,l as n,f as d,x as f,u as s,b as w,M as X,al as le,p as oe,i as ie,w as Q,W as de,k as ue}from"./vendor-Bo5HMgp9.js";import{a as ee,b as Y,c as W,d as te,e as V,_ as ae}from"./TableRow.vue_vue_type_script_setup_true_lang-DlDTWHeS.js";import{_ as A}from"./Button.vue_vue_type_script_setup_true_lang-aefVT2rO.js";import{_ as ce,a as me,b as fe,c as ve,d as ge}from"./DialogDescription.vue_vue_type_script_setup_true_lang-DVdJnQMQ.js";import{_ as pe}from"./DialogFooter.vue_vue_type_script_setup_true_lang-C7qKlR1q.js";import{_ as q,a as H}from"./Label.vue_vue_type_script_setup_true_lang-snO2soGp.js";import{T as Z}from"./app-DRqV69eo.js";import{_ as be}from"./Card.vue_vue_type_script_setup_true_lang-BiSo-lfq.js";import{_ as xe}from"./CardHeader.vue_vue_type_script_setup_true_lang-DnXa1Q0v.js";import{_ as _e}from"./CardTitle.vue_vue_type_script_setup_true_lang-Db1edUY4.js";import{_ as ye}from"./CardContent.vue_vue_type_script_setup_true_lang-OH4fMdUO.js";import{c as we}from"./utils-olDi9ANG.js";import"./vendor-axios-xsH4HHeE.js";import"./vendor-ui-CdWqhd_O.js";import"./vendor-icons-CLnRj7LD.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-Dx7kowKY.js";const ke={class:"mb-6"},De=G({__name:"DashboardHeader",props:{operationalExcellenceScore:{type:String,default:"Not Available"}},setup(o){const p=o,v=j(()=>{switch(p.operationalExcellenceScore){case"Fantastic +":return"text-green-600";case"Fantastic":return"text-emerald-600";case"Good":return"text-blue-600";case"Fair":return"text-amber-600";case"Poor":return"text-red-600";default:return"text-gray-600"}});return(x,g)=>(m(),h("div",ke,[e("h2",{class:O(["text-4xl font-bold tracking-tight",[v.value,"transition-colors duration-300"]])},c(o.operationalExcellenceScore),3)]))}}),he={class:"mb-6"},$e={class:"border-b"},Se={class:"flex -mb-px space-x-8"},Ce=["onClick"],Te={key:0,class:"mt-2 text-sm text-muted-foreground"},je={key:0,class:"ml-1"},Ne=G({__name:"TimePeriodTabs",props:{dateRangeText:{type:String,default:""},weekNumber:{type:Number,default:null},startWeekNumber:{type:Number,default:null},endWeekNumber:{type:Number,default:null},year:{type:Number,default:null},activeTabId:{type:String,default:"yesterday"}},emits:["tab-change"],setup(o,{emit:p}){const v=o,x=[{id:"yesterday",label:"Yesterday"},{id:"current-week",label:"WTD"},{id:"t6w",label:"T6W Scores"},{id:"quarterly",label:"Quarterly Scores"}],g=M(v.activeTabId),u=p,_=j(()=>(g.value==="yesterday"||g.value==="current-week")&&v.weekNumber&&v.year?`Week ${v.weekNumber}, ${v.year}`:(g.value==="t6w"||g.value==="quarterly")&&v.startWeekNumber&&v.endWeekNumber&&v.year?`Weeks ${v.startWeekNumber}-${v.endWeekNumber}, ${v.year}`:""),F=N=>{g.value=N,u("tab-change",N)};return(N,D)=>(m(),h("div",he,[e("div",$e,[e("div",Se,[(m(),h(I,null,L(x,C=>e("button",{key:C.id,onClick:$=>F(C.id),class:O(["py-2 px-1 border-b-2 text-sm font-medium transition-colors",g.value===C.id?"border-primary text-primary":"border-transparent text-muted-foreground hover:text-foreground hover:border-muted-foreground"])},c(C.label),11,Ce)),64))])]),o.dateRangeText?(m(),h("div",Te,[e("span",null,c(o.dateRangeText),1),_.value?(m(),h("span",je,"("+c(_.value)+")",1)):P("",!0)])):P("",!0)]))}}),Re={class:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-6 mb-6"},Fe={class:"bg-card rounded-lg border shadow-sm p-4"},Me={class:"flex items-center justify-between gap-3 mb-4"},Be={class:"space-y-2 text-sm max-h-40 overflow-y-auto"},Ee={class:"bg-card rounded-lg border shadow-sm p-4"},Ve={class:"flex items-center justify-between gap-3 mb-4"},Ue={class:"space-y-2 text-sm max-h-40 overflow-y-auto"},Ae={class:"bg-card rounded-lg border shadow-sm p-4"},Oe={class:"flex items-center justify-between gap-3 mb-4"},We={class:"text-sm mb-2 space-y-2"},Pe={class:"flex justify-between"},ze={class:"flex justify-between"},Ie={class:"flex justify-between"},Le={class:"flex justify-between"},Ge={class:"bg-card rounded-lg border shadow-sm p-4"},qe={class:"flex items-center justify-between gap-3 mb-4"},Ye={class:"text-4xl font-bold text-indigo-600"},He={class:"space-y-2 text-sm"},Ke={class:"flex justify-between items-center"},Qe={class:"flex items-center gap-2"},Ze={class:"w-12 text-right"},Je={class:"w-16 text-right"},Xe={class:"flex justify-between items-center"},et={class:"flex items-center gap-2"},tt={class:"w-12 text-right"},at={class:"w-16 text-right"},st={class:"flex justify-between items-center"},nt={class:"flex items-center gap-2"},rt={class:"w-12 text-right"},lt={class:"w-16 text-right"},ot={class:"flex justify-between items-center"},it={class:"flex items-center gap-2"},dt={class:"w-12 text-right"},ut={class:"w-16 text-right"},ct={class:"flex justify-between items-center"},mt={class:"flex items-center gap-2"},ft={class:"w-12 text-right"},vt={class:"w-16 text-right"},gt={class:"text-sm text-muted-foreground mt-3"},pt=G({__name:"PerformanceCards",props:{performanceData:{type:Object,default:()=>({})},performanceRatings:{type:Object,default:()=>({})},safetyData:{type:Object,default:()=>({})},delayBreakdowns:{type:Array,default:()=>[]},rejectionBreakdowns:{type:Array,default:()=>[]},maintenanceBreakdowns:{type:Object,default:()=>({})}},setup(o){const p=o,v=j(()=>[...p.delayBreakdowns].sort((i,l)=>l.total_delays-i.total_delays).slice(0,3)),x=j(()=>[...p.rejectionBreakdowns].sort((i,l)=>l.total_rejections-i.total_rejections).slice(0,3)),g=i=>i==null?"0%":`${Math.round(parseFloat(i))}%`,u=i=>(typeof i=="string"&&(i=parseFloat(i)),i==null||isNaN(i)?"0":Math.round(i).toString()),_=i=>(typeof i=="string"&&(i=parseFloat(i)),i==null||isNaN(i)?"0.00":i.toFixed(2)),F=i=>(typeof i=="string"&&(i=parseFloat(i)),i==null||isNaN(i)?"0.00":i.toFixed(2)),N=i=>{if(!i)return"Not Available";switch(i){case"gold":return"Gold Tier";case"silver":return"Silver Tier";case"not_eligible":return"Not Eligible";case"fantastic_plus":return"Fantastic +";case"fantastic":return"Fantastic";case"good":return"Good";case"fair":return"Fair";case"poor":return"Poor";default:return i}},D=i=>{if(!i)return"outline";switch(i){case"gold":return"gold";case"silver":return"silver";case"not_eligible":return"not-eligible";case"fantastic_plus":return"fantastic-plus";case"fantastic":return"fantastic";case"good":return"good";case"fair":return"fair";case"poor":return"poor";default:return"outline"}},C=i=>i?i==="Gold Tier"?"gold":i==="Silver Tier"?"silver":i==="Not Eligible"?"not-eligible":"outline":"outline",$=j(()=>{var b;if(!((b=p.safetyData)!=null&&b.ratings))return null;const i=p.safetyData.ratings,l={gold:3,silver:2,not_eligible:1},T=["traffic_light_violation","speeding_violations","following_distance","driver_distraction","sign_violations"];let S="gold";for(const r of T)i[r]&&l[i[r]]<l[S]&&(S=i[r]);switch(S){case"gold":return"Gold Tier";case"silver":return"Silver Tier";case"not_eligible":return"Not Eligible";default:return"Not Available"}}),B=i=>{if(!i)return"text-gray-600";switch(i){case"gold":return"text-amber-600";case"silver":return"text-slate-600";case"not_eligible":return"text-red-600";case"fantastic_plus":return"text-green-600";case"fantastic":return"text-emerald-600";case"good":return"text-blue-600";case"fair":return"text-amber-600";case"poor":return"text-red-600";default:return"text-indigo-600"}};return(i,l)=>{var T,S,b,r,t;return m(),h("div",Re,[e("div",Fe,[l[0]||(l[0]=e("h3",{class:"text-base font-semibold mb-1"},"Acceptance",-1)),l[1]||(l[1]=e("div",{class:"text-xs text-muted-foreground mb-1"},"Total Score",-1)),e("div",Me,[e("div",{class:O(["text-4xl font-bold",B(o.performanceRatings.average_acceptance)])},c(g(o.performanceData.average_acceptance)),3),n(s(U),{variant:D(o.performanceRatings.average_acceptance),class:"text-xs"},{default:d(()=>[f(c(N(o.performanceRatings.average_acceptance)),1)]),_:1},8,["variant"])]),l[2]||(l[2]=e("div",{class:"text-sm mb-2 flex justify-between"},[e("span",{class:"font-semibold"},"Rejections by Reason"),e("span",{class:"font-semibold"},"Total")],-1)),e("div",Be,[(m(!0),h(I,null,L(x.value,(a,k)=>(m(),h("div",{key:k,class:"flex justify-between"},[e("span",null,c(a.reason_code),1),e("span",null,c(a.total_rejections),1)]))),128))])]),e("div",Ee,[l[3]||(l[3]=e("h3",{class:"text-base font-semibold mb-1"},"On-Time",-1)),l[4]||(l[4]=e("div",{class:"text-xs text-muted-foreground mb-1"},"Total Score",-1)),e("div",Ve,[e("div",{class:O(["text-4xl font-bold",B(o.performanceRatings.average_on_time)])},c(g(o.performanceData.average_on_time)),3),n(s(U),{variant:D(o.performanceRatings.average_on_time),class:"text-xs"},{default:d(()=>[f(c(N(o.performanceRatings.average_on_time)),1)]),_:1},8,["variant"])]),l[5]||(l[5]=e("div",{class:"text-sm mb-2 flex justify-between"},[e("span",{class:"font-semibold"},"Delays by Reason"),e("span",{class:"font-semibold"},"Total")],-1)),e("div",Ue,[(m(!0),h(I,null,L(v.value,(a,k)=>(m(),h("div",{key:k,class:"flex justify-between"},[e("span",null,c(a.code),1),e("span",null,c(a.total_delays),1)]))),128))])]),e("div",Ae,[l[10]||(l[10]=e("h3",{class:"text-base font-semibold mb-1"},"Maintenance",-1)),l[11]||(l[11]=e("div",{class:"text-xs text-muted-foreground mb-1"},"MVtS Score",-1)),e("div",Oe,[e("div",{class:O(["text-4xl font-bold",B(o.performanceRatings.average_maintenance_variance_to_spend)])},c(g(o.performanceData.average_maintenance_variance_to_spend)),3),n(s(U),{variant:D(o.performanceRatings.average_maintenance_variance_to_spend),class:"text-xs"},{default:d(()=>[f(c(N(o.performanceRatings.average_maintenance_variance_to_spend)),1)]),_:1},8,["variant"])]),e("div",We,[e("div",Pe,[l[6]||(l[6]=e("span",null,"Cost per mile",-1)),e("span",null,"$"+c(F(o.maintenanceBreakdowns.cpm)),1)]),e("div",ze,[l[7]||(l[7]=e("span",null,"Num of WOs",-1)),e("span",null,c(o.maintenanceBreakdowns.total_repair_orders),1)]),e("div",Ie,[l[8]||(l[8]=e("span",null,"Current Costs",-1)),e("span",null,"$"+c(F(o.maintenanceBreakdowns.total_invoice_amount)),1)]),e("div",Le,[l[9]||(l[9]=e("span",null,"Missing Invoices",-1)),e("span",null,c(o.maintenanceBreakdowns.missing_invoices_count||0),1)])])]),e("div",Ge,[l[17]||(l[17]=e("h3",{class:"text-base font-semibold mb-1"},"Netradyne Alerts Bonus Criteria",-1)),l[18]||(l[18]=e("div",{class:"text-xs text-muted-foreground mb-1"},"Green Zone Score",-1)),e("div",qe,[e("div",Ye,c(u(o.safetyData.average_driver_score||"N/A")),1),n(s(U),{variant:C($.value),class:"text-xs"},{default:d(()=>[f(c(N($.value)),1)]),_:1},8,["variant"])]),l[19]||(l[19]=e("div",{class:"flex justify-between items-center text-sm font-semibold mb-2"},[e("span",null,"Alert Type"),e("div",{class:"flex items-center gap-2"},[e("span",{class:"w-12 text-right"},"Total"),e("span",{class:"w-16 text-right"},"P1KH")])],-1)),e("div",He,[e("div",Ke,[l[12]||(l[12]=e("span",null,"Distracted Driving",-1)),e("div",Qe,[e("span",Ze,c(u(o.safetyData.driver_distraction)),1),e("span",Je,c(_((T=o.safetyData.rates)==null?void 0:T.driver_distraction)),1)])]),e("div",Xe,[l[13]||(l[13]=e("span",null,"Speeding",-1)),e("div",et,[e("span",tt,c(u(o.safetyData.speeding_violations)),1),e("span",at,c(_((S=o.safetyData.rates)==null?void 0:S.speeding_violations)),1)])]),e("div",st,[l[14]||(l[14]=e("span",null,"Sign Violation",-1)),e("div",nt,[e("span",rt,c(u(o.safetyData.sign_violations)),1),e("span",lt,c(_((b=o.safetyData.rates)==null?void 0:b.sign_violations)),1)])]),e("div",ot,[l[15]||(l[15]=e("span",null,"Traffic Light Violation",-1)),e("div",it,[e("span",dt,c(u(o.safetyData.traffic_light_violation)),1),e("span",ut,c(_((r=o.safetyData.rates)==null?void 0:r.traffic_light_violation)),1)])]),e("div",ct,[l[16]||(l[16]=e("span",null,"Following Distance",-1)),e("div",mt,[e("span",ft,c(u(o.safetyData.following_distance)),1),e("span",vt,c(_((t=o.safetyData.rates)==null?void 0:t.following_distance)),1)])])]),e("div",gt,[e("div",null,"Total Hours Analyzed: "+c(u(o.safetyData.total_hours||0)),1)])])])}}}),bt={class:"bg-card rounded-lg border shadow-sm p-6 mb-6"},xt={class:"grid grid-cols-1 md:grid-cols-3 gap-6"},_t={class:"p-4 border rounded-lg"},yt={class:"flex items-center justify-between gap-3 mb-3"},wt={class:"p-4 border rounded-lg"},kt={class:"flex items-center justify-between gap-3 mb-3"},Dt={class:"p-4 border rounded-lg"},ht={class:"flex items-center justify-between gap-3 mb-3"},$t=G({__name:"AdditionalMetricsCard",props:{performanceData:{type:Object,default:()=>({})},performanceRatings:{type:Object,default:()=>({})}},setup(o){const p=u=>u==null?"0":Math.round(parseFloat(u)).toString(),v=u=>{if(!u)return"Not Available";switch(u){case"fantastic_plus":return"Fantastic +";case"fantastic":return"Fantastic";case"good":return"Good";case"fair":return"Fair";case"poor":return"Poor";default:return u.charAt(0).toUpperCase()+u.slice(1).replace(/_/g," ")}},x=u=>{if(!u)return"outline";switch(u){case"fantastic_plus":return"fantastic-plus";case"fantastic":return"fantastic";case"good":return"good";case"fair":return"fair";case"poor":return"poor";default:return"outline"}},g=u=>{if(!u)return"text-gray-600";switch(u){case"fantastic_plus":return"text-green-600";case"fantastic":return"text-emerald-600";case"good":return"text-blue-600";case"fair":return"text-amber-600";case"poor":return"text-red-600";default:return"text-indigo-600"}};return(u,_)=>(m(),h("div",bt,[_[6]||(_[6]=e("h3",{class:"text-xl font-semibold mb-4"},"Additional Performance Metrics",-1)),e("div",xt,[e("div",_t,[_[0]||(_[0]=e("h4",{class:"text-lg font-medium mb-2"},"VCR-P",-1)),_[1]||(_[1]=e("div",{class:"text-sm text-muted-foreground mb-1"},"Count",-1)),e("div",yt,[e("div",{class:O(["text-3xl font-bold",g(o.performanceRatings.vcr_preventable)])},c(p(o.performanceData.vcr_preventable)),3),n(s(U),{variant:x(o.performanceRatings.vcr_preventable),class:"text-xs"},{default:d(()=>[f(c(v(o.performanceRatings.vcr_preventable)),1)]),_:1},8,["variant"])])]),e("div",wt,[_[2]||(_[2]=e("h4",{class:"text-lg font-medium mb-2"},"VMCR-P",-1)),_[3]||(_[3]=e("div",{class:"text-sm text-muted-foreground mb-1"},"Count",-1)),e("div",kt,[e("div",{class:O(["text-3xl font-bold",g(o.performanceRatings.vmcr_p)])},c(p(o.performanceData.vmcr_p)),3),n(s(U),{variant:x(o.performanceRatings.vmcr_p),class:"text-xs"},{default:d(()=>[f(c(v(o.performanceRatings.vmcr_p)),1)]),_:1},8,["variant"])])]),e("div",Dt,[_[4]||(_[4]=e("h4",{class:"text-lg font-medium mb-2"},"Open BOC",-1)),_[5]||(_[5]=e("div",{class:"text-sm text-muted-foreground mb-1"},"Count",-1)),e("div",ht,[e("div",{class:O(["text-3xl font-bold",g(o.performanceRatings.open_boc)])},c(p(o.performanceData.open_boc)),3),n(s(U),{variant:x(o.performanceRatings.open_boc),class:"text-xs"},{default:d(()=>[f(c(v(o.performanceRatings.open_boc)),1)]),_:1},8,["variant"])])])])]))}}),St={class:"bg-card rounded-lg border shadow-sm p-4 md:p-6 mb-6"},Ct={class:"flex justify-between items-center mb-4"},Tt={class:"overflow-x-auto max-h-80"},jt={class:"flex space-x-2"},Nt={key:0,class:"border-t mt-4 px-4 py-3 bg-muted/20"},Rt={class:"flex flex-col sm:flex-row items-center justify-between gap-2"},Ft={class:"text-sm text-muted-foreground"},Mt={class:"flex flex-wrap gap-2"},Bt=["innerHTML"],Et={class:"grid grid-cols-2 gap-4"},Vt={key:0,class:"grid grid-cols-2 gap-4"},Ut={class:"mt-1"},At={class:"mt-1"},Ot=G({__name:"MilesDrivenTable",props:{milesEntries:{},tenantSlug:{}},setup(o){const p=o,v=M(!1),x=M("week_start_date"),g=M("desc"),u=se({id:null,year:"",week_number:"",week_start_date:"",week_end_date:"",miles:"",notes:""}),_=j(()=>{const r=[...p.milesEntries.data];return r.sort((t,a)=>{let k=t[x.value],R=a[x.value];return k>R?g.value==="asc"?1:-1:k<R?g.value==="asc"?-1:1:0}),r});function F(r){x.value===r?g.value=g.value==="asc"?"desc":"asc":(x.value=r,g.value="asc")}function N(r=null){if(u.reset(),u.clearErrors(),r){u.id=r.id,u.week_start_date=r.week_start_date,u.week_end_date=r.week_end_date,u.miles=r.miles,u.notes=r.notes;const t=new Date(r.week_start_date),a=new Date(Date.UTC(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate()));a.setUTCDate(a.getUTCDate()+4-(a.getUTCDay()||7));const k=a.getUTCFullYear(),R=Math.ceil(((a-Date.UTC(k,0,1))/864e5+1)/7)+1;u.year=k,u.week_number=R}v.value=!0}function D(){const r=+u.year,t=+u.week_number;if(!r||!t){u.week_start_date="",u.week_end_date="";return}const a=new Date(Date.UTC(r,0,4)),k=a.getUTCDay()||7;a.setUTCDate(a.getUTCDate()+(t-1)*7+(1-k));const R=new Date(a);R.setUTCDate(a.getUTCDate()-1);const z=new Date(R);z.setUTCDate(R.getUTCDate()+6),u.week_start_date=R.toISOString().slice(0,10),u.week_end_date=z.toISOString().slice(0,10)}function C(){const r=u.id?"miles_driven.update":"miles_driven.store",t=u.id?{tenantSlug:p.tenantSlug,milesDriven:u.id}:{tenantSlug:p.tenantSlug};u[u.id?"put":"post"](Z(r,t),{only:["milesEntries"],preserveScroll:!0,onSuccess:()=>{v.value=!1}})}const $=M(null);function B(r){$.value=r,confirm("Really delete this record?")&&i()}function i(){const r="miles_driven.destroy",t={tenantSlug:p.tenantSlug,milesDriven:$.value.id};u.delete(Z(r,t),{only:["milesEntries"],preserveScroll:!0,onSuccess:()=>{}})}function l(r){if(!r)return"";const t=new Date(r);return new Date(t.getTime()+t.getTimezoneOffset()*6e4).toLocaleDateString()}function T(r){return Number(r).toLocaleString(void 0,{minimumFractionDigits:4,maximumFractionDigits:4})}function S(r,t){return(r==null?void 0:r.length)>t?r.slice(0,t)+"â€¦":r||""}function b(r){r&&J.get(r,{},{only:["milesEntries"],preserveScroll:!0})}return(r,t)=>(m(),h("div",St,[e("div",Ct,[t[11]||(t[11]=e("h3",{class:"text-base md:text-xl font-semibold"}," Miles Driven ",-1)),n(s(A),{onClick:t[0]||(t[0]=a=>N()),variant:"default"},{default:d(()=>[n(y,{name:"plus",class:"mr-2 h-4 w-4"}),t[10]||(t[10]=e("span",null,"Add Miles Driven",-1))]),_:1})]),e("div",Tt,[n(s(ae),{class:"w-full"},{default:d(()=>[n(s(ee),null,{default:d(()=>[n(s(Y),{class:"sticky top-0 z-10 border-b"},{default:d(()=>[n(s(W),{class:"cursor-pointer",onClick:t[1]||(t[1]=a=>F("week_start_date"))},{default:d(()=>[t[12]||(t[12]=f(" Week Start ")),e("span",null,[x.value==="week_start_date"&&g.value==="asc"?(m(),w(y,{key:0,name:"chevron-up"})):x.value==="week_start_date"&&g.value==="desc"?(m(),w(y,{key:1,name:"chevron-down"})):(m(),w(y,{key:2,name:"chevron-up-down",class:"opacity-50"}))])]),_:1}),n(s(W),{class:"cursor-pointer",onClick:t[2]||(t[2]=a=>F("week_end_date"))},{default:d(()=>[t[13]||(t[13]=f(" Week End ")),e("span",null,[x.value==="week_end_date"&&g.value==="asc"?(m(),w(y,{key:0,name:"chevron-up"})):x.value==="week_end_date"&&g.value==="desc"?(m(),w(y,{key:1,name:"chevron-down"})):(m(),w(y,{key:2,name:"chevron-up-down",class:"opacity-50"}))])]),_:1}),n(s(W),{class:"cursor-pointer",onClick:t[3]||(t[3]=a=>F("miles"))},{default:d(()=>[t[14]||(t[14]=f(" Miles ")),e("span",null,[x.value==="miles"&&g.value==="asc"?(m(),w(y,{key:0,name:"chevron-up"})):x.value==="miles"&&g.value==="desc"?(m(),w(y,{key:1,name:"chevron-down"})):(m(),w(y,{key:2,name:"chevron-up-down",class:"opacity-50"}))])]),_:1}),n(s(W),null,{default:d(()=>t[15]||(t[15]=[f("Notes")])),_:1}),n(s(W),null,{default:d(()=>t[16]||(t[16]=[f("Actions")])),_:1})]),_:1})]),_:1}),n(s(te),null,{default:d(()=>[(m(!0),h(I,null,L(_.value,a=>(m(),w(s(Y),{key:a.id},{default:d(()=>[n(s(V),null,{default:d(()=>[f(c(l(a.week_start_date)),1)]),_:2},1024),n(s(V),null,{default:d(()=>[f(c(l(a.week_end_date)),1)]),_:2},1024),n(s(V),null,{default:d(()=>[f(c(T(a.miles)),1)]),_:2},1024),n(s(V),null,{default:d(()=>[f(c(S(a.notes,30)),1)]),_:2},1024),n(s(V),null,{default:d(()=>[e("div",jt,[n(s(A),{variant:"outline",size:"sm",onClick:k=>N(a)},{default:d(()=>[n(y,{name:"pencil",class:"mr-1 h-4 w-4"}),t[17]||(t[17]=e("span",null,"Edit",-1))]),_:2},1032,["onClick"]),n(s(A),{variant:"destructive",size:"sm",onClick:k=>B(a)},{default:d(()=>[n(y,{name:"trash",class:"mr-1 h-4 w-4"}),t[18]||(t[18]=e("span",null,"Delete",-1))]),_:2},1032,["onClick"])])]),_:2},1024)]),_:2},1024))),128)),r.milesEntries.data.length?P("",!0):(m(),w(s(Y),{key:0},{default:d(()=>[n(s(V),{colspan:5,class:"py-4 text-center text-muted-foreground"},{default:d(()=>t[19]||(t[19]=[f(" No miles driven records found ")])),_:1})]),_:1}))]),_:1})]),_:1})]),r.milesEntries.links?(m(),h("div",Nt,[e("div",Rt,[e("div",Ft," Showing "+c(r.milesEntries.data.length)+" entries ",1),e("div",Mt,[(m(!0),h(I,null,L(r.milesEntries.links,a=>(m(),w(s(A),{key:a.label,onClick:k=>b(a.url),disabled:!a.url,variant:"ghost",size:"sm",class:O({"border-primary bg-primary/10 text-primary":a.active})},{default:d(()=>[e("span",{innerHTML:a.label},null,8,Bt)]),_:2},1032,["onClick","disabled","class"]))),128))])])])):P("",!0),n(s(ge),{open:v.value,"onUpdate:open":t[9]||(t[9]=a=>v.value=a)},{default:d(()=>[n(s(ce),{class:"sm:max-w-md w-full max-h-[90vh] overflow-auto"},{default:d(()=>[n(s(me),null,{default:d(()=>[n(s(fe),null,{default:d(()=>[f(c(s(u).id?"Edit Miles Driven":"Add Miles Driven"),1)]),_:1}),n(s(ve),{class:"text-muted-foreground"},{default:d(()=>[f(c(s(u).id?"Update this record.":"Fill in the new miles driven record."),1)]),_:1})]),_:1}),e("form",{onSubmit:oe(C,["prevent"]),class:"grid gap-4 py-4"},[e("div",Et,[e("div",null,[n(s(q),{for:"year"},{default:d(()=>t[20]||(t[20]=[f("Year")])),_:1}),n(s(H),{id:"year",type:"number",modelValue:s(u).year,"onUpdate:modelValue":t[4]||(t[4]=a=>s(u).year=a),modelModifiers:{number:!0},min:"2000",max:"2100",onInput:D},null,8,["modelValue"])]),e("div",null,[n(s(q),{for:"week_number"},{default:d(()=>t[21]||(t[21]=[f("Week #")])),_:1}),n(s(H),{id:"week_number",type:"number",modelValue:s(u).week_number,"onUpdate:modelValue":t[5]||(t[5]=a=>s(u).week_number=a),modelModifiers:{number:!0},min:"1",max:"53",onInput:D},null,8,["modelValue"])])]),s(u).week_start_date?(m(),h("div",Vt,[e("div",null,[n(s(q),null,{default:d(()=>t[22]||(t[22]=[f("Start (Sun)")])),_:1}),e("p",Ut,c(l(s(u).week_start_date)),1)]),e("div",null,[n(s(q),null,{default:d(()=>t[23]||(t[23]=[f("End (Sat)")])),_:1}),e("p",At,c(l(s(u).week_end_date)),1)])])):P("",!0),e("div",null,[n(s(q),{for:"miles"},{default:d(()=>t[24]||(t[24]=[f("Miles")])),_:1}),n(s(H),{id:"miles",modelValue:s(u).miles,"onUpdate:modelValue":t[6]||(t[6]=a=>s(u).miles=a),type:"number",step:"0.0001",min:"0",max:"999999.9999"},null,8,["modelValue"])]),e("div",null,[n(s(q),{for:"notes"},{default:d(()=>t[25]||(t[25]=[f("Notes")])),_:1}),X(e("textarea",{id:"notes","onUpdate:modelValue":t[7]||(t[7]=a=>s(u).notes=a),class:"w-full h-24 resize-none rounded-md border border-input bg-background px-3 py-2 text-sm"},null,512),[[le,s(u).notes]])]),n(s(pe),{class:"mt-4"},{default:d(()=>[n(s(A),{variant:"outline",type:"button",onClick:t[8]||(t[8]=a=>v.value=!1)},{default:d(()=>t[26]||(t[26]=[f(" Cancel ")])),_:1}),n(s(A),{type:"submit",disabled:s(u).processing},{default:d(()=>t[27]||(t[27]=[f("Submit")])),_:1},8,["disabled"])]),_:1})],32)]),_:1})]),_:1},8,["open"])]))}}),Wt=G({__name:"CardDescription",props:{class:{}},setup(o){const p=o;return(v,x)=>(m(),h("p",{class:O(s(we)("text-sm text-muted-foreground",p.class))},[ie(v.$slots,"default")],2))}}),Pt={class:"flex flex-col md:flex-row md:items-center md:justify-between gap-2"},zt={class:"flex items-center gap-2"},It={class:"relative w-full md:w-auto"},Lt={class:"absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none"},Gt={class:"overflow-x-auto"},qt={class:"flex items-center gap-1"},Yt={class:"flex items-center justify-end gap-1"},Ht={class:"flex items-center justify-end gap-1"},Kt={class:"flex items-center justify-end gap-1"},Qt={class:"flex flex-col items-center justify-center gap-2"},Zt={key:0},Jt={key:1},Xt={class:"border-t bg-muted/20 px-4 py-3 flex flex-col sm:flex-row justify-between items-center gap-2"},ea={class:"flex items-center gap-4 text-sm text-muted-foreground"},ta={class:"flex items-center gap-1"},aa={class:"flex items-center gap-1"},sa={class:"relative"},na=["value"],ra={class:"flex space-x-1"},la=G({__name:"DriverPerformanceTable",props:{driversData:{type:Array,default:()=>[]}},setup(o){const p=o,v=M(""),x=M("overall_score"),g=M("desc"),u=r=>{x.value===r?g.value=g.value==="asc"?"desc":"asc":(x.value=r,g.value=r==="driver_name"?"asc":"desc")},_=()=>{v.value="",x.value="overall_score",g.value="desc",D.value=1,C.value=10},F=j(()=>{if(!p.driversData||p.driversData.length===0)return[];if(!v.value)return p.driversData;const r=v.value.toLowerCase();return p.driversData.filter(t=>t.driver_name.toLowerCase().includes(r))}),N=j(()=>F.value.length===0?[]:[...F.value].sort((r,t)=>{const a=r[x.value],k=t[x.value];return typeof a=="string"?g.value==="asc"?a.localeCompare(k):k.localeCompare(a):g.value==="asc"?a-k:k-a})),D=M(1),C=M(10);Q([x,g,v],()=>{D.value=1}),Q(C,()=>{D.value=1});const $=j(()=>N.value.length),B=j(()=>Math.max(1,Math.ceil($.value/C.value)));Q([B,D],()=>{D.value>B.value&&(D.value=B.value)});const i=j(()=>{const r=B.value,t=D.value;if(r<=5)return Array.from({length:r},(E,K)=>K+1);let a=[1,r];const k=[t-1,t,t+1].filter(E=>E>1&&E<r);a.push(...k),a=[...new Set(a)].sort((E,K)=>E-K);const R=[];let z=0;for(const E of a)E-z>1&&R.push(-1),R.push(E),z=E;return R}),l=j(()=>(D.value-1)*C.value),T=j(()=>Math.min(l.value+C.value,$.value)),S=j(()=>N.value.slice(l.value,T.value)),b=r=>r>=90?"success":r>=75?"default":r>=60?"warning":"destructive";return(r,t)=>(m(),w(s(be),{class:"shadow-sm border bg-card"},{default:d(()=>[n(s(xe),{class:"p-4 border-b"},{default:d(()=>[e("div",Pt,[e("div",null,[n(s(_e),{class:"text-lg font-semibold flex items-center gap-2"},{default:d(()=>[n(y,{name:"users",class:"h-5 w-5 text-primary"}),t[9]||(t[9]=f(" Driver Performance "))]),_:1}),n(Wt,null,{default:d(()=>t[10]||(t[10]=[f("Overall driver performance metrics")])),_:1})]),e("div",zt,[e("div",It,[e("div",Lt,[n(y,{name:"search",class:"h-4 w-4 text-muted-foreground"})]),n(s(H),{modelValue:v.value,"onUpdate:modelValue":t[0]||(t[0]=a=>v.value=a),placeholder:"Search drivers...",class:"pl-10 w-full md:w-[200px]"},null,8,["modelValue"])]),n(s(A),{variant:"outline",size:"sm",onClick:_,class:"hidden md:flex items-center gap-1"},{default:d(()=>[n(y,{name:"rotate-ccw",class:"h-4 w-4"}),t[11]||(t[11]=f(" Reset "))]),_:1})])])]),_:1}),n(s(ye),{class:"p-0"},{default:d(()=>[e("div",Gt,[n(s(ae),{class:"relative h-[500px] overflow-auto"},{default:d(()=>[n(s(ee),null,{default:d(()=>[n(s(Y),{class:"sticky top-0 z-10 border-b bg-background hover:bg-background"},{default:d(()=>[n(s(W),{class:"w-12 text-center"},{default:d(()=>t[12]||(t[12]=[e("div",{class:"flex items-center justify-center"}," # ",-1)])),_:1}),n(s(W),{onClick:t[1]||(t[1]=a=>u("driver_name")),class:"cursor-pointer whitespace-nowrap"},{default:d(()=>[e("div",qt,[t[13]||(t[13]=f(" Driver Name ")),x.value==="driver_name"?(m(),w(y,{key:0,name:g.value==="asc"?"arrow-up":"arrow-down",class:"h-4 w-4"},null,8,["name"])):(m(),w(y,{key:1,name:"arrow-up-down",class:"h-4 w-4 opacity-50"}))])]),_:1}),n(s(W),{onClick:t[2]||(t[2]=a=>u("acceptance_score")),class:"cursor-pointer text-right whitespace-nowrap"},{default:d(()=>[e("div",Yt,[t[14]||(t[14]=f(" Acceptance ")),x.value==="acceptance_score"?(m(),w(y,{key:0,name:g.value==="asc"?"arrow-up":"arrow-down",class:"h-4 w-4"},null,8,["name"])):(m(),w(y,{key:1,name:"arrow-up-down",class:"h-4 w-4 opacity-50"}))])]),_:1}),n(s(W),{onClick:t[3]||(t[3]=a=>u("on_time_score")),class:"cursor-pointer text-right whitespace-nowrap"},{default:d(()=>[e("div",Ht,[t[15]||(t[15]=f(" On-Time ")),x.value==="on_time_score"?(m(),w(y,{key:0,name:g.value==="asc"?"arrow-up":"arrow-down",class:"h-4 w-4"},null,8,["name"])):(m(),w(y,{key:1,name:"arrow-up-down",class:"h-4 w-4 opacity-50"}))])]),_:1}),n(s(W),{onClick:t[4]||(t[4]=a=>u("safety_score")),class:"cursor-pointer text-right whitespace-nowrap"},{default:d(()=>[e("div",Kt,[t[16]||(t[16]=f(" Safety ")),x.value==="safety_score"?(m(),w(y,{key:0,name:g.value==="asc"?"arrow-up":"arrow-down",class:"h-4 w-4"},null,8,["name"])):(m(),w(y,{key:1,name:"arrow-up-down",class:"h-4 w-4 opacity-50"}))])]),_:1})]),_:1})]),_:1}),n(s(te),null,{default:d(()=>[(m(!0),h(I,null,L(S.value,(a,k)=>(m(),w(s(Y),{key:a.driver_name,class:"hover:bg-muted/20 transition-colors"},{default:d(()=>[n(s(V),{class:"text-center"},{default:d(()=>[n(s(U),{variant:"outline",class:"min-w-[28px] justify-center"},{default:d(()=>[f(c(l.value+k+1),1)]),_:2},1024)]),_:2},1024),n(s(V),{class:"font-medium"},{default:d(()=>[f(c(a.driver_name),1)]),_:2},1024),n(s(V),{class:"text-right"},{default:d(()=>[n(s(U),{variant:b(a.acceptance_score)},{default:d(()=>[f(c(a.acceptance_score)+"% ",1)]),_:2},1032,["variant"])]),_:2},1024),n(s(V),{class:"text-right"},{default:d(()=>[n(s(U),{variant:b(a.on_time_score)},{default:d(()=>[f(c(a.on_time_score)+"% ",1)]),_:2},1032,["variant"])]),_:2},1024),n(s(V),{class:"text-right"},{default:d(()=>[n(s(U),{variant:b(a.safety_score)},{default:d(()=>[f(c(a.safety_score)+"% ",1)]),_:2},1032,["variant"])]),_:2},1024)]),_:2},1024))),128)),F.value.length===0?(m(),w(s(Y),{key:0},{default:d(()=>[n(s(V),{colspan:"6",class:"text-center py-8 text-muted-foreground"},{default:d(()=>[e("div",Qt,[n(y,{name:"users-x",class:"h-10 w-10 opacity-50"}),v.value?(m(),h("p",Zt,'No drivers found matching "'+c(v.value)+'"',1)):(m(),h("p",Jt,"No driver performance data available for the selected period.")),v.value?(m(),w(s(A),{key:2,variant:"outline",size:"sm",onClick:t[5]||(t[5]=a=>v.value="")},{default:d(()=>t[17]||(t[17]=[f(" Clear search ")])),_:1})):P("",!0)])]),_:1})]),_:1})):P("",!0)]),_:1})]),_:1})]),e("div",Xt,[e("div",ea,[e("span",ta,[n(y,{name:"list",class:"h-4 w-4"}),f(" Showing "+c(l.value+1)+"-"+c(T.value)+" of "+c($.value)+" drivers ",1)]),e("span",aa,[n(y,{name:"layout-grid",class:"h-4 w-4"}),t[18]||(t[18]=f(" Per page: "))]),e("div",sa,[X(e("select",{"onUpdate:modelValue":t[6]||(t[6]=a=>C.value=a),class:"h-8 appearance-none rounded-md border bg-background px-2 py-1 text-sm focus:ring-2 focus:ring-ring"},[(m(),h(I,null,L([5,10,20,50],a=>e("option",{key:a,value:a},c(a),9,na)),64))],512),[[de,C.value,void 0,{number:!0}]]),t[19]||(t[19]=e("div",{class:"pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700"},[e("svg",{class:"h-4 w-4 opacity-50",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z","clip-rule":"evenodd"})])],-1))])]),e("div",ra,[n(s(A),{size:"sm",variant:"ghost",onClick:t[7]||(t[7]=a=>D.value--),disabled:D.value===1,class:"flex items-center gap-1"},{default:d(()=>[n(y,{name:"chevron-left",class:"h-4 w-4"}),t[20]||(t[20]=f(" Prev "))]),_:1},8,["disabled"]),(m(!0),h(I,null,L(i.value,a=>(m(),w(s(A),{key:a,size:"sm",variant:"ghost",onClick:k=>a!==-1?D.value=a:null,class:O({"border-primary bg-primary/10 text-primary font-medium":a===D.value,"opacity-50 pointer-events-none":a===-1})},{default:d(()=>[f(c(a===-1?"...":a),1)]),_:2},1032,["onClick","class"]))),128)),n(s(A),{size:"sm",variant:"ghost",onClick:t[8]||(t[8]=a=>D.value++),disabled:D.value===B.value,class:"flex items-center gap-1"},{default:d(()=>[t[21]||(t[21]=f(" Next ")),n(y,{name:"chevron-right",class:"h-4 w-4"})]),_:1},8,["disabled"])])])]),_:1})]),_:1}))}}),oa={class:"container w-full md:max-w-2xl lg:max-w-3xl xl:max-w-6xl lg:mx-auto m-0 p-2 md:p-4 lg:p-6 space-y-2 md:space-y-4 lg:space-y-6"},ia={class:"flex items-center justify-between mb-6"},da={class:"h-auto"},Na=G({__name:"Summary",props:{tenantSlug:String,summaries:Object,delayBreakdowns:Object,rejectionBreakdowns:Object,maintenanceBreakdowns:Object,dateFilter:String,dateRange:Object,milesEntries:Object,driversOverallPerformance:Object},setup(o){const p=o;M("on-time");const v=M(p.dateFilter||"t6w"),x=M(null),g=M(null);ue(()=>{});const u=j(()=>{const l={yesterday:"yesterday","current-week":"current_week",t6w:"rolling_6_weeks",quarterly:"quarterly"}[v.value]||v.value;return C(l)}),_=i=>{v.value=i,J.visit(route("dashboard",{tenantSlug:p.tenantSlug,dateFilter:i,minInvoiceAmount:x.value||null,outstandingDate:g.value||null}),{only:["summaries","delayBreakdowns","rejectionBreakdowns","maintenanceBreakdowns","dateFilter","dateRange","milesEntries"]})},F=[{title:p.tenantSlug?"Dashboard":"Admin Dashboard",href:p.tenantSlug?route("dashboard",{tenantSlug:p.tenantSlug}):route("admin.dashboard")},{title:"Performance Summary",href:route("dashboard",{tenantSlug:p.tenantSlug})}],N=j(()=>{var i,l;return(l=(i=p.summaries)==null?void 0:i.performance)!=null&&l.last_updated?D(new Date(p.summaries.performance.last_updated)):D(new Date)}),D=i=>new Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"}).format(i),C=i=>{var T,S;if((S=(T=p.summaries)==null?void 0:T[i])!=null&&S.date_range){const b=new Date(p.summaries[i].date_range.start+"T12:00:00"),r=new Date(p.summaries[i].date_range.end+"T12:00:00");return`${$(b)} - ${$(r)}`}const l=new Date;switch(i){case"yesterday":{const b=new Date(l);return b.setDate(b.getDate()-1),$(b)}case"current_week":{const b=new Date(l);b.setDate(l.getDate()-l.getDay());const r=new Date(b);return r.setDate(b.getDate()+6),`${$(b)} - ${$(r)}`}case"rolling_6_weeks":{const b=new Date(l);b.setDate(l.getDate()-l.getDay()+6);const r=new Date(b);return r.setDate(b.getDate()-6*7+1),`${$(r)} - ${$(b)}`}case"quarterly":{const b=new Date(l),r=new Date(l);return r.setMonth(r.getMonth()-3),`${$(r)} - ${$(b)}`}default:return""}},$=i=>new Intl.DateTimeFormat("en-US",{month:"numeric",day:"numeric",year:"numeric"}).format(i),B=j(()=>{var b,r;if(!((r=(b=p.summaries)==null?void 0:b.performance)!=null&&r.ratings))return"Not Available";const i=p.summaries.performance.ratings,l={fantastic_plus:5,fantastic:4,good:3,fair:2,poor:1},T=["average_acceptance","average_on_time","average_maintenance_variance_to_spend","open_boc","vcr_preventable","vmcr_p"];let S="fantastic_plus";for(const t of T)i[t]&&l[i[t]]<l[S]&&(S=i[t]);switch(S){case"fantastic_plus":return"Fantastic +";case"fantastic":return"Fantastic";case"good":return"Good";case"fair":return"Fair";case"poor":return"Poor";default:return"Not Available"}});return(i,l)=>(m(),w(re,{breadcrumbs:F,tenantSlug:o.tenantSlug},{default:d(()=>{var T,S,b,r,t,a,k,R,z,E;return[n(s(ne),{title:"Performance Summary Dashboard"}),e("div",oa,[e("div",ia,[l[0]||(l[0]=e("h1",{class:"text-2xl font-bold"},null,-1)),n(s(U),{variant:"outline",class:"text-sm"},{default:d(()=>[n(y,{name:"calendar",class:"mr-1 h-4 w-4"}),f(" Last updated: "+c(N.value),1)]),_:1})]),n(De,{operationalExcellenceScore:B.value},null,8,["operationalExcellenceScore"]),n(Ne,{onTabChange:_,dateRangeText:u.value,weekNumber:(T=o.dateRange)==null?void 0:T.weekNumber,startWeekNumber:(S=o.dateRange)==null?void 0:S.startWeekNumber,endWeekNumber:(b=o.dateRange)==null?void 0:b.endWeekNumber,year:(r=o.dateRange)==null?void 0:r.year,activeTabId:v.value},null,8,["dateRangeText","weekNumber","startWeekNumber","endWeekNumber","year","activeTabId"]),o.summaries?(m(),w(pt,{key:0,performanceData:((t=o.summaries.performance)==null?void 0:t.data)||{},performanceRatings:((a=o.summaries.performance)==null?void 0:a.ratings)||{},safetyData:o.summaries.safety||{},delayBreakdowns:((k=o.delayBreakdowns)==null?void 0:k.by_code)||[],rejectionBreakdowns:((R=o.rejectionBreakdowns)==null?void 0:R.by_reason)||[],maintenanceBreakdowns:o.maintenanceBreakdowns||{}},null,8,["performanceData","performanceRatings","safetyData","delayBreakdowns","rejectionBreakdowns","maintenanceBreakdowns"])):P("",!0),e("div",da,[o.driversOverallPerformance?(m(),w(la,{key:0,driversData:o.driversOverallPerformance.drivers||[]},null,8,["driversData"])):P("",!0)]),o.summaries?(m(),w($t,{key:1,performanceData:((z=o.summaries.performance)==null?void 0:z.data)||{},performanceRatings:((E=o.summaries.performance)==null?void 0:E.ratings)||{}},null,8,["performanceData","performanceRatings"])):P("",!0),n(Ot,{milesEntries:o.milesEntries,tenantSlug:o.tenantSlug},null,8,["milesEntries","tenantSlug"])])]}),_:1},8,["tenantSlug"]))}});export{Na as default};
